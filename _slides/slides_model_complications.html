<!DOCTYPE html>
<html lang="en"><head>
<script src="slides_model_complications_files/libs/clipboard/clipboard.min.js"></script>
<script src="slides_model_complications_files/libs/quarto-html/tabby.min.js"></script>
<script src="slides_model_complications_files/libs/quarto-html/popper.min.js"></script>
<script src="slides_model_complications_files/libs/quarto-html/tippy.umd.min.js"></script>
<link href="slides_model_complications_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="slides_model_complications_files/libs/quarto-html/light-border.css" rel="stylesheet">
<link href="slides_model_complications_files/libs/quarto-html/quarto-syntax-highlighting-9e1f2a4632985dffc2c80318c992baf5.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<link href="slides_model_complications_files/libs/quarto-contrib/fontawesome6-0.1.0/all.css" rel="stylesheet">
<link href="slides_model_complications_files/libs/quarto-contrib/fontawesome6-0.1.0/latex-fontsize.css" rel="stylesheet"><meta charset="utf-8">
  <meta name="generator" content="quarto-1.6.40">

  <meta name="author" content="Aaron Gullickson">
  <title>Model Complications</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="slides_model_complications_files/libs/revealjs/dist/reset.css">
  <link rel="stylesheet" href="slides_model_complications_files/libs/revealjs/dist/reveal.css">
  <style>
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    ul.task-list{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      width: 0.8em;
      margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
      vertical-align: middle;
    }
    /* CSS for syntax highlighting */
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
        color: #aaaaaa;
      }
    pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
    div.sourceCode
      {  background-color: #f8f8f8; }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span.al { color: #ef2929; } /* Alert */
    code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
    code span.at { color: #204a87; } /* Attribute */
    code span.bn { color: #0000cf; } /* BaseN */
    code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
    code span.ch { color: #4e9a06; } /* Char */
    code span.cn { color: #8f5902; } /* Constant */
    code span.co { color: #8f5902; font-style: italic; } /* Comment */
    code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
    code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
    code span.dt { color: #204a87; } /* DataType */
    code span.dv { color: #0000cf; } /* DecVal */
    code span.er { color: #a40000; font-weight: bold; } /* Error */
    code span.ex { } /* Extension */
    code span.fl { color: #0000cf; } /* Float */
    code span.fu { color: #204a87; font-weight: bold; } /* Function */
    code span.im { } /* Import */
    code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
    code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
    code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
    code span.ot { color: #8f5902; } /* Other */
    code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
    code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
    code span.ss { color: #4e9a06; } /* SpecialString */
    code span.st { color: #4e9a06; } /* String */
    code span.va { color: #000000; } /* Variable */
    code span.vs { color: #4e9a06; } /* VerbatimString */
    code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="slides_model_complications_files/libs/revealjs/dist/theme/quarto-4911d2f5eb786d6d95cb091d6b3cdfd5.css">
  <link href="slides_model_complications_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.css" rel="stylesheet">
  <link href="slides_model_complications_files/libs/revealjs/plugin/reveal-menu/menu.css" rel="stylesheet">
  <link href="slides_model_complications_files/libs/revealjs/plugin/reveal-menu/quarto-menu.css" rel="stylesheet">
  <link href="slides_model_complications_files/libs/revealjs/plugin/reveal-chalkboard/font-awesome/css/all.css" rel="stylesheet">
  <link href="slides_model_complications_files/libs/revealjs/plugin/reveal-chalkboard/style.css" rel="stylesheet">
  <link href="slides_model_complications_files/libs/revealjs/plugin/reveal-code-focus/codefocus.css" rel="stylesheet">
  <link href="slides_model_complications_files/libs/revealjs/plugin/quarto-support/footer.css" rel="stylesheet">
  <style type="text/css">
    .reveal div.sourceCode {
      margin: 0;
      overflow: auto;
    }
    .reveal div.hanging-indent {
      margin-left: 1em;
      text-indent: -1em;
    }
    .reveal .slide:not(.center) {
      height: 100%;
    }
    .reveal .slide.scrollable {
      overflow-y: auto;
    }
    .reveal .footnotes {
      height: 100%;
      overflow-y: auto;
    }
    .reveal .slide .absolute {
      position: absolute;
      display: block;
    }
    .reveal .footnotes ol {
      counter-reset: ol;
      list-style-type: none; 
      margin-left: 0;
    }
    .reveal .footnotes ol li:before {
      counter-increment: ol;
      content: counter(ol) ". "; 
    }
    .reveal .footnotes ol li > p:first-child {
      display: inline-block;
    }
    .reveal .slide ul,
    .reveal .slide ol {
      margin-bottom: 0.5em;
    }
    .reveal .slide ul li,
    .reveal .slide ol li {
      margin-top: 0.4em;
      margin-bottom: 0.2em;
    }
    .reveal .slide ul[role="tablist"] li {
      margin-bottom: 0;
    }
    .reveal .slide ul li > *:first-child,
    .reveal .slide ol li > *:first-child {
      margin-block-start: 0;
    }
    .reveal .slide ul li > *:last-child,
    .reveal .slide ol li > *:last-child {
      margin-block-end: 0;
    }
    .reveal .slide .columns:nth-child(3) {
      margin-block-start: 0.8em;
    }
    .reveal blockquote {
      box-shadow: none;
    }
    .reveal .tippy-content>* {
      margin-top: 0.2em;
      margin-bottom: 0.7em;
    }
    .reveal .tippy-content>*:last-child {
      margin-bottom: 0.2em;
    }
    .reveal .slide > img.stretch.quarto-figure-center,
    .reveal .slide > img.r-stretch.quarto-figure-center {
      display: block;
      margin-left: auto;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-left,
    .reveal .slide > img.r-stretch.quarto-figure-left  {
      display: block;
      margin-left: 0;
      margin-right: auto; 
    }
    .reveal .slide > img.stretch.quarto-figure-right,
    .reveal .slide > img.r-stretch.quarto-figure-right  {
      display: block;
      margin-left: auto;
      margin-right: 0; 
    }
  </style>
</head>
<body class="quarto-light">
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="images/markus-spiske-666905-unsplash.jpg" data-background-size="cover" class="quarto-title-block center">
  <h1 class="title">Model Complications</h1>
  <p class="subtitle">Sociology 312/412/512, University of Oregon</p>

<div class="quarto-title-authors">
<div class="quarto-title-author">
<div class="quarto-title-author-name">
Aaron Gullickson 
</div>
</div>
</div>

</section>
<section>
<section id="the-linear-model-revisited" class="title-slide slide level1 center" data-background-color="black" data-background-image="images/jeremy-bishop-FzrlPh20l7Q-unsplash.jpg">
<h1>The Linear Model Revisited</h1>

</section>
<section id="review-of-linear-model" class="slide level2 smaller">
<h2>Review of linear model</h2>
<p><span class="math display">\[\hat{y}_i=\beta_0+\beta_1x_{i1}+\beta_2x_{i2}+\ldots+\beta_px_{ip}\]</span></p>
<ul>
<li class="fragment"><span class="math inline">\(\hat{y}_i\)</span> is the predicted value of the outcome/dependent variable which must be quantitative.</li>
<li class="fragment">The <span class="math inline">\(x\)</span> values are different independent/explanatory variables which may be quantitative or categorical (by using dummy coding).</li>
<li class="fragment">The <span class="math inline">\(\beta\)</span> values are the slopes/effects/coefficients that, <em>holding all other independent variables constant</em>, tell us the:
<ul>
<li class="fragment">The predicted change in <span class="math inline">\(y\)</span> for a one unit increase in <span class="math inline">\(x\)</span> if <span class="math inline">\(x\)</span> is quantitative</li>
<li class="fragment">The mean difference in <span class="math inline">\(y\)</span> between the indicated category and the reference category if <span class="math inline">\(x\)</span> is categorical.</li>
</ul></li>
</ul>
<div class="fragment">
<h3 id="interpret-these-values">Interpret these values</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(nominations<span class="sc">~</span>nsports<span class="sc">+</span><span class="fu">I</span>(parent_income<span class="dv">-45</span>)<span class="sc">+</span>gender, <span class="at">data=</span>popularity))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          (Intercept)               nsports I(parent_income - 45) 
           4.29062324            0.50750823            0.01071398 
           genderMale 
          -0.62846269 </code></pre>
</div>
</div>
</div>
</section>
<section id="the-residual-term" class="slide level2 smaller">
<h2>The residual term</h2>
<p><span class="math display">\[\epsilon_i=y_i-\hat{y}_i\]</span></p>
<p>The residual/error term <span class="math inline">\(\epsilon_i\)</span> gives us the difference between the actual value of the outcome variable for a given observation and the value predicted by the model.</p>
<div class="fragment">
<p>Lets use algebra to rewrite this equation with <span class="math inline">\(y_i\)</span> on the left-hand side:</p>
<p><span class="math display">\[y_i=\hat{y}_i+\epsilon_i\]</span></p>
</div>
<div class="fragment">
<p>If we plug in our linear model formula for <span class="math inline">\(\hat{y}_i\)</span>, we can get the full model formula:</p>
<p><span class="math display">\[y_i=\underbrace{\beta_0+\beta_1x_{i1}+\beta_2x_{i2}+\ldots+\beta_px_{ip}}_{\hat{y}_i}+\epsilon_i\]</span></p>
</div>
</section>
<section id="linear-model-as-a-partition-of-the-variance-in-y" class="slide level2 smaller">
<h2>Linear model as a partition of the variance in <span class="math inline">\(y\)</span></h2>
<p><span class="math display">\[y_i = \underbrace{\beta_0+\beta_1x_{i1}+\beta_2x_{i2}+\ldots+\beta_px_{ip}}_\text{structural} +
    \underbrace{\epsilon_i}_\text{stochastic}\]</span></p>
<ul>
<li class="fragment">The structural part is the predicted value from our model which is typically a linear function of the independent variables.</li>
<li class="fragment">The stochastic component is the leftover residual or error component, that is not accounted for by the model.</li>
</ul>
<div class="fragment">
<p>Depending on disciplinary norms, there are different conceptual ways to view this basic relationship:</p>
<ul>
<li class="fragment"><strong>Description:</strong> observed = summary + residual</li>
<li class="fragment"><strong>Prediction:</strong> observed = predicted + error</li>
<li class="fragment"><strong>Causation:</strong> observed = true process + disturbance</li>
</ul>
</div>
</section>
<section id="calculating-marginal-effects" class="slide level2 smaller">
<h2>Calculating marginal effects</h2>
<p>The <strong>marginal effect</strong> of <span class="math inline">\(x\)</span> on <span class="math inline">\(y\)</span> is simply the predicted change in <span class="math inline">\(y\)</span> for a one unit increase in <span class="math inline">\(x\)</span> from its current value, holding all else constant.</p>
<div class="fragment">
<p>In a basic linear model, the marginal effect is just given by the slope itself.</p>
<p><span class="math display">\[y_i=\beta_0+\beta_1x_{i1}+\beta_2x_{i2}+\epsilon_i\]</span></p>
<ul>
<li class="fragment"><span class="math inline">\(\beta_1\)</span> is the marginal effect of <span class="math inline">\(x_1\)</span></li>
<li class="fragment"><span class="math inline">\(\beta_2\)</span> is the marginal effect of <span class="math inline">\(x_2\)</span></li>
</ul>
</div>
<div class="fragment">
<p>Technically, the marginal effect is the derivative of <span class="math inline">\(y\)</span> with respect to a given <span class="math inline">\(x\)</span>. This gives us the <strong>tangent line</strong> for the curve at any value of <span class="math inline">\(x\)</span>.</p>
<p><span class="math display">\[\frac{\partial y}{\partial x_1}=\beta_1\]</span> <span class="math display">\[\frac{\partial y}{\partial x_2}=\beta_2\]</span></p>
<p>😱 I am not expecting you to know the calculus behind this, but it may help some people.</p>
</div>
</section>
<section id="marginal-effects-with-interaction-terms" class="slide level2 smaller">
<h2>Marginal effects with interaction terms</h2>
<div class="columns">
<div class="column fragment">
<p>Marginal effects can get more complicated when we move to more complex model. Consider this model with an interaction term:</p>
<p><span class="math display">\[y_i=\beta_0+\beta_1x_{i1}+\beta_2x_{i2}+\beta_3(x_{i1})(x_{i2})+\epsilon_i\]</span></p>
<div class="fragment">
<p>The marginal effects are now given by:</p>
<p><span class="math display">\[\frac{\partial y}{\partial x_1}=\beta_1+\beta_3x_{i2}\]</span> <span class="math display">\[\frac{\partial y}{\partial x_2}=\beta_2+\beta_3x_{i1}\]</span></p>
<p>This is a very math-y way of saying: <strong>the main effects depend on the effect of the other variable</strong>.</p>
</div>
</div><div class="column fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(nominations<span class="sc">~</span>nsports<span class="sc">*</span>gender, <span class="at">data=</span>popularity)</span>
<span id="cb3-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">as.data.frame</span>(<span class="fu">coef</span>(model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                   coef(model)
(Intercept)         4.21374011
nsports             0.59169144
genderMale         -0.54255556
nsports:genderMale -0.08760095</code></pre>
</div>
</div>
<div class="fragment">
<p>The marginal effect for number of sports played is:</p>
<p><span class="math display">\[0.49-0.09(male_i)\]</span></p>
<p>The marginal effect for gender is:</p>
<p><span class="math display">\[-0.54-0.09(nsports_i)\]</span></p>
</div>
</div></div>
</section>
<section id="marginal-effects-plot" class="slide level2 smaller">
<h2>Marginal effects plot</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="" aria-hidden="true" tabindex="-1"></a>nsports <span class="ot">&lt;-</span> <span class="dv">0</span><span class="sc">:</span><span class="dv">6</span></span>
<span id="cb5-2"><a href="" aria-hidden="true" tabindex="-1"></a>gender_diff <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fl">0.54-0.09</span><span class="sc">*</span>nsports</span>
<span id="cb5-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">tibble</span>(nsports, gender_diff),</span>
<span id="cb5-4"><a href="" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>nsports, <span class="at">y=</span>gender_diff))<span class="sc">+</span></span>
<span id="cb5-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()<span class="sc">+</span></span>
<span id="cb5-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"number of sports played"</span>,</span>
<span id="cb5-7"><a href="" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"predicted popularity difference between boys and girls"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div id="fig-marginal-fx-plot-exec" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-marginal-fx-plot-exec-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="slides_model_complications_files/figure-revealjs/fig-marginal-fx-plot-exec-1.png" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-marginal-fx-plot-exec-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Marginal effect of gender difference on popularity by sports played
</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="two-key-assumptions-of-linear-models" class="slide level2 smaller">
<h2>Two key assumptions of linear models</h2>
<div class="columns">
<div class="column fragment">
<h3 id="linearity">Linearity</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/linear-violation-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li class="fragment">If you fit a model with the wrong functional form, it is considered a <em>specification error</em>.</li>
<li class="fragment">We can correct this through a variety of more advanced model specifications.</li>
</ul>
</div><div class="column fragment">
<h3 id="error-terms-are-iid">Error terms are iid</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/heteroskedasticity-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<ul>
<li class="fragment">iid = <strong>independent and identically distributed</strong> which is typically violated either by <strong>heteroscedasticity</strong> or <strong>autocorrelation</strong>.</li>
<li class="fragment">The consequence of violating the i.i.d. assumption is usually incorrect standard errors.</li>
</ul>
</div></div>
</section>
<section id="how-are-linear-model-parameters-estimated" class="slide level2 smaller">
<h2>How are linear model parameters estimated?</h2>
<p>⚠️ Heavy math ahead!</p>
<ul>
<li class="fragment">We have simple formulas for the slope and intercept for a bivariat model.</li>
<li class="fragment">With multiple independent variables, a simple formula will not suffice. To estimate model parameters with multiple independent variables we need to use some matrix algebra.</li>
</ul>
<div class="fragment">
<h3 class="smaller" id="the-matrix-algebra-approach-to-linear-models">The matrix algebra approach to linear models</h3>
<p>We can use matrix algebra to represent our linear regression model equation using one-dimensional <strong>vectors</strong> and two-dimensional <strong>matrices</strong>.</p>
<p><span class="math display">\[\mathbf{y}=\mathbf{X\beta+\epsilon}\]</span></p>
<ul>
<li class="fragment"><span class="math inline">\(\mathbf{y}\)</span> is a vector of known values of the independent variable of length <span class="math inline">\(n\)</span>.</li>
<li class="fragment"><span class="math inline">\(\mathbf{X}\)</span> is a matrix of known values of the independent variables of dimensions <span class="math inline">\(n\)</span> by <span class="math inline">\(p+1\)</span>.</li>
<li class="fragment"><span class="math inline">\(\mathbf{\beta}\)</span> is a vector of to-be-estimated values of intercepts and slopes of length <span class="math inline">\(p+1\)</span>.</li>
<li class="fragment"><span class="math inline">\(\mathbf{\epsilon}\)</span> is a vector of residuals of length <span class="math inline">\(n\)</span> that will be equal to <span class="math inline">\(\mathbf{y-X\beta}\)</span>.</li>
</ul>
</div>
</section>
<section id="linear-model-in-matrix-form" class="slide level2 smaller">
<h2>⚠️ Linear model in matrix form</h2>
<div class="columns">
<div class="column">
<h3 id="known-quantities">Known Quantities</h3>
<p><span class="math display">\[\mathbf{y}=\begin{pmatrix}
y_{1}\\
y_{2}\\
\vdots\\
y_{n}\\
\end{pmatrix}\]</span></p>
<p><span class="math display">\[\mathbf{X}=\begin{pmatrix}
1 &amp; x_{11} &amp; x_{12} &amp; \ldots &amp; x_{1p}\\
1 &amp; x_{21} &amp; x_{22} &amp; \ldots &amp; x_{2p}\\
\vdots &amp; \vdots &amp; \ldots &amp; \vdots\\
1 &amp; x_{n1} &amp; x_{n2} &amp; \ldots &amp; x_{np}\\
\end{pmatrix}\]</span></p>
</div><div class="column">
<h3 id="need-to-estimate">Need to Estimate</h3>
<p><span class="math display">\[\mathbf{\beta}=\begin{pmatrix}
\beta_{0}\\
\beta_{1}\\
\vdots\\
\beta_{p}\\
\end{pmatrix}\]</span></p>
<p><span class="math display">\[\mathbf{\epsilon}=\begin{pmatrix}
\epsilon_{1}\\
\epsilon_{2}\\
\vdots\\
\epsilon_{n}\\
\end{pmatrix}\]</span></p>
</div></div>
</section>
<section id="linear-model-in-matrix-form-1" class="slide level2">
<h2>⚠️ Linear model in matrix form</h2>
<p>Putting it all together gives us this beast 👹: <span class="math display">\[\begin{pmatrix}
y_{1}\\
y_{2}\\
\vdots\\
y_{n}\\
\end{pmatrix}=\begin{pmatrix}
1 &amp; x_{11} &amp; x_{12} &amp; \ldots &amp; x_{1p}\\
1 &amp; x_{21} &amp; x_{22} &amp; \ldots &amp; x_{2p}\\
\vdots &amp; \vdots &amp; \ldots &amp; \vdots\\
1 &amp; x_{n1} &amp; x_{n2} &amp; \ldots &amp; x_{np}\\
\end{pmatrix}\begin{pmatrix}
\beta_{0}\\
\beta_{1}\\
\vdots\\
\beta_{p}\\
\end{pmatrix}+\begin{pmatrix}
\epsilon_{1}\\
\epsilon_{2}\\
\vdots\\
\epsilon_{n}\\
\end{pmatrix}\]</span></p>
</section>
<section id="minimize-sum-of-squared-residuals" class="slide level2 smaller">
<h2>⚠️ Minimize sum of squared residuals</h2>
<p>Our goal is to choose a <span class="math inline">\(\mathbf{\beta}\)</span> vector that minimizes the sum of squared residuals, <span class="math inline">\(SSR\)</span>, which is just given by the <span class="math inline">\(\epsilon\)</span> vector squared and summed up. We can rewrite the matrix algebra formula to isolate <span class="math inline">\(e\)</span> on one side:</p>
<p><span class="math display">\[\begin{align*}
\mathbf{y}&amp;=&amp;\mathbf{X\beta+\epsilon}\\
\epsilon&amp;=&amp;\mathbf{y}-\mathbf{X\beta}
\end{align*}\]</span></p>
<div class="fragment">
<p>In matrix form, <span class="math inline">\(SSR\)</span> can be represented as a function of <span class="math inline">\(\mathbf{\beta}\)</span>, like so:</p>
<p><span class="math display">\[\begin{align*}
SSR(\beta)&amp;=&amp;(\mathbf{y}-\mathbf{X\beta})'(\mathbf{y}-\mathbf{X\beta})\\
&amp;=&amp;\mathbf{y}'\mathbf{y}-2\mathbf{y}'\mathbf{X\beta}+\mathbf{\beta}'\mathbf{X'X\beta}
\end{align*}\]</span></p>
</div>
</section>
<section id="minimize-sum-of-squared-residuals-1" class="slide level2 smaller">
<h2>⚠️ Minimize sum of squared residuals</h2>
<p><span class="math display">\[\begin{align*}
SSR(\beta)&amp;=&amp;(\mathbf{y}-\mathbf{X\beta})'(\mathbf{y}-\mathbf{X\beta})\\
&amp;=&amp;\mathbf{y}'\mathbf{y}-2\mathbf{y}'\mathbf{X\beta}+\mathbf{\beta}'\mathbf{X'X\beta}
\end{align*}\]</span></p>
<p>We want to choose a <span class="math inline">\(\mathbf{\beta}\)</span> to plug into this function that provides the smallest possible value (the minimum).</p>
<div class="fragment">
<p>It turns out that we can get this value by using calculus to get the derivative with respect to <span class="math inline">\(\mathbf{\beta}\)</span> and solving for zero:</p>
<p><span class="math display">\[0=-2\mathbf{X'y}+2\mathbf{X'X\beta}\]</span></p>
</div>
<div class="fragment">
<p>Applying some matrix algebra will give us the estimator of <span class="math inline">\(\mathbf{\beta}\)</span>:</p>
<p><span class="math display">\[\mathbf{\beta}=(\mathbf{X'X})^{-1}\mathbf{X'y}\]</span></p>
</div>
</section>
<section id="estimating-linear-models-manually" class="slide level2">
<h2>Estimating linear models manually</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">#set up the design matrix</span></span>
<span id="cb6-2"><a href="" aria-hidden="true" tabindex="-1"></a>X <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(<span class="fu">cbind</span>(<span class="fu">rep</span>(<span class="dv">1</span>, <span class="fu">nrow</span>(movies)), movies[,<span class="fu">c</span>(<span class="st">"runtime"</span>,<span class="st">"box_office"</span>)]))</span>
<span id="cb6-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">#the outcome variable vector</span></span>
<span id="cb6-4"><a href="" aria-hidden="true" tabindex="-1"></a>y <span class="ot">&lt;-</span> movies<span class="sc">$</span>metascore</span>
<span id="cb6-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">#crossprod(X) will do matrix multiplication, solve will invert</span></span>
<span id="cb6-6"><a href="" aria-hidden="true" tabindex="-1"></a>beta <span class="ot">&lt;-</span> <span class="fu">solve</span>(<span class="fu">crossprod</span>(X))<span class="sc">%*%</span><span class="fu">crossprod</span>(X,y)</span>
<span id="cb6-7"><a href="" aria-hidden="true" tabindex="-1"></a>beta</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            [,1]
rep(1, nrow(movies)) 23.73138142
runtime               0.26247977
box_office            0.02140985</code></pre>
</div>
</div>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="co">#how does it compare to lm?</span></span>
<span id="cb8-2"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(metascore<span class="sc">~</span>runtime<span class="sc">+</span>box_office, <span class="at">data=</span>movies)</span>
<span id="cb8-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)     runtime  box_office 
23.73138142  0.26247977  0.02140985 </code></pre>
</div>
</div>
</div>
</section>
<section id="estimating-standard-errors" class="slide level2 smaller">
<h2>⚠️ Estimating standard errors</h2>
<p>If we treat <span class="math inline">\(\sigma^2\)</span> as the variance of the error term <span class="math inline">\(\epsilon\)</span>, then we can also use matrix algebra to calculate the <strong>covariance matrix</strong>:</p>
<p><span class="math display">\[\sigma^{2}(\mathbf{X'X})^{-1}\]</span></p>
<p>The values of this matrix give us information about the correlation between different independent variables. Most importantly, the square root of the diagonal values of this matrix are the standard errors for the estimated values of <span class="math inline">\(\beta\)</span>.</p>
<p>In practice, we don’t have <span class="math inline">\(\sigma^2\)</span>, but we can estimate from the fitted values of <span class="math inline">\(y\)</span> by:</p>
<p><span class="math display">\[s^2=\frac{\sum(y_i-\hat{y}_i)^2}{n-p-1}\]</span> We can then use these estimated standard errors to calculate t-statistics and p-values, confidence intervals, and so on.</p>
</section>
<section id="calculating-ses-manually" class="slide level2 smaller">
<h2>Calculating SEs manually</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="" aria-hidden="true" tabindex="-1"></a>y.hat <span class="ot">&lt;-</span> X<span class="sc">%*%</span>beta</span>
<span id="cb10-2"><a href="" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">length</span>(y)<span class="sc">-</span><span class="fu">ncol</span>(X)</span>
<span id="cb10-3"><a href="" aria-hidden="true" tabindex="-1"></a>s.sq <span class="ot">&lt;-</span> <span class="fu">sum</span>((y<span class="sc">-</span>y.hat)<span class="sc">^</span><span class="dv">2</span>)<span class="sc">/</span>df</span>
<span id="cb10-4"><a href="" aria-hidden="true" tabindex="-1"></a>covar.matrix <span class="ot">&lt;-</span> s.sq<span class="sc">*</span><span class="fu">solve</span>(<span class="fu">crossprod</span>(X))</span>
<span id="cb10-5"><a href="" aria-hidden="true" tabindex="-1"></a>se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">diag</span>(covar.matrix))</span>
<span id="cb10-6"><a href="" aria-hidden="true" tabindex="-1"></a>t.stat <span class="ot">&lt;-</span> beta<span class="sc">/</span>se</span>
<span id="cb10-7"><a href="" aria-hidden="true" tabindex="-1"></a>p.value <span class="ot">&lt;-</span> <span class="dv">2</span><span class="sc">*</span><span class="fu">pt</span>(<span class="sc">-</span><span class="dv">1</span><span class="sc">*</span><span class="fu">abs</span>(t.stat), df)</span>
<span id="cb10-8"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">data.frame</span>(beta, se, t.stat, p.value)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                            beta          se    t.stat      p.value
rep(1, nrow(movies)) 23.73138142 1.699964486 13.959928 2.340912e-43
runtime               0.26247977 0.016172067 16.230441 1.475991e-57
box_office            0.02140985 0.003499562  6.117865 1.031974e-09</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)<span class="sc">$</span>coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Estimate  Std. Error   t value     Pr(&gt;|t|)
(Intercept) 23.73138142 1.699964486 13.959928 2.340912e-43
runtime      0.26247977 0.016172067 16.230441 1.475991e-57
box_office   0.02140985 0.003499562  6.117865 1.031974e-09</code></pre>
</div>
</div>
</section></section>
<section>
<section id="modeling-non-linearity" class="title-slide slide level1 center" data-background-color="black" data-background-image="images/fabian-quintero-nq02weVF_mk-unsplash.jpg">
<h1>Modeling Non-Linearity</h1>

</section>
<section id="linear-models-fit-straight-lines" class="slide level2">
<h2>Linear models fit straight lines</h2>

<img data-src="slides_model_complications_files/figure-revealjs/fig-life-exp-non-linear-1.png" width="2304" class="r-stretch quarto-figure-center" id="fig-life-exp-non-linear"><p class="caption">
Figure&nbsp;2: The relationship between life expectancy and GDP per capita is clearly not a straight line!
</p><aside class="notes">
<ul>
<li>If you try to model a relationship using a straight line when that relationship is more complex (i.e.&nbsp;“bendy”) then your model will not fit well and will not represent the relationship accurately.</li>
<li>The technical way of saying this is that the functional form of the relationship is mis-specified in the model.</li>
<li>The most common cases of non-linearity are <strong>diminishing returns</strong> and <strong>exponential</strong> relationships, although more complex forms of non-linearity are also possible.</li>
<li>The example to the left shows a clear diminishing returns between life expectancy and GDP per capita.</li>
</ul>
<style type="text/css">
        span.MJX_Assistive_MathML {
          position:absolute!important;
          clip: rect(1px, 1px, 1px, 1px);
          padding: 1px 0 0 0!important;
          border: 0!important;
          height: 1px!important;
          width: 1px!important;
          overflow: hidden!important;
          display:block!important;
      }</style></aside>
</section>
<section id="non-linearity-can-be-hard-to-detect" class="slide level2">
<h2>Non-linearity can be hard to detect</h2>

<img data-src="slides_model_complications_files/figure-revealjs/fig-non-linear-movies-1.png" width="2304" class="r-stretch quarto-figure-center" id="fig-non-linear-movies"><p class="caption">
Figure&nbsp;3: Is this relationship non-linear?
</p></section>
<section id="two-techniques-for-detecting-non-linearity" class="slide level2">
<h2>Two techniques for detecting non-linearity</h2>
<div class="columns">
<div class="column fragment">
<h3 id="non-linear-smoothing">Non-linear smoothing</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-8-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column fragment">
<h3 id="diagnostic-residual-plot">Diagnostic residual plot</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-9-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="non-linear-smoothing-1" class="slide level2">
<h2>Non-linear smoothing</h2>
<ul>
<li class="fragment">A smoothing function uses the values of the <span class="math inline">\(y\)</span> for the closest neighbors for a given observation of <span class="math inline">\(x\)</span> to calculate a smoothed value of <span class="math inline">\(y\)</span> that will reduce extreme values.</li>
<li class="fragment">Smoothing functions vary by
<ul>
<li class="fragment">What function is used to calculate the smoothed values (e.g.&nbsp;mean, median)</li>
<li class="fragment">The span of how many neighbors are considered. Larger spans will lead to smoother lines.</li>
</ul></li>
</ul>
</section>
<section id="median-smoothing-box-office-returns-for-rush-hour-3" class="slide level2">
<h2>Median smoothing box office returns for <em>Rush Hour 3</em></h2>
<div class="columns">
<div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/rushhour3.jpg"></p>
<figcaption>Rush Hour 3 Poster</figcaption>
</figure>
</div>
</div><div class="column" style="width:70%;">
<div class="cell">
<div id="tbl-smooth-rush-hour-3" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-smooth-rush-hour-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1: Calculating smoothed box office returns for Rush Hour 3 with two neighbors either way.
</figcaption>
<div aria-describedby="tbl-smooth-rush-hour-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="cvxwrqzpfo" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#cvxwrqzpfo table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#cvxwrqzpfo thead, #cvxwrqzpfo tbody, #cvxwrqzpfo tfoot, #cvxwrqzpfo tr, #cvxwrqzpfo td, #cvxwrqzpfo th {
  border-style: none;
}

#cvxwrqzpfo p {
  margin: 0;
  padding: 0;
}

#cvxwrqzpfo .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#cvxwrqzpfo .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#cvxwrqzpfo .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#cvxwrqzpfo .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#cvxwrqzpfo .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cvxwrqzpfo .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cvxwrqzpfo .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#cvxwrqzpfo .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#cvxwrqzpfo .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#cvxwrqzpfo .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#cvxwrqzpfo .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#cvxwrqzpfo .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#cvxwrqzpfo .gt_spanner_row {
  border-bottom-style: hidden;
}

#cvxwrqzpfo .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#cvxwrqzpfo .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#cvxwrqzpfo .gt_from_md > :first-child {
  margin-top: 0;
}

#cvxwrqzpfo .gt_from_md > :last-child {
  margin-bottom: 0;
}

#cvxwrqzpfo .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#cvxwrqzpfo .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#cvxwrqzpfo .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#cvxwrqzpfo .gt_row_group_first td {
  border-top-width: 2px;
}

#cvxwrqzpfo .gt_row_group_first th {
  border-top-width: 2px;
}

#cvxwrqzpfo .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cvxwrqzpfo .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#cvxwrqzpfo .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#cvxwrqzpfo .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cvxwrqzpfo .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#cvxwrqzpfo .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#cvxwrqzpfo .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#cvxwrqzpfo .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#cvxwrqzpfo .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#cvxwrqzpfo .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cvxwrqzpfo .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cvxwrqzpfo .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#cvxwrqzpfo .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#cvxwrqzpfo .gt_left {
  text-align: left;
}

#cvxwrqzpfo .gt_center {
  text-align: center;
}

#cvxwrqzpfo .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#cvxwrqzpfo .gt_font_normal {
  font-weight: normal;
}

#cvxwrqzpfo .gt_font_bold {
  font-weight: bold;
}

#cvxwrqzpfo .gt_font_italic {
  font-style: italic;
}

#cvxwrqzpfo .gt_super {
  font-size: 65%;
}

#cvxwrqzpfo .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#cvxwrqzpfo .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#cvxwrqzpfo .gt_indent_1 {
  text-indent: 5px;
}

#cvxwrqzpfo .gt_indent_2 {
  text-indent: 10px;
}

#cvxwrqzpfo .gt_indent_3 {
  text-indent: 15px;
}

#cvxwrqzpfo .gt_indent_4 {
  text-indent: 20px;
}

#cvxwrqzpfo .gt_indent_5 {
  text-indent: 25px;
}

#cvxwrqzpfo .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#cvxwrqzpfo div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="title" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col">Title</th>
<th id="rating_imdb" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">IMDB Rating</th>
<th id="box_office" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Box Office (millions)</th>
<th id="box_office_smooth" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">Smoothed Box Office (median)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers="title">Nobel Son</td>
<td class="gt_row gt_right" headers="rating_imdb">6.2</td>
<td class="gt_row gt_right" headers="box_office">$0.5</td>
<td class="gt_row gt_right" headers="box_office_smooth">-</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="title">Resident Evil: Extinction</td>
<td class="gt_row gt_right" headers="rating_imdb">6.2</td>
<td class="gt_row gt_right" headers="box_office">$50.6</td>
<td class="gt_row gt_right" headers="box_office_smooth">-</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="title">Rush Hour 3</td>
<td class="gt_row gt_right" headers="rating_imdb">6.2</td>
<td class="gt_row gt_right" headers="box_office">$140.1</td>
<td class="gt_row gt_right" headers="box_office_smooth">$50.6</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers="title">Spider-Man 3</td>
<td class="gt_row gt_right" headers="rating_imdb">6.2</td>
<td class="gt_row gt_right" headers="box_office">$336.5</td>
<td class="gt_row gt_right" headers="box_office_smooth">-</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers="title">The Last Mimzy</td>
<td class="gt_row gt_right" headers="rating_imdb">6.2</td>
<td class="gt_row gt_right" headers="box_office">$21.5</td>
<td class="gt_row gt_right" headers="box_office_smooth">-</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</div></div>
</section>
<section id="applying-a-median-smoother" class="slide level2">
<h2>Applying a median smoother</h2>

<img data-src="slides_model_complications_files/figure-revealjs/fig-median-smoothing-1.png" width="2304" class="r-stretch quarto-figure-center" id="fig-median-smoothing"><p class="caption">
Figure&nbsp;4: Different median smoothers over scatterplot movie box office returns by IMDB rating
</p></section>
<section id="the-loess-smoother" class="slide level2 smaller">
<h2>The LOESS smoother</h2>
<div class="columns">
<div class="column">
<h3 id="locally-estimated-scatterplot-smoothing">LOcally Estimated Scatterplot Smoothing</h3>
<ul>
<li class="fragment">Each smoothed value is determined from a model that includes:
<ul>
<li class="fragment">polynomial terms (more on that later)</li>
<li class="fragment">weighting of observations by distance from focal point</li>
</ul></li>
<li class="fragment">LOESS does very nice smoothing but is computationally expensive</li>
<li class="fragment">Because of the weighting, LOESS can and does take a very large span of data for each focal point</li>
</ul>
</div><div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb14" data-code-line-numbers="3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href=""></a><span class="fu">ggplot</span>(movies, <span class="fu">aes</span>(<span class="at">x=</span>rating_imdb, <span class="at">y=</span>box_office))<span class="sc">+</span></span>
<span id="cb14-2"><a href=""></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.2</span>)<span class="sc">+</span></span>
<span id="cb14-3"><a href=""></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"loess"</span>, <span class="at">se=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb14-4"><a href=""></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"IMDB Rating"</span>, </span>
<span id="cb14-5"><a href=""></a>       <span class="at">y=</span><span class="st">"Box Office Returns (millions USD)"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-loess" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-loess-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="slides_model_complications_files/figure-revealjs/fig-loess-1.png" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-loess-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;5: Use LOESS smoothing for nice smooth lines
</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="adjusting-span" class="slide level2 smaller">
<h2>Adjusting span <i class="fa-solid fa-user-ninja" aria-label="user-ninja"></i></h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb15" data-code-line-numbers="4-9"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href=""></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(gapminder, year<span class="sc">==</span><span class="dv">2007</span>), </span>
<span id="cb15-2"><a href=""></a>       <span class="fu">aes</span>(<span class="at">x=</span>gdpPercap, <span class="at">y=</span>lifeExp))<span class="sc">+</span></span>
<span id="cb15-3"><a href=""></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb15-4"><a href=""></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"loess"</span>, <span class="at">span=</span><span class="dv">1</span>, </span>
<span id="cb15-5"><a href=""></a>              <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">"green"</span>)<span class="sc">+</span></span>
<span id="cb15-6"><a href=""></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"loess"</span>, <span class="at">span=</span><span class="fl">0.75</span>, </span>
<span id="cb15-7"><a href=""></a>              <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb15-8"><a href=""></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"loess"</span>, <span class="at">span=</span><span class="fl">0.25</span>, </span>
<span id="cb15-9"><a href=""></a>              <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb15-10"><a href=""></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"GDP per capita"</span>, </span>
<span id="cb15-11"><a href=""></a>       <span class="at">y=</span><span class="st">"Life expectancy at birth"</span>)<span class="sc">+</span></span>
<span id="cb15-12"><a href=""></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>dollar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The default <code>span</code> is 0.75 which is 75% of observations.</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/adjust-span-exec-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="loess-with-large-n-will-your" class="slide level2 smaller">
<h2>⚠️ LOESS with large <code>n</code> will 💀 your 💻</h2>
<div class="columns">
<div class="column">
<h3 class="smaller" id="use-a-gam-instead">Use a GAM instead</h3>
<p>Generalized Additive Models (GAM) are another way to create non-linear smoothing that is less computational intensive that LOESS but with similar results.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16" data-code-line-numbers="6-7"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href=""></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(gapminder, year<span class="sc">==</span><span class="dv">2007</span>), </span>
<span id="cb16-2"><a href=""></a>       <span class="fu">aes</span>(<span class="at">x=</span>gdpPercap, <span class="at">y=</span>lifeExp))<span class="sc">+</span></span>
<span id="cb16-3"><a href=""></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb16-4"><a href=""></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"loess"</span>,</span>
<span id="cb16-5"><a href=""></a>              <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb16-6"><a href=""></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"gam"</span>,</span>
<span id="cb16-7"><a href=""></a>              <span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb16-8"><a href=""></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"GDP per capita"</span>, </span>
<span id="cb16-9"><a href=""></a>       <span class="at">y=</span><span class="st">"Life expectancy at birth"</span>)<span class="sc">+</span></span>
<span id="cb16-10"><a href=""></a>  <span class="fu">scale_x_continuous</span>(<span class="at">labels=</span>scales<span class="sc">::</span>dollar)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/gam-example-exec-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="or-let-geom_smooth-figure-out-best-smoother" class="slide level2 smaller">
<h2>Or let <code>geom_smooth</code> figure out best smoother</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(earnings, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>wages))<span class="sc">+</span></span>
<span id="cb17-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.01</span>, <span class="at">width=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb17-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>, </span>
<span id="cb17-4"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">"blue"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb17-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>, <span class="at">color=</span><span class="st">"red"</span>, <span class="at">linewidth =</span> <span class="fl">1.5</span>)<span class="sc">+</span></span>
<span id="cb17-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>dollar)<span class="sc">+</span></span>
<span id="cb17-7"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"age"</span>, <span class="at">y=</span><span class="st">"hourly wages"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment">For datasets over 1000 observations, <code>geom_smooth</code> will use GAM and otherwise defaults to LOESS.</li>
<li class="fragment">Don’t forget you can also specify a linear fit with <code>method="lm"</code>.</li>
</ul>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/geom-smooth-exec-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="residual-plots" class="slide level2">
<h2>Residual plots</h2>
<div class="columns">
<div class="column">
<ul>
<li class="fragment">A scatterplot of the residuals vs.&nbsp;the fitted values from a model can also be useful for detecting non-linearity.</li>
<li class="fragment">If the relationship is linear, then we should expect to see no sign of a relationship in this plot. Drawing a smoothed line can be useful for this diagnosis.</li>
<li class="fragment">Residual plots can also help to detect <strong>heteroskedasticity</strong> which we will talk about later.</li>
</ul>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div id="fig-resid-plot-le" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-resid-plot-le-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="slides_model_complications_files/figure-revealjs/fig-resid-plot-le-1.png" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-resid-plot-le-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;6: Residual plots can be used for multiple diagnostic purposes
</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="using-broom-and-augment-to-get-model-data" class="slide level2">
<h2>Using <code>broom</code> and <code>augment</code> to get model data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(broom)</span>
<span id="cb18-2"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(lifeExp<span class="sc">~</span>gdpPercap, <span class="at">data=</span><span class="fu">subset</span>(gapminder, year<span class="sc">==</span><span class="dv">2007</span>))</span>
<span id="cb18-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 142 × 8
   lifeExp gdpPercap .fitted  .resid    .hat .sigma   .cooksd .std.resid
     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;      &lt;dbl&gt;
 1    43.8      975.    60.2 -16.4   0.0120    8.82 0.0207       -1.85  
 2    76.4     5937.    63.3  13.1   0.00846   8.86 0.00928       1.48  
 3    72.3     6223.    63.5   8.77  0.00832   8.90 0.00411       0.990 
 4    42.7     4797.    62.6 -19.9   0.00907   8.77 0.0231       -2.25  
 5    75.3    12779.    67.7   7.61  0.00709   8.91 0.00263       0.858 
 6    81.2    34435.    81.5  -0.271 0.0292    8.93 0.0000144    -0.0309
 7    79.8    36126.    82.6  -2.75  0.0327    8.93 0.00167      -0.315 
 8    75.6    29796.    78.5  -2.91  0.0211    8.93 0.00118      -0.331 
 9    64.1     1391.    60.5   3.61  0.0116    8.93 0.000975      0.408 
10    79.4    33693.    81.0  -1.59  0.0278    8.93 0.000471     -0.181 
# ℹ 132 more rows</code></pre>
</div>
</div>
</section>
<section id="creating-a-residual-plot" class="slide level2">
<h2>Creating a residual plot</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">augment</span>(model), </span>
<span id="cb20-2"><a href="" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>.fitted, <span class="at">y=</span>.resid))<span class="sc">+</span></span>
<span id="cb20-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb20-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb20-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb20-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"fitted values of life expectancy"</span>, </span>
<span id="cb20-7"><a href="" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"model residuals"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-22-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="its-non-linear-so-now-what" class="slide level2">
<h2>Its non-linear, so now what?</h2>
<div class="columns">
<div class="column frament">
<h3 id="transform-variables">Transform variables</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-23-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column fragment">
<h3 id="polynomial-terms">Polynomial terms</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-24-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column fragment">
<h3 id="create-splines">Create splines</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-25-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="transforming-variables" class="slide level2 smaller">
<h2>Transforming variables</h2>
<div class="columns">
<div class="column" style="width:30%;">
<p><img data-src="images/werewolf-transformation.jpg"></p>
</div><div class="column" style="width:70%;">
<p>A transformation is a mathematical function that changes the value of a quantitative variable. There are many transformations that one could apply, but we will focus on one - the <strong>log</strong> transformation. This is the most common transformation used in the social sciences.</p>
<p>Transformations are popular because they can solve multiple problems:</p>
<ul>
<li class="fragment">A transformation can make a non-linear relationship look linear.</li>
<li class="fragment">A transformation can make a skewed distribution more symmetric.</li>
<li class="fragment">A transformation can reduce the impact of extreme outliers.</li>
</ul>
</div></div>
</section>
<section id="plotting-the-log-transformation" class="slide level2">
<h2>Plotting the log transformation</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb21" data-code-line-numbers="5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href=""></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(gapminder, year<span class="sc">==</span><span class="dv">2007</span>), </span>
<span id="cb21-2"><a href=""></a>       <span class="fu">aes</span>(<span class="at">x=</span>gdpPercap, <span class="at">y=</span>lifeExp))<span class="sc">+</span></span>
<span id="cb21-3"><a href=""></a>  <span class="fu">geom_point</span>(<span class="at">alpha=</span><span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb21-4"><a href=""></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb21-5"><a href=""></a>  <span class="fu">scale_x_log10</span>(<span class="at">labels=</span>scales<span class="sc">::</span>dollar)<span class="sc">+</span><span class="co">#&lt;&lt;</span></span>
<span id="cb21-6"><a href=""></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"GDP per capita (log scale)"</span>, </span>
<span id="cb21-7"><a href=""></a>       <span class="at">y=</span><span class="st">"Life expectancy at birth"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment">The scale of the independent variable is now multiplicative</li>
<li class="fragment">The relationship looks more linear now, but what does it mean?</li>
</ul>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-27-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="the-natural-log" class="slide level2 smaller">
<h2>The natural log</h2>
<div class="columns">
<div class="column" style="width:30%;">
<p><img data-src="images/logs.png"></p>
</div><div class="column" style="width:70%;">
<p>Although <code>ggplot</code> uses log with a base 10, we usually use the <em>natural log</em> transformation in practice. Both transformations have the same effect on the relationship, but the natural log provides results that are easier to interpret.</p>
<div class="fragment">
<p>In R, it is easy to take the natural log of a number by just using the <code>log</code> command. Any positive number can be logged.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.609438</code></pre>
</div>
</div>
<p>The natural log of 5 is 1.609, but what does this mean?</p>
</div>
<div class="fragment">
<p>The natural log of any number is the power that you would have to raise the constant <span class="math inline">\(e\)</span> to in order to get the original number back. In R, we can calculate <span class="math inline">\(e^x\)</span> with <code>exp(x)</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">log</span>(<span class="dv">5</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5</code></pre>
</div>
</div>
</div>
</div></div>
</section>
<section id="logs-make-multiplicative-relationships-additive" class="slide level2">
<h2>logs make multiplicative relationships additive</h2>
<div class="columns">
<div class="column" style="width:30%;">
<p><img data-src="images/lincoln_logs.jpg"></p>
</div><div class="column" style="width:70%;">
<p>The key feature of the log transformation is that it makes multiplicative relationships additive.</p>
<p><span class="math display">\[log(x*y)=log(x)+log(y)\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">5</span><span class="sc">*</span><span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.995732</code></pre>
</div>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">log</span>(<span class="dv">5</span>)<span class="sc">+</span><span class="fu">log</span>(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2.995732</code></pre>
</div>
</div>
<p>We can use this feature to model relative (percent) change rather than absolute change in our models.</p>
</div></div>
</section>
<section id="logging-box-office-returns-gives-us-a-linear-fit" class="slide level2">
<h2>Logging box office returns gives us a linear fit</h2>

<img data-src="slides_model_complications_files/figure-revealjs/fig-box-office-log-1.png" width="2304" class="r-stretch quarto-figure-center" id="fig-box-office-log"><p class="caption">
Figure&nbsp;7: Note the logarithmic scale on the y-axis
</p></section>
<section id="what-does-it-mean-for-the-model" class="slide level2">
<h2>What does it mean for the model?</h2>
<p>To fit the model, we can just use the log transformation directly in the formula of our <code>lm</code> command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(box_office)<span class="sc">~</span>rating_imdb, <span class="at">data=</span>movies)</span>
<span id="cb30-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept) rating_imdb 
 0.01557736  0.37140161 </code></pre>
</div>
</div>
<p><span class="math display">\[\log(\hat{returns}_i)=0.016+0.371(rating_i)\]</span></p>
<p>How do we interpret the slope?</p>
<div class="fragment">
<blockquote>
<p>A one point increase in IMDB rating is associated with a 0.371 increase in … the log of box office returns? 😕</p>
</blockquote>
</div>
</section>
<section id="converting-to-the-original-scale" class="slide level2 smaller">
<h2>Converting to the original scale</h2>
<p>To get back to the original scale of box office returns for the dependent variable, we need to exponentiate both side side of the regression equation by <span class="math inline">\(e\)</span>:</p>
<p><span class="math display">\[e^{\log(\hat{returns}_i)}=e^{0.016+0.371(rating_i)}\]</span></p>
<div class="fragment">
<p>On the left hand side, I will get back predicted box office returns by the definition of logs. On the right hand side, I can apply some of the mathematical properties of logarithms and powers.</p>
<p><span class="math display">\[\hat{returns}_i=(e^{0.016})(e^{0.371})^{rating_i}\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fl">0.016</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.016129</code></pre>
</div>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fl">0.371</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1.449183</code></pre>
</div>
</div>
</div>
<div class="fragment">
<p>I now have: <span class="math display">\[\hat{returns}_i=(1.016)(1.449)^{rating_i}\]</span></p>
</div>
</section>
<section id="a-multiplicative-relationship" class="slide level2 smaller">
<h2>A multiplicative relationship</h2>
<p><span class="math display">\[\hat{returns}_i=(1.016)(1.449)^{rating_i}\]</span></p>
<p>Lets calculate predicted box office returns for IMDB Ratings of 0, 1, and 2.</p>
<div class="fragment">
<p><span class="math inline">\(\hat{returns}_i=(1.016)(1.449)^{0}=1.016\)</span></p>
</div>
<div class="fragment">
<p><span class="math inline">\(\hat{returns}_i=(1.016)(1.449)^{1}=1.449(1.449)\)</span></p>
</div>
<div class="fragment">
<p><span class="math inline">\(\hat{returns}_i=(1.016)(1.449)^{2}=1.449(1.449)(1.449)\)</span></p>
</div>
<ul>
<li class="fragment">For each one unit increase in the independent variable, you multiply the previous predicted value by 1.449 to get the new predicted value. Therefore the predicted value increases by 44.9%.</li>
<li class="fragment">The model predicts that movies with a zero IMDB rating make 1.02 million dollars, on average. Every one point increase in the IMDB rating is associated with a 44.9% increase in box office returns, on average.</li>
</ul>
</section>
<section id="general-form-and-interpretation" class="slide level2">
<h2>General form and interpretation</h2>
<p><span class="math display">\[\log(\hat{y}_i)=b_0+b_1(x_i)\]</span></p>
<ul>
<li class="fragment">You must apply the <code>exp</code> command to your intercept and slopes in order to interpret them.</li>
<li class="fragment">The model predicts that the mean of <span class="math inline">\(y\)</span> when <span class="math inline">\(x\)</span> is zero will be <span class="math inline">\(e^{b_0}\)</span>.</li>
<li class="fragment">The model predicts that each one unit increase in <span class="math inline">\(x\)</span> is associated with a multiplicative change of <span class="math inline">\(e^{b_1}\)</span> in <span class="math inline">\(y\)</span>. It is often easiest to express this in percentage terms.</li>
<li class="fragment">An <strong>absolute</strong> change in <span class="math inline">\(x\)</span> is associated with a <strong>relative</strong> change in <span class="math inline">\(y\)</span>.</li>
</ul>
</section>
<section id="interpret-these-numbers" class="slide level2 smaller">
<h2>Interpret these numbers</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(<span class="fu">log</span>(box_office)<span class="sc">~</span><span class="fu">relevel</span>(maturity_rating, <span class="st">"PG"</span>), <span class="at">data=</span>movies))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                        (Intercept)     relevel(maturity_rating, "PG")G 
                          3.2822510                           0.7482935 
relevel(maturity_rating, "PG")PG-13     relevel(maturity_rating, "PG")R 
                         -0.2725515                          -1.7874802 </code></pre>
</div>
</div>
<p><span class="math display">\[\log(\hat{returns}_i)=3.22+0.50(G_i)-0.24(PG13_i)-1.93(R_i)\]</span></p>
<ul>
<li class="fragment"><span class="math inline">\(e^{3.28}=26.58\)</span>: PG-rated movies make 26.58 million dollars on average.</li>
<li class="fragment"><span class="math inline">\(e^{0.75}=2.12\)</span>: G-rated movies make 112% more than PG-rated movies, on average.</li>
<li class="fragment"><span class="math inline">\(e^{-0.27}=0.76\)</span>: PG-13 rated movies make 76% as much as (or 24% less than) PG-rated movies, on average.</li>
<li class="fragment"><span class="math inline">\(e^{-1.79}=0.17\)</span>: R-rated movies make 17% as much as (or 83% less than) PG-rated movies, on average.</li>
</ul>
</section>
<section id="approximating-small-effects" class="slide level2 smaller">
<h2>Approximating small effects</h2>
<p>When <span class="math inline">\(x\)</span> is small (say <span class="math inline">\(x&lt;0.2\)</span>), then <span class="math inline">\(e^x\approx1+x\)</span>.</p>
<p>We can use this fact to roughly approximate coefficients/slopes as percent change when they are small.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(box_office)<span class="sc">~</span>runtime, <span class="at">data=</span>movies)</span>
<span id="cb38-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)     runtime 
 -1.7528129   0.0383472 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)     runtime 
  0.1732858   1.0390919 </code></pre>
</div>
</div>
<ul>
<li class="fragment">If we do the full exponentiating, we can see that a one minute increase in runtime is associated with a 3.9% increase in box office returns.</li>
<li class="fragment">The actual percentage increase is very close to what we got for the slope of the non-exponentiated slope (0.038). So, you can often get a ballpark estimate without having to exponentiate.</li>
</ul>
</section>
<section id="logging-the-independent-variable" class="slide level2 smaller">
<h2>Logging the independent variable</h2>
<div class="columns">
<div class="column" style="width:30%;">
<p>Lets return to the relationship between GDP per capita and life expectancy that fit well as a linear relationship when we logged GDP per capita. Lets run the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(lifeExp<span class="sc">~</span><span class="fu">log</span>(gdpPercap), </span>
<span id="cb42-2"><a href="" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span><span class="fu">subset</span>(gapminder, </span>
<span id="cb42-3"><a href="" aria-hidden="true" tabindex="-1"></a>                        year<span class="sc">==</span><span class="dv">2007</span>))</span>
<span id="cb42-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">round</span>(<span class="fu">coef</span>(model), <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) log(gdpPercap) 
       4.94961        7.20280 </code></pre>
</div>
</div>
</div><div class="column fragment" style="width:70%;">
<p>How do we interpret these results? This case requires something different than the case where we logged the dependent variable.</p>
<p>Our basic model for life expectancy by GDP per capita is:</p>
<p><span class="math display">\[\hat{y}_i=4.9+7.2\log{x_i}\]</span> What is the predicted value of life expectancy at $1 GDP?</p>
<p><span class="math display">\[\hat{y}_i=4.9+7.2\log{1} = 4.9+7.2 * 0=4.9\]</span></p>
<p>What happens when we increase GDP per capita by 1% (from 1 to 1.01)?</p>
<p><span class="math display">\[\hat{y}_i=4.9+7.2\log{1.01} = 4.9+7.2 * 0.01=4.9+0.072\]</span></p>
<p>Predicted life expectancy increases by 0.072 years.</p>
</div></div>
</section>
<section id="the-1-increase-is-the-same-at-all-x" class="slide level2">
<h2>The 1% increase is the same at all <span class="math inline">\(x\)</span></h2>
<p>How much does <span class="math inline">\(y\)</span> increase when <span class="math inline">\(x\)</span> goes up by one percent?</p>
<p><span class="math display">\[(4.9+7.2\log{1.01x})-(4.9+7.2\log{x})\]</span> <span class="math display">\[7.2\log{1.01x}-7.2\log{x}\]</span> <span class="math display">\[7.2(\log{1.01}+\log{x})-7.2\log{x}\]</span></p>
<p><span class="math display">\[7.2\log{1.01}+7.2\log{x}-7.2\log{x}\]</span> <span class="math display">\[7.2\log{1.01} \approx 7.2 (0.01) = 0.072\]</span></p>
</section>
<section id="general-form-and-interpretation-1" class="slide level2">
<h2>General form and interpretation</h2>
<p><span class="math display">\[\hat{y}_i=b_0+b_1\log(x_i)\]</span></p>
<ul>
<li class="fragment">A one percent increase in <span class="math inline">\(x\)</span> is associated with a <span class="math inline">\(b_1/100\)</span> unit change in <span class="math inline">\(y\)</span>, on average.</li>
<li class="fragment">A <strong>relative</strong> change in <span class="math inline">\(x\)</span> is associated with an <strong>absolute</strong> change in <span class="math inline">\(y\)</span>.</li>
<li class="fragment"><span class="math inline">\(exp(b_0)\)</span> gives the predicted value of <span class="math inline">\(y\)</span> when <span class="math inline">\(x\)</span> equals one.</li>
<li class="fragment">Keep in mind that the <span class="math inline">\(log(0)\)</span> is negative infinity so you cannot predict the value of <span class="math inline">\(y\)</span> when <span class="math inline">\(x=0\)</span>.</li>
</ul>
</section>
<section id="logging-both-variables" class="slide level2">
<h2>Logging both variables</h2>

<img data-src="slides_model_complications_files/figure-revealjs/fig-log-both-1.png" width="2304" class="r-stretch quarto-figure-center" id="fig-log-both"><p class="caption">
Figure&nbsp;8: Logging both variables can sometimes solve multiple problems
</p></section>
<section id="the-elasticity-model" class="slide level2">
<h2>The elasticity model</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(wages)<span class="sc">~</span><span class="fu">log</span>(age), <span class="at">data=</span>earnings)</span>
<span id="cb44-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)    log(age) 
  1.1558386   0.5055849 </code></pre>
</div>
</div>
<ul>
<li class="fragment">This is actually the easiest model to interpret. We can interpret the slope directly as the percent change in <span class="math inline">\(y\)</span> for a one percent increase in <span class="math inline">\(x\)</span>.</li>
<li class="fragment">Calculating the percent change in one variable by percent change in another is what economists call an <strong>elasticity</strong> so this model is often called an <strong>elasticity</strong> model.</li>
<li class="fragment">The model predicts that a one percent increase in age is associated with a 0.51% increase in wages, on average.</li>
</ul>
</section>
<section id="a-cheat-sheet" class="slide level2">
<h2>A cheat sheet</h2>
<table class="caption-top">
<colgroup>
<col style="width: 25%">
<col style="width: 22%">
<col style="width: 14%">
<col style="width: 14%">
<col style="width: 23%">
</colgroup>
<thead>
<tr class="header">
<th>Which variable logged</th>
<th>Non-linear shape</th>
<th>Change in x</th>
<th>Change in y</th>
<th>Interpret <span class="math inline">\(\beta_1\)</span></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Independent variable</td>
<td>diminishing returns</td>
<td>relative</td>
<td>absolute</td>
<td><span class="math inline">\(\beta_1/100\)</span></td>
</tr>
<tr class="even">
<td>Dependent variable</td>
<td>exponential</td>
<td>absolute</td>
<td>relative</td>
<td><span class="math inline">\(e^{\beta_1}\)</span></td>
</tr>
<tr class="odd">
<td>Both variables</td>
<td>both types</td>
<td>relative</td>
<td>relative</td>
<td><span class="math inline">\(\beta_1\)</span></td>
</tr>
</tbody>
</table>
</section>
<section id="when-x0-logging-is-bad" class="slide level2 smaller">
<h2>When <span class="math inline">\(x&lt;=0\)</span>, logging is bad</h2>
<div class="columns">
<div class="column">
<h3 id="log-problems">Log problems</h3>
<p><span class="math display">\[log(0)=-\infty\]</span> <span class="math display">\[log(x)\text{ is undefined when }x&lt;0\]</span></p>
<h3 id="try-the-squarecube-root">Try the square/cube root</h3>
<ul>
<li class="fragment">The square root transformation has a similar effect to the log transformation but can include zero values.</li>
<li class="fragment">The cube root transformation can also include negative values.</li>
<li class="fragment">The downside of square/cube root transformations is that values are not easy to interpret.</li>
</ul>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/sqrt-transform-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="polynomial-models" class="slide level2 smaller">
<h2>Polynomial models</h2>
<div class="columns">
<div class="column" style="width:40%;">
<h3 id="polynomial-expression">Polynomial expression</h3>
<p>A <strong>polynomial</strong> expression is one that adds together terms involving multiple powers of a single variable.</p>
<p>if we include a squared value of <span class="math inline">\(x\)</span> we get the classic formula for a parabola:</p>
<p><span class="math display">\[y=a+bx+cx^2\]</span></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-39-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column fragment" style="width:60%;">
<h3 id="a-polynomial-model">A polynomial model</h3>
<p>We can fit such a parabola in a linear model by including a new variable that is simply the square of the original variable:</p>
<p><span class="math display">\[\hat{y}_i=\beta_0+\beta_1x_i+\beta_2x_i^2\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(wages<span class="sc">~</span><span class="fu">I</span>(age<span class="dv">-40</span>)<span class="sc">+</span><span class="fu">I</span>((age<span class="dv">-40</span>)<span class="sc">^</span><span class="dv">2</span>), </span>
<span id="cb46-2"><a href="" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>earnings)</span>
<span id="cb46-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    (Intercept)     I(age - 40) I((age - 40)^2) 
    26.92134254      0.31711167     -0.01783204 </code></pre>
</div>
</div>
<p>Our model is:</p>
<p><span class="math display">\[\hat{y}_i=26.9+0.3171(x_i-40)-0.0178(x_i-40)^2\]</span></p>
<p>How do we interpret the results?</p>
</div></div>
</section>
<section id="calculate-the-marginal-effect" class="slide level2 smaller">
<h2>Calculate the marginal effect</h2>
<p>With polynomial terms, the marginal effect of <span class="math inline">\(x\)</span> is more complicated because our <span class="math inline">\(x\)</span> shows up in more than one place in the equation:</p>
<p><span class="math display">\[y_i=\beta_0+\beta_1x_i+\beta_2x_i^2+\epsilon_i\]</span></p>
<div class="fragment">
<p>By calculus, we can mathemagically get the marginal effect for this model as:</p>
<p><span class="math display">\[\frac{\partial y}{\partial x}=\beta_1+2*\beta_2x\]</span></p>
</div>
<div class="fragment">
<p>So, for our case, the marginal effect of age on wages is given by:</p>
<p><span class="math display">\[0.3171+2*-0.0178(x-40)=0.3171-0.0356(x-40)\]</span></p>
<ul>
<li class="fragment">At age 40 (the zero value), a one year increase in age is associated with a salary increase of $0.32, on average.</li>
<li class="fragment">For every year over 40, this increase is smaller by $0.0356. For every age younger than 40, this increase is larger by $0.0356.</li>
</ul>
</div>
</section>
<section id="finding-the-inflection-point" class="slide level2 smaller">
<h2>Finding the inflection point</h2>
<div class="columns">
<div class="column">
<p>If the effect of age on wages goes down by $0.0356 for every year over 40, then at some point the positive effect of age on wages will become negative.</p>
<p>We can figure out the value of age at this <strong>inflection point</strong> by setting the effect to zero and solving for x. In general, this will give us:</p>
<p><span class="math display">\[\beta_1/(-2*\beta_2)\]</span></p>
<p>In our case, we get:</p>
<p><span class="math display">\[0.3171/(-2*-0.0178)=8.91\]</span></p>
<p>So the model predicts that the effect of age on wages will shift from positive to negative at age 48.91.</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-41-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="plotting-a-polynomial-fit" class="slide level2">
<h2>Plotting a polynomial fit</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb48" data-code-line-numbers="4-5"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href=""></a><span class="fu">ggplot</span>(earnings, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>wages))<span class="sc">+</span></span>
<span id="cb48-2"><a href=""></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.01</span>, <span class="at">width=</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb48-3"><a href=""></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>, </span>
<span id="cb48-4"><a href=""></a>              <span class="at">method=</span><span class="st">"lm"</span>,</span>
<span id="cb48-5"><a href=""></a>              <span class="at">formula=</span>y<span class="sc">~</span>x<span class="sc">+</span><span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>))<span class="sc">+</span> </span>
<span id="cb48-6"><a href=""></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"age"</span>, <span class="at">y=</span><span class="st">"hourly wages"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>in <code>geom_smooth</code>, you can specify a formula for the <code>lm</code> method that includes a squared term.</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-43-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="higher-order-terms-gives-you-more-wiggle" class="slide level2 smaller">
<h2>Higher order terms gives you more wiggle</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="fu">subset</span>(gapminder, year<span class="sc">==</span><span class="dv">2007</span>), </span>
<span id="cb49-2"><a href="" aria-hidden="true" tabindex="-1"></a>       <span class="fu">aes</span>(<span class="at">x=</span>gdpPercap, <span class="at">y=</span>lifeExp))<span class="sc">+</span></span>
<span id="cb49-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb49-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>, </span>
<span id="cb49-5"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">method=</span><span class="st">"lm"</span>, </span>
<span id="cb49-6"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula=</span>y<span class="sc">~</span>x<span class="sc">+</span><span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb49-7"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">"blue"</span>)<span class="sc">+</span></span>
<span id="cb49-8"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>, </span>
<span id="cb49-9"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">method=</span><span class="st">"lm"</span>, </span>
<span id="cb49-10"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula=</span>y<span class="sc">~</span>x<span class="sc">+</span><span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(x<span class="sc">^</span><span class="dv">3</span>),</span>
<span id="cb49-11"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">"red"</span>)<span class="sc">+</span></span>
<span id="cb49-12"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">se=</span><span class="cn">FALSE</span>, </span>
<span id="cb49-13"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">method=</span><span class="st">"lm"</span>, </span>
<span id="cb49-14"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">formula=</span>y<span class="sc">~</span>x<span class="sc">+</span><span class="fu">I</span>(x<span class="sc">^</span><span class="dv">2</span>)<span class="sc">+</span><span class="fu">I</span>(x<span class="sc">^</span><span class="dv">3</span>)<span class="sc">+</span><span class="fu">I</span>(x<span class="sc">^</span><span class="dv">4</span>),</span>
<span id="cb49-15"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">color=</span><span class="st">"green"</span>)<span class="sc">+</span></span>
<span id="cb49-16"><a href="" aria-hidden="true" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"GDP per capita"</span>, </span>
<span id="cb49-17"><a href="" aria-hidden="true" tabindex="-1"></a>         <span class="at">y=</span><span class="st">"life expectancy"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-45-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="spline-models" class="slide level2 smaller">
<h2>Spline models</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="cell-output-display">
<div id="fig-spline-wages" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-spline-wages-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="slides_model_complications_files/figure-revealjs/fig-spline-wages-1.png" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-spline-wages-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;9: Spline models create hinges or “broken arrows”
</figcaption>
</figure>
</div>
</div>
</div>
</div><div class="column">
<ul>
<li class="fragment">The basic idea of a spline model is to allow the slope of the relationship between <span class="math inline">\(x\)</span> and <span class="math inline">\(y\)</span> to be different at different cutpoints or “hinge” values of <span class="math inline">\(x\)</span>.</li>
<li class="fragment">These cutpoints create different linear segments where the effect of x on y is different.</li>
<li class="fragment">We will look at the case of one hinge value which gives us an overall slope that looks like a “broken arrow.”</li>
</ul>
</div></div>
</section>
<section id="creating-the-spline-variable" class="slide level2">
<h2>Creating the spline variable</h2>
<p>The relationship between age and wages suggests that the relationship shifts considerably around age 35. To model this we create a spline variable like so:</p>
<p><span class="math display">\[spline_i=\begin{cases}
  age-35 &amp; \text{if age&gt;35}\\
  0 &amp; \text{otherwise}
  \end{cases}\]</span></p>
<div class="fragment">
<p>We can then add this variable to our model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="" aria-hidden="true" tabindex="-1"></a>earnings<span class="sc">$</span>age.spline <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(earnings<span class="sc">$</span>age<span class="sc">&lt;</span><span class="dv">35</span>, <span class="dv">0</span>, earnings<span class="sc">$</span>age<span class="dv">-35</span>)</span>
<span id="cb50-2"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(wages<span class="sc">~</span>age<span class="sc">+</span>age.spline, <span class="at">data=</span>earnings)</span>
<span id="cb50-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>(Intercept)         age  age.spline 
 -6.0393027   0.9472390  -0.9549087 </code></pre>
</div>
</div>
<p>How do we interpret the results?</p>
</div>
</section>
<section id="interpreting-results-in-spline-model" class="slide level2 smaller">
<h2>Interpreting results in spline model</h2>
<div class="columns">
<div class="column">
<p>Up to age 35, the spline term is zero, so our model is given by:</p>
<p><span class="math display">\[\hat{wages}_i=-6.04+0.9472(age_i)\]</span></p>
<p>The model predicts that for individuals age 35 and under, a one year increase in age is associated with a $0.9472 increase in wages, on average.</p>
<p>After age 35, the spline variable increases by one every time age increases by one, so the marginal effect of age is given by:</p>
<p><span class="math display">\[0.9472-09549=-0.0077\]</span></p>
<p>The model predicts that for individuals over age 35, a one year increase in age is associated with a $0.0077 reduction in wages, on average.</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-48-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="plotting-the-spline-model" class="slide level2 smaller">
<h2><i class="fa-solid fa-user-ninja" aria-label="user-ninja"></i> Plotting the spline model</h2>
<div class="columns">
<div class="column">
<p>We cannot use <code>geom_smooth</code> to show the fit of this spline model. However, with some additional effort, we can plot the effect on a graph.</p>
<ol type="1">
<li class="fragment">Calculate the predicted value of wages for a range of age values based on the model using the <code>predict</code> command.</li>
<li class="fragment">Feed in these predicted values as a dataset to the <code>geom_line</code> function in our <code>ggplot</code> graph.</li>
</ol>
</div><div class="column fragment">
<h3 id="the-predict-command">The <code>predict</code> command</h3>
<p>The <code>predict</code> command takes two important arguments:</p>
<ol type="1">
<li class="fragment">The model object for which we want predicted values of the dependent variable.</li>
<li class="fragment">A new dataset that contains all the same independent variables that are in the model.</li>
</ol>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(wages<span class="sc">~</span>age<span class="sc">+</span>age.spline, <span class="at">data=</span>earnings)</span>
<span id="cb52-2"><a href="" aria-hidden="true" tabindex="-1"></a>pre_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">age=</span><span class="dv">18</span><span class="sc">:</span><span class="dv">65</span>)</span>
<span id="cb52-3"><a href="" aria-hidden="true" tabindex="-1"></a>pre_df<span class="sc">$</span>age.spline <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(pre_df<span class="sc">$</span>age<span class="sc">&lt;</span><span class="dv">35</span>, <span class="dv">0</span>,</span>
<span id="cb52-4"><a href="" aria-hidden="true" tabindex="-1"></a>                            pre_df<span class="sc">$</span>age<span class="dv">-35</span>)</span>
<span id="cb52-5"><a href="" aria-hidden="true" tabindex="-1"></a>pre_df<span class="sc">$</span>wages <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, </span>
<span id="cb52-6"><a href="" aria-hidden="true" tabindex="-1"></a>                        <span class="at">newdata=</span>pre_df)</span>
<span id="cb52-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pre_df, <span class="at">n=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  age age.spline    wages
1  18          0 11.01100
2  19          0 11.95824
3  20          0 12.90548</code></pre>
</div>
</div>
</div>
</div></div>
</section>
<section id="adding-the-spline-fit-to-ggplot" class="slide level2">
<h2>Adding the spline fit to ggplot</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb54" data-code-line-numbers="3"><pre class="sourceCode numberSource r number-lines code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href=""></a><span class="fu">ggplot</span>(earnings, <span class="fu">aes</span>(<span class="at">x=</span>age, <span class="at">y=</span>wages))<span class="sc">+</span></span>
<span id="cb54-2"><a href=""></a>  <span class="fu">geom_jitter</span>(<span class="at">alpha=</span><span class="fl">0.01</span>, <span class="at">width =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb54-3"><a href=""></a>  <span class="fu">geom_line</span>(<span class="at">data=</span>predict_df,</span>
<span id="cb54-4"><a href=""></a>            <span class="at">color=</span><span class="st">"blue"</span>, </span>
<span id="cb54-5"><a href=""></a>            <span class="at">size=</span><span class="fl">1.5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>To add the spline fit, we just add a <code>geom_line</code> command and specify our <code>pre_df</code> dataset through the <code>data</code> argument so that it uses the predicted values rather than the actual <code>earnings</code> dataset to graph the line.</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-51-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section></section>
<section>
<section id="the-iid-violation-and-robust-standard-errors" class="title-slide slide level1 center" data-background-color="black" data-background-image="images/bence-balla-schottner-o5ttfkZU9_Q-unsplash.jpg">
<h1>The IID Violation and Robust Standard Errors</h1>

</section>
<section id="linear-model-as-data-generating-process" class="slide level2 smaller">
<h2>Linear model as data-generating process</h2>
<p><span class="math display">\[y_i=\underbrace{\beta_0+\beta_1x_{i1}+\beta_2x_{i2}+\ldots+\beta_px_{ip}}_{\hat{y}_i}+\epsilon_i\]</span></p>
<ul>
<li class="fragment">To get values of <span class="math inline">\(y_i\)</span>, you feed in values of <span class="math inline">\(x_i\)</span> to the structural component and get back out a predicted <span class="math inline">\(\hat{y_i}\)</span> value.</li>
<li class="fragment">To get the stochastic (random) part, you then reach into some distribution to grab a random value of <span class="math inline">\(\epsilon_i\)</span> that you add to your predicted value to get an actual value of <span class="math inline">\(y_i\)</span>.</li>
<li class="fragment">What distribution are you reaching into when you grab <span class="math inline">\(\epsilon_i\)</span>?
<ul>
<li class="fragment"><strong>Independence</strong>: The number you pull out each time doesn’t depend on other numbers that you pull out. This is most commonly violated by <strong>autocorrelation</strong> or the clustering of <strong>repeated observations</strong>.</li>
<li class="fragment"><strong>Identical distribution</strong>: You reach into the same distribution for all observations. This is most commonly violated by <strong>heteroscedasticity</strong> which means non-constant variance in the residuals.</li>
</ul></li>
<li class="fragment">Together these assumptions give us the <strong>IID</strong> assumption of the linear model: the error terms are <strong>independent and identically distributed</strong>.</li>
</ul>
</section>
<section id="violations-of-independence" class="slide level2 smaller">
<h2>Violations of independence</h2>
<div class="columns">
<div class="column fragment">
<h3 id="serial-autocorrelation">Serial autocorrelation</h3>
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/time-series-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
<p>In time series data, sequential observations in time are likely to either be highly positively or negatively correlated. In this case, we can see clear seasonal fluctutation in birth rates.</p>
</div><div class="column fragment">
<h3 id="repeated-observations">Repeated observations</h3>
<p><img data-src="images/classroom.jpg"></p>
<p>When observations are drawn repeatedly from a sample of some larger units (i.e.&nbsp;a multilevel structure), then observations within the same unit are likely to vary from predicted values in the same way. For example, students in the same classroom might tend to have either lower or higher test scores than predicted by the model due to some unobserved feature of that classroom.</p>
</div></div>
</section>
<section id="serial-autocorrelation-example" class="slide level2 smaller">
<h2>Serial autocorrelation example</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(births<span class="sc">~</span>month, <span class="at">data=</span>births_nyc)</span>
<span id="cb55-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">augment</span>(model) <span class="sc">|&gt;</span></span>
<span id="cb55-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> .resid, </span>
<span id="cb55-4"><a href="" aria-hidden="true" tabindex="-1"></a>             <span class="at">y =</span> <span class="fu">lag</span>(.resid, <span class="dv">1</span>)))<span class="sc">+</span></span>
<span id="cb55-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()<span class="sc">+</span></span>
<span id="cb55-6"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_smooth</span>(<span class="at">method=</span><span class="st">"lm"</span>, <span class="at">se=</span><span class="cn">FALSE</span>)<span class="sc">+</span></span>
<span id="cb55-7"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">0</span>, <span class="at">linetype=</span><span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb55-8"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x=</span><span class="st">"residuals"</span>,</span>
<span id="cb55-9"><a href="" aria-hidden="true" tabindex="-1"></a>       <span class="at">y=</span><span class="st">"residuals (lagged one month"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>As an example of serial autocorrelation, I will use the <code>longley</code> time series dataset in R to fit the following model predicting the number of people employed by GNP from 1947 to 1962 (n=16):</p>
<p>I can then plot the residuals values from years 1947 to 1961 by the residual values for years 1948 to 1962. The positive correlation in the residuals here suggests serial autocorrelation.</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-54-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="heteroscedasticity" class="slide level2 smaller">
<h2>Heteroscedasticity</h2>
<div class="columns">
<div class="column">
<p><img data-src="images/mary_poppins.jpg"></p>
<ul>
<li class="fragment">Heteroscedasticity means that the variance of the residuals is not constant but depends on the values of <span class="math inline">\(x_i\)</span>, and therefore, implicitly, <span class="math inline">\(\hat{y}_i\)</span>.</li>
<li class="fragment">A classic example of heteroscedasticity is when the variance of the residuals increases with larger values of <span class="math inline">\(\hat{y}_i\)</span> giving you a cone shape in a residual by fitted value plot.</li>
</ul>
</div><div class="column fragment">
<div class="cell">
<div class="cell-output-display">
<div id="fig-heteroscedasticity" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-heteroscedasticity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="slides_model_complications_files/figure-revealjs/fig-heteroscedasticity-1.png" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-heteroscedasticity-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;10: The variance of the residuals increases with the predicted value
</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="correcting-for-iid-violations" class="slide level2 smaller">
<h2>Correcting for iid violations</h2>
<p>Violating the iid assumption does not bias your results, but it will lead to inefficient estimates and poorly estimated standard errors.</p>
<p>There are a number of potential solutions to the iid problem. These include:</p>
<ul>
<li class="fragment"><strong>Transformations</strong> (particularly the log transformation) can often solve the problem of heteroscedasticity.</li>
<li class="fragment"><strong>Weighted least squares</strong> models can correct for iid when the nature of the violation is understood.</li>
<li class="fragment"><strong>Robust standard errors</strong> can be used as a crude brute-force solution when the nature of the violation is not well understood. I would recommend that this only be done for diagnostic reasons.</li>
<li class="fragment">In general, the best approach is to re-think your model. If you have an iid violation then you are probably not applying the best type of model to the problem at hand.</li>
</ul>
</section>
<section id="fixing-heteroscedasticity-with-a-transformation" class="slide level2">
<h2>Fixing heteroscedasticity with a transformation</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-56-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column fragment">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-57-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="using-weighted-least-squares" class="slide level2">
<h2>Using Weighted Least Squares</h2>
<p>The weighted least squares technique uses a weighting matrix <span class="math inline">\(\mathbf{W}\)</span> in its calculation of regression slopes like so:</p>
<p><span class="math display">\[\mathbf{\beta}=(\mathbf{X'W^{-1}X})^{-1}\mathbf{X'W^{-1}y}\]</span> <span class="math display">\[SE_{\beta}=\sqrt{\sigma^{2}(\mathbf{X'W^{-1}X})^{-1}}\]</span></p>
<p>The exact form of this weighting matrix depends on the nature of the iid violation, but in general it is used to represent the covariance between residuals.</p>
<ul>
<li class="fragment">Values in the diagonal cells adjust for heteroscedasticity.</li>
<li class="fragment">Values in other cells adjust for autocorrelation.</li>
</ul>
</section>
<section id="gls-example" class="slide level2 smaller">
<h2>GLS Example</h2>
<p>We can use the <code>gls</code> command in the <code>nmle</code> package to adjust for serial autocorrelation in the prior model.We will assume that the autocorrelation follows an “AR2” pattern in which each subsequent residual is correlated with its two immediate predecessors (AR2 stands for auto-regressive 2, where 2 indicates the lag).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb56-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(births<span class="sc">~</span>month, <span class="at">data=</span>births_nyc))<span class="sc">$</span>coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               Estimate  Std. Error   t value      Pr(&gt;|t|)
(Intercept) 22.13397155 0.213711779 103.56926 1.180362e-135
month        0.04511258 0.002584016  17.45832  3.644232e-37</code></pre>
</div>
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb58-1"><a href="" aria-hidden="true" tabindex="-1"></a>model_ar2 <span class="ot">&lt;-</span> <span class="fu">gls</span>(births<span class="sc">~</span>month, <span class="at">correlation =</span> <span class="fu">corARMA</span>(<span class="at">form=</span><span class="sc">~</span>month, <span class="at">p =</span> <span class="dv">2</span>),</span>
<span id="cb58-2"><a href="" aria-hidden="true" tabindex="-1"></a>                 <span class="at">data =</span> births_nyc)</span>
<span id="cb58-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_ar2)<span class="sc">$</span>tTable</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                  Value   Std.Error   t-value      p-value
(Intercept) 22.11492387 0.410144820 53.919793 1.858038e-96
month        0.04505801 0.004927651  9.143911 5.747469e-16</code></pre>
</div>
</div>
</section>
<section id="robust-standard-errors" class="slide level2 smaller">
<h2>Robust Standard Errors</h2>
<div class="columns">
<div class="column">
<p>We won’t delve into the math behind the robust standard error, but the general idea is that robust standard errors will give you “correct” standard errors even when the model is mis-specified due to issues such a non-linearity, heteroscedasticity, and autocorrelation.</p>
<p>Robust standard errors can be estimated in R using the <code>sandwich</code> and <code>lmtest</code> packages, and specifically with the <code>coeftest</code> command. Within this command, it is possible to specify different types of robust standard errors, but we will use the “HC1” version which is equivalent to the robust standard errors produced in Stata by default.</p>
</div><div class="column fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb60-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb60-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb60-3"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(box_office<span class="sc">~</span>rating_imdb, <span class="at">data =</span> movies)</span>
<span id="cb60-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)<span class="sc">$</span>coef[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error
(Intercept) -83.27516   7.392017
rating_imdb  20.58590   1.166092</code></pre>
</div>
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(model, <span class="at">vcov =</span> <span class="fu">vcovHC</span>(model, <span class="st">"HC1"</span>))[,<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error
(Intercept) -83.27516   8.667410
rating_imdb  20.58590   1.487426</code></pre>
</div>
</div>
<div class="fragment">
<p>The estimates are the same, but the robust standard errors are considerably larger. That difference in magnitude is telling us that our basic regression model is problematic. In this case, we already know that the problem is heteroscedasticity.</p>
</div>
</div></div>
</section>
<section id="robust-standard-errors-diagnose-problems-that-they-do-not-fix" class="slide level2 smaller">
<h2>⚠️ Robust standard errors diagnose problems that they do not fix!</h2>
<p>Lets use robust standard errors on a model where we first log box office returns:</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb64-1"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(box_office)<span class="sc">~</span>rating_imdb, <span class="at">data =</span> movies)</span>
<span id="cb64-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)<span class="sc">$</span>coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              Estimate Std. Error     t value     Pr(&gt;|t|)
(Intercept) 0.01557736 0.22438136  0.06942361 9.446556e-01
rating_imdb 0.37140161 0.03539619 10.49270036 1.877324e-25</code></pre>
</div>
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coeftest</span>(model, <span class="at">vcov =</span> <span class="fu">vcovHC</span>(model, <span class="st">"HC1"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) 0.015577   0.203624  0.0765    0.939    
rating_imdb 0.371402   0.031974 11.6158   &lt;2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
</div>
<div class="fragment">
<p>When the dependent variable is logged to remove heteroscedasticity, the difference between robust and regular standard errors goes away.</p>
</div>
</section></section>
<section>
<section id="sample-design-and-weighting" class="title-slide slide level1 center" data-background-color="black" data-background-image="images/cyril-saulnier-TsVN31Dzyv4-unsplash.jpg">
<h1>Sample Design and Weighting</h1>

</section>
<section id="the-reality-of-survey-sampling" class="slide level2 smaller">
<h2>The reality of survey sampling</h2>
<div class="columns">
<div class="column">
<h3 id="the-simple-random-sample">The simple random sample</h3>
<p><img data-src="images/srs.png"></p>
<ul>
<li class="fragment">In a simple random sample (SRS) of size <span class="math inline">\(n\)</span>, every possible combination of <span class="math inline">\(n\)</span> observations from the population has an equally likely chance of being drawn.</li>
<li class="fragment">Eevery statistic from an SRS should be representative of the population, except for random sampling bias.</li>
</ul>
</div><div class="column fragment">
<h3 id="reality">Reality</h3>
<p><img data-src="images/strat_sample.png"></p>
<ul>
<li class="fragment">In practice, large-scale surveys never use SRS for pragmatic and design reasons.</li>
<li class="fragment">For correct statistical inference, we typically need to make adjustments for sample design.</li>
<li class="fragment">The primary ways in which sample design affects estimation are <strong>clustering</strong>, <strong>stratification</strong>, and <strong>weighting</strong>.</li>
</ul>
</div></div>
</section>
<section id="clustermultistage-sampling" class="slide level2 smaller">
<h2>Cluster/Multistage sampling</h2>
<div class="columns">
<div class="column" style="width:30%;">
<p><img data-src="images/multistage.png"></p>
</div><div class="column" style="width:70%;">
<p>Potential observations are aggregated into larger groupings identified as the Primary Sampling Unit (PSU) and then we sample some of these PSUs before sampling individual observations within the sampled PSUs.</p>
<ul>
<li class="fragment">Cluster sampling is about efficiency and cost. Clusters are typically defined geographically, which then minimizes the cost of sampling individual observations.</li>
<li class="fragment">If PSUs are sampled with probabilities proportional to cluster size, then every unit in the population has an equal likelihood of being selected. In this case, summary statistics on the sample should be representative.</li>
<li class="fragment">When the variable of interest is distributed differently across clusters, the sampling variability will be higher than an SRS even if every observation has an equally likely chance of being drawn.</li>
</ul>
</div></div>
</section>
<section id="what-percent-of-the-us-population-is-mormon" class="slide level2 smaller">
<h2>What percent of the US population is Mormon?</h2>
<div class="columns">
<div class="column">
<p>The General Social Survey uses Metropolitan Statistical Areas (MSA) and clusters of non-metropolitan counties as the PSU. In each year, it draws a sample of these areas and then samples respondents within each sampled PSU.</p>
<p>Because Mormons are heavily concentrated in certain places, percent Mormon in the GSS varies substantially from year to year by whether certain PSUs were sampled or not. Red band indicates expected 95% interval for sampling variability without clustering, assuming the average percent across all years (dotted line).</p>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div id="fig-mormons" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-mormons-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="slides_model_complications_files/figure-revealjs/fig-mormons-1.png" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-mormons-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;11: The variance in the proportion across years is higher than we would expect if we were drawing an SRS
</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="stratification" class="slide level2 smaller">
<h2>Stratification</h2>
<p>Stratification in sampling operates in a manner somewhat similar to cluster sampling except that once the observations are aggregated into strata by some characteristic (e.g.&nbsp;income, race, age), observations are sampled from <em>every</em> stratum.</p>
<ul>
<li class="fragment">Stratification is typically done to ensure that various sub-populations are present within the sample.</li>
<li class="fragment">Different strata may be sampled with different probabilities. The most common approach is to take an <strong>oversample</strong> of a small group in order to ensure that effective comparisons can be made between that group and other groups.</li>
<li class="fragment">In practice, stratification is often done by first screening potential respondents for stratum characteristics.</li>
<li class="fragment">If strata are sampled with different probabilities, then summary statistics for the full sample will not be representative without weight adjustments.</li>
<li class="fragment">Unlike clustering, greater similarity on a characteristic of interest within strata can actually <strong>reduce</strong> the sampling variability for that characteristic relative to an SRS.</li>
</ul>
</section>
<section id="weighting" class="slide level2 smaller">
<h2>Weighting</h2>
<ul>
<li class="fragment">Numerous factors can lead to a sample being unrepresentative such as sampling strata with different probabilities, differential non-response rates, and a lack of fit between sample frame and population.</li>
<li class="fragment"><strong>Sampling weights</strong> allow researchers to correct summary statistics from the sample so that they are representative of the population.</li>
<li class="fragment">The sampling weight for an observation should be <span class="math inline">\(1/p_i\)</span> where <span class="math inline">\(p_i\)</span> is the probability of being sampled. The sampling weight indicates the number of observations in the population that observation <span class="math inline">\(i\)</span> in the sample represents.</li>
<li class="fragment">Calculating sampling weights can be quite complex. In some cases, researchers may know <span class="math inline">\(p_i\)</span> from the study design. In other cases, researchers may create <strong>post-stratification</strong> weights by comparing the sample to some other data source (e.g.&nbsp;census, school records) for a set of demographic characteristics and applying weights to make the sample align with the other data source.</li>
<li class="fragment">When sampling weights are present in a dataset, they must be used to generate statistics representative of the population.</li>
<li class="fragment">Variation in sampling weights will increase sampling variability above and beyond that expected for an SRS.</li>
</ul>
</section>
<section id="weights-in-sneetchville" class="slide level2 smaller">
<h2>Weights in Sneetchville</h2>
<div class="columns">
<div class="column" style="width:30%;">
<div class="quarto-figure quarto-figure-center">
<figure>
<p><img data-src="images/sneetches.jpg"></p>
<figcaption>sneetches</figcaption>
</figure>
</div>
</div><div class="column" style="width:70%;">
<p>In Sneetchville, there are 3 star-bellied and 7 regular sneetches. Lets say I take a stratified sample of two star-bellied and two regular sneetches. Here is the population data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="" aria-hidden="true" tabindex="-1"></a>sneetches <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">type =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="fu">rep</span>(<span class="st">"Star-bellied"</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="st">"Regular"</span>, <span class="dv">7</span>))),</span>
<span id="cb68-2"><a href="" aria-hidden="true" tabindex="-1"></a>                    <span class="at">income =</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">6</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">1</span>),</span>
<span id="cb68-3"><a href="" aria-hidden="true" tabindex="-1"></a>                    <span class="at">prob =</span> <span class="fu">c</span>(<span class="fu">rep</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">3</span>, <span class="dv">3</span>), <span class="fu">rep</span>(<span class="dv">2</span><span class="sc">/</span><span class="dv">7</span>, <span class="dv">7</span>)))</span>
<span id="cb68-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(sneetches)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="tfsidwobrp" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#tfsidwobrp table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#tfsidwobrp thead, #tfsidwobrp tbody, #tfsidwobrp tfoot, #tfsidwobrp tr, #tfsidwobrp td, #tfsidwobrp th {
  border-style: none;
}

#tfsidwobrp p {
  margin: 0;
  padding: 0;
}

#tfsidwobrp .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#tfsidwobrp .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#tfsidwobrp .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#tfsidwobrp .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#tfsidwobrp .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tfsidwobrp .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tfsidwobrp .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#tfsidwobrp .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#tfsidwobrp .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#tfsidwobrp .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#tfsidwobrp .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#tfsidwobrp .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#tfsidwobrp .gt_spanner_row {
  border-bottom-style: hidden;
}

#tfsidwobrp .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#tfsidwobrp .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#tfsidwobrp .gt_from_md > :first-child {
  margin-top: 0;
}

#tfsidwobrp .gt_from_md > :last-child {
  margin-bottom: 0;
}

#tfsidwobrp .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#tfsidwobrp .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#tfsidwobrp .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#tfsidwobrp .gt_row_group_first td {
  border-top-width: 2px;
}

#tfsidwobrp .gt_row_group_first th {
  border-top-width: 2px;
}

#tfsidwobrp .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tfsidwobrp .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#tfsidwobrp .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#tfsidwobrp .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tfsidwobrp .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#tfsidwobrp .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#tfsidwobrp .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#tfsidwobrp .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#tfsidwobrp .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#tfsidwobrp .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tfsidwobrp .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tfsidwobrp .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#tfsidwobrp .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#tfsidwobrp .gt_left {
  text-align: left;
}

#tfsidwobrp .gt_center {
  text-align: center;
}

#tfsidwobrp .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#tfsidwobrp .gt_font_normal {
  font-weight: normal;
}

#tfsidwobrp .gt_font_bold {
  font-weight: bold;
}

#tfsidwobrp .gt_font_italic {
  font-style: italic;
}

#tfsidwobrp .gt_super {
  font-size: 65%;
}

#tfsidwobrp .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#tfsidwobrp .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#tfsidwobrp .gt_indent_1 {
  text-indent: 5px;
}

#tfsidwobrp .gt_indent_2 {
  text-indent: 10px;
}

#tfsidwobrp .gt_indent_3 {
  text-indent: 15px;
}

#tfsidwobrp .gt_indent_4 {
  text-indent: 20px;
}

#tfsidwobrp .gt_indent_5 {
  text-indent: 25px;
}

#tfsidwobrp .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#tfsidwobrp div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="type" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">type</th>
<th id="income" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">income</th>
<th id="prob" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">prob</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="type">Star-bellied</td>
<td class="gt_row gt_right" headers="income">3</td>
<td class="gt_row gt_right" headers="prob">0.6666667</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="type">Star-bellied</td>
<td class="gt_row gt_right" headers="income">7</td>
<td class="gt_row gt_right" headers="prob">0.6666667</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="type">Star-bellied</td>
<td class="gt_row gt_right" headers="income">6</td>
<td class="gt_row gt_right" headers="prob">0.6666667</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="type">Regular</td>
<td class="gt_row gt_right" headers="income">2</td>
<td class="gt_row gt_right" headers="prob">0.2857143</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="type">Regular</td>
<td class="gt_row gt_right" headers="income">1</td>
<td class="gt_row gt_right" headers="prob">0.2857143</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="type">Regular</td>
<td class="gt_row gt_right" headers="income">4</td>
<td class="gt_row gt_right" headers="prob">0.2857143</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="type">Regular</td>
<td class="gt_row gt_right" headers="income">5</td>
<td class="gt_row gt_right" headers="prob">0.2857143</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="type">Regular</td>
<td class="gt_row gt_right" headers="income">0</td>
<td class="gt_row gt_right" headers="prob">0.2857143</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="type">Regular</td>
<td class="gt_row gt_right" headers="income">2</td>
<td class="gt_row gt_right" headers="prob">0.2857143</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="type">Regular</td>
<td class="gt_row gt_right" headers="income">1</td>
<td class="gt_row gt_right" headers="prob">0.2857143</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</div></div>
</section>
<section id="weights-in-sneetchville-1" class="slide level2">
<h2>Weights in Sneetchville</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="" aria-hidden="true" tabindex="-1"></a>sneetch_sample <span class="ot">&lt;-</span> sneetches[<span class="fu">c</span>(<span class="fu">sample</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">2</span>), <span class="fu">sample</span>(<span class="dv">4</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">2</span>)),]</span>
<span id="cb69-2"><a href="" aria-hidden="true" tabindex="-1"></a>sneetch_sample<span class="sc">$</span>weight <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">/</span>sneetch_sample<span class="sc">$</span>prob</span>
<span id="cb69-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">gt</span>(sneetch_sample)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="bajhyvamop" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#bajhyvamop table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#bajhyvamop thead, #bajhyvamop tbody, #bajhyvamop tfoot, #bajhyvamop tr, #bajhyvamop td, #bajhyvamop th {
  border-style: none;
}

#bajhyvamop p {
  margin: 0;
  padding: 0;
}

#bajhyvamop .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#bajhyvamop .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#bajhyvamop .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#bajhyvamop .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#bajhyvamop .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bajhyvamop .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bajhyvamop .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#bajhyvamop .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#bajhyvamop .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#bajhyvamop .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#bajhyvamop .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#bajhyvamop .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#bajhyvamop .gt_spanner_row {
  border-bottom-style: hidden;
}

#bajhyvamop .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#bajhyvamop .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#bajhyvamop .gt_from_md > :first-child {
  margin-top: 0;
}

#bajhyvamop .gt_from_md > :last-child {
  margin-bottom: 0;
}

#bajhyvamop .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#bajhyvamop .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#bajhyvamop .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#bajhyvamop .gt_row_group_first td {
  border-top-width: 2px;
}

#bajhyvamop .gt_row_group_first th {
  border-top-width: 2px;
}

#bajhyvamop .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bajhyvamop .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#bajhyvamop .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#bajhyvamop .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bajhyvamop .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#bajhyvamop .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#bajhyvamop .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#bajhyvamop .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#bajhyvamop .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#bajhyvamop .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bajhyvamop .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bajhyvamop .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#bajhyvamop .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#bajhyvamop .gt_left {
  text-align: left;
}

#bajhyvamop .gt_center {
  text-align: center;
}

#bajhyvamop .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#bajhyvamop .gt_font_normal {
  font-weight: normal;
}

#bajhyvamop .gt_font_bold {
  font-weight: bold;
}

#bajhyvamop .gt_font_italic {
  font-style: italic;
}

#bajhyvamop .gt_super {
  font-size: 65%;
}

#bajhyvamop .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#bajhyvamop .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#bajhyvamop .gt_indent_1 {
  text-indent: 5px;
}

#bajhyvamop .gt_indent_2 {
  text-indent: 10px;
}

#bajhyvamop .gt_indent_3 {
  text-indent: 15px;
}

#bajhyvamop .gt_indent_4 {
  text-indent: 20px;
}

#bajhyvamop .gt_indent_5 {
  text-indent: 25px;
}

#bajhyvamop .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#bajhyvamop div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="type" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">type</th>
<th id="income" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">income</th>
<th id="prob" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">prob</th>
<th id="weight" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">weight</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_center" headers="type">Star-bellied</td>
<td class="gt_row gt_right" headers="income">6</td>
<td class="gt_row gt_right" headers="prob">0.6666667</td>
<td class="gt_row gt_right" headers="weight">1.5</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="type">Star-bellied</td>
<td class="gt_row gt_right" headers="income">7</td>
<td class="gt_row gt_right" headers="prob">0.6666667</td>
<td class="gt_row gt_right" headers="weight">1.5</td>
</tr>
<tr class="odd">
<td class="gt_row gt_center" headers="type">Regular</td>
<td class="gt_row gt_right" headers="income">1</td>
<td class="gt_row gt_right" headers="prob">0.2857143</td>
<td class="gt_row gt_right" headers="weight">3.5</td>
</tr>
<tr class="even">
<td class="gt_row gt_center" headers="type">Regular</td>
<td class="gt_row gt_right" headers="income">4</td>
<td class="gt_row gt_right" headers="prob">0.2857143</td>
<td class="gt_row gt_right" headers="weight">3.5</td>
</tr>
</tbody>
</table>

</div>
</div>
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(sneetches<span class="sc">$</span>income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(sneetch_sample<span class="sc">$</span>income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4.5</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">weighted.mean</span>(sneetch_sample<span class="sc">$</span>income, sneetch_sample<span class="sc">$</span>weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.7</code></pre>
</div>
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(sneetch_sample<span class="sc">$</span>income<span class="sc">*</span>sneetch_sample<span class="sc">$</span>weight)<span class="sc">/</span><span class="fu">sum</span>(sneetch_sample<span class="sc">$</span>weight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 3.7</code></pre>
</div>
</div>
</section>
<section id="the-consequences-of-survey-design" class="slide level2 smaller">
<h2>The consequences of survey design</h2>
<table class="caption-top">
<colgroup>
<col style="width: 12%">
<col style="width: 56%">
<col style="width: 31%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Design issue</th>
<th style="text-align: left;">Representative?</th>
<th style="text-align: left;">Design effect (change to SE)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Clustering</td>
<td style="text-align: left;">Yes, if PSUs are proportionally drawn. Otherwise, weighting necessary.</td>
<td style="text-align: left;">Increases with difference between clusters.</td>
</tr>
<tr class="even">
<td style="text-align: left;">Stratification</td>
<td style="text-align: left;">Yes, if strata are sampled with same probability. Otherwise weighting necessary.</td>
<td style="text-align: left;">Decreases with homogeneity within strata</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Weights</td>
<td style="text-align: left;">Only if weights are applied.</td>
<td style="text-align: left;">Increases with the variance of the weights.</td>
</tr>
</tbody>
</table>
</section>
<section id="correcting-for-survey-design" class="slide level2">
<h2>Correcting for survey design</h2>
<div class="fragment">
<h3 id="basic-weighting">Basic Weighting</h3>
<p>R has syntax in many commands to apply sampling weights to get representative statistics (e.g.&nbsp;<code>weighted.mean</code>, the <code>weight</code> option in the <code>lm</code> command), but this approach will not correctly adjust standard errors for design effects.</p>
</div>
<div class="fragment">
<h3 id="robust-standard-errors-1">Robust standard errors</h3>
<p>Robust standard errors will correct standard errors for differential weights, but not for clustering and stratification design effects.</p>
</div>
<div class="fragment">
<h3 id="survey-package">Survey package</h3>
<p>The <code>survey</code> package in R will allow you to specify design and correctly adjust standard errors.</p>
</div>
</section>
<section id="add-health-survey-design" class="slide level2 smaller">
<h2>Add Health survey design</h2>
<div class="columns">
<div class="column" style="width:30%;">
<p><img data-src="images/addhealthdesign.jpeg"></p>
</div><div class="column" style="width:70%;">
<ul>
<li class="fragment">Schools were the primary PSU in a cluster sampling technique, but were also stratified by region, urbanicity, school type, ethnic mix, and size.</li>
<li class="fragment">Students within schools were stratified by grade and sex and then sampled.</li>
<li class="fragment">Several oversamples were conducted of ethnic groups and genetically related pairs of students, as well as saturated samples from 16 schools.</li>
<li class="fragment">Post-stratification adjustments were made to sampling weights to account for region of the country.</li>
<li class="fragment">The Add Health documentation indicates that the REGION variable should be applied as a stratification variable but this variable is not available in the public release data so we will focus on the design effects of weights and clustering.</li>
</ul>
</div></div>
</section>
<section id="sample-design-variables" class="slide level2 smaller">
<h2>Sample design variables</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="" aria-hidden="true" tabindex="-1"></a>addhealth <span class="sc">|&gt;</span></span>
<span id="cb78-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(cluster, sweight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 4,397 × 2
   cluster sweight
     &lt;dbl&gt;   &lt;dbl&gt;
 1     472   3664.
 2     472   4472.
 3     142   3325.
 4     142    271.
 5     145   3940.
 6     145    759.
 7     132   7001.
 8     166    709.
 9     166    711.
10     163   7851.
# ℹ 4,387 more rows</code></pre>
</div>
</div>
<ul>
<li class="fragment"><code>cluster</code> is a numeric id indicating the school the student was sampled from.</li>
<li class="fragment"><code>sweight</code> is the inverse of the probability of being sampled.</li>
</ul>
</div><div class="column fragment">
<div class="cell">
<div class="cell-output-display">
<div id="fig-addhealthweight-dist" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-addhealthweight-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="slides_model_complications_files/figure-revealjs/fig-addhealthweight-dist-1.png" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-addhealthweight-dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;12: Some observations count more than others
</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="add-health-example-naive-approach" class="slide level2 smaller">
<h2>Add Health example, naive approach</h2>
<div class="columns">
<div class="column">
<h3 id="basic-model">Basic model</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="" aria-hidden="true" tabindex="-1"></a>model_basic <span class="ot">&lt;-</span> <span class="fu">lm</span>(nominations<span class="sc">~</span>nsports, <span class="at">data =</span> addhealth)</span>
<span id="cb80-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_basic)<span class="sc">$</span>coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error  t value     Pr(&gt;|t|)
(Intercept) 3.9969128 0.07221383 55.34830 0.000000e+00
nsports     0.5044705 0.04282271 11.78044 1.462129e-31</code></pre>
</div>
</div>
<ul>
<li class="fragment">Estimates will be biased by differential probability of being sampled</li>
<li class="fragment">Standard errors are underestimated due to:
<ul>
<li class="fragment">variability in sampling weights</li>
<li class="fragment">the use of a cluster sampling design</li>
</ul></li>
</ul>
</div><div class="column fragment">
<h3 id="adjusting-for-weights">Adjusting for weights</h3>
<p>I can add the weights provided by Add Health to make this representative:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="" aria-hidden="true" tabindex="-1"></a>model_weight <span class="ot">&lt;-</span> <span class="fu">update</span>(model_basic, <span class="at">weight =</span> sweight)</span>
<span id="cb82-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_weight)<span class="sc">$</span>coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error  t value    Pr(&gt;|t|)
(Intercept) 4.0268786 0.07321643 54.99966 0.00000e+00
nsports     0.5330072 0.04347144 12.26109 5.23695e-34</code></pre>
</div>
</div>
<ul>
<li class="fragment">The slope estimates in this model are unbiased but I have not accounted for weight variability in my standard error estimates.</li>
</ul>
</div></div>
</section>
<section id="add-health-example-robust-se-approach" class="slide level2 smaller">
<h2>Add Health example, robust SE approach</h2>
<p>I can correct for sampling weight variability by using robust standard errors:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sandwich)</span>
<span id="cb84-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lmtest)</span>
<span id="cb84-3"><a href="" aria-hidden="true" tabindex="-1"></a>model_robust <span class="ot">&lt;-</span> <span class="fu">coeftest</span>(model_weight, <span class="at">vcov =</span> <span class="fu">vcovHC</span>(model_weight, <span class="st">"HC1"</span>))</span>
<span id="cb84-4"><a href="" aria-hidden="true" tabindex="-1"></a>model_robust</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
t test of coefficients:

            Estimate Std. Error t value  Pr(&gt;|t|)    
(Intercept) 4.026879   0.080106 50.2692 &lt; 2.2e-16 ***
nsports     0.533007   0.063041  8.4549 &lt; 2.2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<ul>
<li class="fragment">Estimates are identical to the weighted <code>lm</code> but standard errors are slightly larger. However, this technique still does not correct for clustering.</li>
</ul>
</section>
<section id="add-health-example-using-survey-library" class="slide level2 smaller">
<h2>Add Health example, using <code>survey</code> library</h2>
<p>I can use the <code>svydesign</code> command in the <code>survey</code> package to correctly specify both the weights and the clustering in Add Health. The <code>ids</code> argument expects a variable name that identifies the clusters by id (in this case, the school id) and the <code>weight</code> argument expects a variable name for the weights used.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(survey)</span>
<span id="cb86-2"><a href="" aria-hidden="true" tabindex="-1"></a>addhealth_svy <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">ids =</span> <span class="sc">~</span>cluster, <span class="at">weight =</span> <span class="sc">~</span>sweight, <span class="at">data =</span> addhealth)</span>
<span id="cb86-3"><a href="" aria-hidden="true" tabindex="-1"></a>model_svy <span class="ot">&lt;-</span> <span class="fu">svyglm</span>(nominations<span class="sc">~</span>nsports, <span class="at">design =</span> addhealth_svy)</span>
<span id="cb86-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_svy)<span class="sc">$</span>coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             Estimate Std. Error   t value     Pr(&gt;|t|)
(Intercept) 4.0268786 0.11483268 35.067357 6.996643e-62
nsports     0.5330072 0.07318866  7.282648 5.034252e-11</code></pre>
</div>
</div>
<ul>
<li class="fragment">Estimates are identical to the weighted model before, but standard errors have increased due to variation in weights <strong>and</strong> the cluster design effect.</li>
</ul>
</section>
<section id="comparison-of-methods" class="slide level2 smaller">
<h2>Comparison of methods</h2>
<div class="cell">
<div id="tbl-sdesign-compare" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sdesign-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;2: Comparison of modeling techniques for dealing with sampling design
</figcaption>
<div aria-describedby="tbl-sdesign-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="ggjztctifi" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#ggjztctifi table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#ggjztctifi thead, #ggjztctifi tbody, #ggjztctifi tfoot, #ggjztctifi tr, #ggjztctifi td, #ggjztctifi th {
  border-style: none;
}

#ggjztctifi p {
  margin: 0;
  padding: 0;
}

#ggjztctifi .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#ggjztctifi .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#ggjztctifi .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#ggjztctifi .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#ggjztctifi .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ggjztctifi .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ggjztctifi .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#ggjztctifi .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#ggjztctifi .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#ggjztctifi .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#ggjztctifi .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#ggjztctifi .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#ggjztctifi .gt_spanner_row {
  border-bottom-style: hidden;
}

#ggjztctifi .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#ggjztctifi .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#ggjztctifi .gt_from_md > :first-child {
  margin-top: 0;
}

#ggjztctifi .gt_from_md > :last-child {
  margin-bottom: 0;
}

#ggjztctifi .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#ggjztctifi .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#ggjztctifi .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#ggjztctifi .gt_row_group_first td {
  border-top-width: 2px;
}

#ggjztctifi .gt_row_group_first th {
  border-top-width: 2px;
}

#ggjztctifi .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ggjztctifi .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#ggjztctifi .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#ggjztctifi .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ggjztctifi .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#ggjztctifi .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#ggjztctifi .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#ggjztctifi .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#ggjztctifi .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#ggjztctifi .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ggjztctifi .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ggjztctifi .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#ggjztctifi .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#ggjztctifi .gt_left {
  text-align: left;
}

#ggjztctifi .gt_center {
  text-align: center;
}

#ggjztctifi .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#ggjztctifi .gt_font_normal {
  font-weight: normal;
}

#ggjztctifi .gt_font_bold {
  font-weight: bold;
}

#ggjztctifi .gt_font_italic {
  font-style: italic;
}

#ggjztctifi .gt_super {
  font-size: 65%;
}

#ggjztctifi .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#ggjztctifi .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#ggjztctifi .gt_indent_1 {
  text-indent: 5px;
}

#ggjztctifi .gt_indent_2 {
  text-indent: 10px;
}

#ggjztctifi .gt_indent_3 {
  text-indent: 15px;
}

#ggjztctifi .gt_indent_4 {
  text-indent: 20px;
}

#ggjztctifi .gt_indent_5 {
  text-indent: 25px;
}

#ggjztctifi .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#ggjztctifi div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a-" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="unweighted-OLS" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">unweighted OLS</th>
<th id="weighted-OLS" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">weighted OLS</th>
<th id="robust-SE" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">robust SE</th>
<th id="svy:-weights" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">svy: weights</th>
<th id="svy:-weights+cluster" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">svy: weights+cluster</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Intercept</td>
<td class="gt_row gt_center" headers="unweighted OLS">3.997***</td>
<td class="gt_row gt_center" headers="weighted OLS">4.027***</td>
<td class="gt_row gt_center" headers="robust SE">4.027***</td>
<td class="gt_row gt_center" headers="svy: weights">4.027***</td>
<td class="gt_row gt_center" headers="svy: weights+cluster">4.027***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="unweighted OLS">(0.072)</td>
<td class="gt_row gt_center" headers="weighted OLS">(0.073)</td>
<td class="gt_row gt_center" headers="robust SE">(0.080)</td>
<td class="gt_row gt_center" headers="svy: weights">(0.080)</td>
<td class="gt_row gt_center" headers="svy: weights+cluster">(0.115)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Number of sports played</td>
<td class="gt_row gt_center" headers="unweighted OLS">0.504***</td>
<td class="gt_row gt_center" headers="weighted OLS">0.533***</td>
<td class="gt_row gt_center" headers="robust SE">0.533***</td>
<td class="gt_row gt_center" headers="svy: weights">0.533***</td>
<td class="gt_row gt_center" headers="svy: weights+cluster">0.533***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" " style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="unweighted OLS" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(0.043)</td>
<td class="gt_row gt_center" headers="weighted OLS" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(0.043)</td>
<td class="gt_row gt_center" headers="robust SE" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(0.063)</td>
<td class="gt_row gt_center" headers="svy: weights" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(0.063)</td>
<td class="gt_row gt_center" headers="svy: weights+cluster" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(0.073)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Num.Obs.</td>
<td class="gt_row gt_center" headers="unweighted OLS">4397</td>
<td class="gt_row gt_center" headers="weighted OLS">4397</td>
<td class="gt_row gt_center" headers="robust SE">4397</td>
<td class="gt_row gt_center" headers="svy: weights">4397</td>
<td class="gt_row gt_center" headers="svy: weights+cluster">4397</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">R2</td>
<td class="gt_row gt_center" headers="unweighted OLS">0.031</td>
<td class="gt_row gt_center" headers="weighted OLS">0.033</td>
<td class="gt_row gt_center" headers="robust SE"></td>
<td class="gt_row gt_center" headers="svy: weights">0.033</td>
<td class="gt_row gt_center" headers="svy: weights+cluster">0.033</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="6" class="gt_sourcenote">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<ul>
<li class="fragment">All models except the unweighted version produce the same estimates of slope and intercept based on the weights.</li>
<li class="fragment">The survey weighted and robust SE models both produce the same standard errors. This is because both models account for the design effect of weight variance but not clustering.</li>
</ul>
</section></section>
<section>
<section id="missing-data" class="title-slide slide level1 center" data-background-color="black" data-background-image="images/kyaw-tun-UvL9JrLkagM-unsplash.jpg">
<h1>Missing Data</h1>

</section>
<section id="the-reality-of-missing-data" class="slide level2 smaller">
<h2>The reality of missing data</h2>
<p>Missing data exists in most real-world data sets. Therefore, its important to know how to handle missing data in order to know how to properly conduct an analysis.</p>
<div class="columns">
<div class="column fragment">
<h3 id="valid-skip">Valid Skip</h3>
<p><img data-src="images/baby_boss.jpg"></p>
<p>Valid skips most arise when a follow-up question is only asked of respondents who gave a certain response to the initial question. If you construct a variable correctly, valid skips should not be considered missing values.</p>
</div><div class="column fragment">
<h3 id="item-non-response">Item non-response</h3>
<p><img data-src="images/slamming-door-shutting-door.gif"></p>
<p>Item non-response occurs when respondents fail to respond to a specific question. This may be because they don’t know the correct response or they do not feel comfortable answering the question.</p>
</div></div>
</section>
<section id="example-of-a-valid-skip" class="slide level2 smaller">
<h2>Example of a valid skip</h2>
<p>The General Social Survey uses three variables to determine respondents’ religious affiliation.</p>
<ul>
<li class="fragment"><code>relig</code> asks for major religious affiliations such as Catholic, Protestant, Jewish, Muslim, etc.</li>
<li class="fragment"><strong>If and only if</strong> respondents indicate they are Protestant, they are asked a follow up question recorded in <code>denom</code> which asks for their specific denomination.</li>
<li class="fragment"><code>denom</code> only lists major Protestant denominations. If the respondent checks “other”, their specific write-in response is recorded in a third variable titled <code>other</code>.</li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="" aria-hidden="true" tabindex="-1"></a>relig <span class="sc">|&gt;</span> <span class="fu">select</span>(relig, denom, other) <span class="sc">|&gt;</span> <span class="fu">summary</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        relig                    denom                       other      
 protestant:34597   other           : 7491   pentecostal        :  878  
 catholic  :14532   baptist-dk which: 6078   mormon             :  714  
 none      : 6635   southern baptist: 3613   church of christ   :  648  
 jewish    : 1195   no denomination : 3101   christian          :  538  
 other     : 1025   united methodist: 2693   jehovah's witnesses:  397  
 (Other)   : 1592   (Other)         :11959   (Other)            : 4224  
 NA's      :   23   NA's            :24664   NA's               :52200  </code></pre>
</div>
</div>
</div>
<div class="fragment">
<p>There are a lot of missing values for <code>denom</code> and <code>other</code>, but these are all valid skips based on prior responses. The only true missing values in this set of variables are the 23 respondents who did not respond to the initial question on <code>relig</code>.</p>
</div>
</section>
<section id="kinds-of-missingness" class="slide level2 smaller">
<h2>Kinds of missingness</h2>
<div class="columns">
<div class="column" style="width:25%;">
<p><img data-src="images/coffee_spill.jpg"></p>
</div><div class="column" style="width:75%;">
<div class="fragment">
<h3 id="missing-completely-at-random-mcar">Missing Completely at Random (MCAR)</h3>
<p>Every observation has the same probability of missingness and the missingness of a variable has no relationship to other observed or unobserved variables. If this is true, then removing observations with missing values will not bias results.</p>
</div>
<div class="fragment">
<h3 id="missing-at-random-mar">Missing at Random (MAR)</h3>
<p>The different probabilities of missingness can be fully accounted for by other observed variables in the dataset. If this is true, then various techniques can be used to produce unbiased results by <strong>imputing</strong> values for the missing values.</p>
</div>
<div class="fragment">
<h3 id="not-missing-at-random-nmar">Not Missing at Random (NMAR)</h3>
<p>The different probabilities of missingness depend both on observed and unobserved variables. In this case, we cannot fully correct for bias that might result from missing data.</p>
</div>
</div></div>
</section>
<section id="add-health-income-example" class="slide level2">
<h2>Add Health income example</h2>
<p>As an example, I will use parental income from the Add Health data to predict popularity. Income is recorded in thousands of dollars, and I have top-coded the values to $200,000. Income is notorious as a variable that will typically have a high non-response rate. The Add Health data are no different:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(addhealth<span class="sc">$</span>parent_income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00   23.00   40.00   45.37   60.00  200.00    1027 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">mean</span>(<span class="fu">is.na</span>(addhealth<span class="sc">$</span>parent_income))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0.2335683</code></pre>
</div>
</div>
<p>Income is missing for 1027 cases which is roughly a quarter of the dataset.</p>
</section>
<section id="two-basic-approaches-to-missing-values" class="slide level2 smaller">
<h2>Two basic approaches to missing values</h2>
<div class="columns">
<div class="column fragment">
<p><img data-src="images/throw_away.png"></p>
<h3 id="remove-cases">Remove cases</h3>
<ul>
<li class="fragment">Case deletion is easy to implement.</li>
<li class="fragment">Case deletion assumes MCAR.</li>
<li class="fragment">Case deletion may result in a substantial reduction is sample size.</li>
</ul>
</div><div class="column fragment">
<p><img data-src="images/rabbit.jpg"></p>
<h3 id="impute-cases">Impute cases</h3>
<ul>
<li class="fragment">Imputation is more difficult to implement.</li>
<li class="fragment">If done properly, imputation assumes MAR.</li>
<li class="fragment">Imputation will not reduce sample size.</li>
</ul>
</div></div>
</section>
<section id="two-kinds-of-case-deletion" class="slide level2 smaller">
<h2>Two kinds of case deletion</h2>
<div class="columns">
<div class="column fragment">
<h3 id="complete-case-analysis-listwise-deletion">Complete-case analysis (listwise deletion)</h3>
<ul>
<li class="fragment">All cases that have missing values on any of the variables that will be used at some point in the analysis are removed from the start.</li>
<li class="fragment">This ensures that all results are based on the same sample.</li>
</ul>
</div><div class="column fragment">
<h3 id="available-case-analysis-pairwise-deletion">Available-case analysis (pairwise deletion)</h3>
<ul>
<li class="fragment">Cases are removed model by model or statistic by statistic when the variables used in that particular statistic or model have missing values.</li>
<li class="fragment">This is by default what will happen in R across different <code>lm</code> models with different variables.</li>
<li class="fragment">This approach allows the researcher to use more data, but different statistics and models will use different subsets of the full data which makes comparability problematic.</li>
</ul>
</div></div>
</section>
<section id="removing-cases-add-health-example" class="slide level2 smaller">
<h2>Removing cases, Add Health example</h2>
<div class="columns">
<div class="column fragment">
<h3 id="available-case-analysis">Available-case analysis</h3>
<p>This is what happens by default when you just run nested models in R</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb94"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb94-1"><a href="" aria-hidden="true" tabindex="-1"></a>model1.avail <span class="ot">&lt;-</span> <span class="fu">lm</span>(nominations<span class="sc">~</span>nsports, <span class="at">data =</span> addhealth)</span>
<span id="cb94-2"><a href="" aria-hidden="true" tabindex="-1"></a>model2.avail <span class="ot">&lt;-</span> <span class="fu">update</span>(model1.avail, .<span class="sc">~</span>.<span class="sc">+</span>alcohol_use<span class="sc">+</span>smoker)</span>
<span id="cb94-3"><a href="" aria-hidden="true" tabindex="-1"></a>model3.avail <span class="ot">&lt;-</span> <span class="fu">update</span>(model2.avail, .<span class="sc">~</span>.<span class="sc">+</span>parent_income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div><div class="column fragment">
<h3 id="complete-case-analysis">Complete-case analysis</h3>
<p>To do this, we need to use <code>drop_na</code> on the Add Health variables that will be in the most complex model to make sure all models work with the same subset.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="" aria-hidden="true" tabindex="-1"></a>addhealth_complete <span class="ot">&lt;-</span> addhealth <span class="sc">|&gt;</span></span>
<span id="cb95-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(nominations, nsports, alcohol_use, smoker, </span>
<span id="cb95-3"><a href="" aria-hidden="true" tabindex="-1"></a>         parent_income) <span class="sc">|&gt;</span></span>
<span id="cb95-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">drop_na</span>()</span>
<span id="cb95-5"><a href="" aria-hidden="true" tabindex="-1"></a>model1.complete <span class="ot">&lt;-</span> <span class="fu">lm</span>(nominations<span class="sc">~</span>nsports,  </span>
<span id="cb95-6"><a href="" aria-hidden="true" tabindex="-1"></a>                      <span class="at">data =</span> addhealth_complete)</span>
<span id="cb95-7"><a href="" aria-hidden="true" tabindex="-1"></a>model2.complete <span class="ot">&lt;-</span> <span class="fu">update</span>(model1.complete, </span>
<span id="cb95-8"><a href="" aria-hidden="true" tabindex="-1"></a>                          .<span class="sc">~</span>.<span class="sc">+</span>alcohol_use<span class="sc">+</span>smoker)</span>
<span id="cb95-9"><a href="" aria-hidden="true" tabindex="-1"></a>model3.complete <span class="ot">&lt;-</span> <span class="fu">update</span>(model2.complete, </span>
<span id="cb95-10"><a href="" aria-hidden="true" tabindex="-1"></a>                          .<span class="sc">~</span>.<span class="sc">+</span>parent_income)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="what-is-different" class="slide level2">
<h2>What is different?</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div id="tbl-available-results" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-available-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;3: Models predicting number of friend nominations, available cases
</figcaption>
<div aria-describedby="tbl-available-results-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="hskridwdlz" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hskridwdlz table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hskridwdlz thead, #hskridwdlz tbody, #hskridwdlz tfoot, #hskridwdlz tr, #hskridwdlz td, #hskridwdlz th {
  border-style: none;
}

#hskridwdlz p {
  margin: 0;
  padding: 0;
}

#hskridwdlz .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hskridwdlz .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hskridwdlz .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hskridwdlz .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hskridwdlz .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hskridwdlz .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hskridwdlz .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hskridwdlz .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hskridwdlz .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hskridwdlz .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hskridwdlz .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hskridwdlz .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hskridwdlz .gt_spanner_row {
  border-bottom-style: hidden;
}

#hskridwdlz .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hskridwdlz .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hskridwdlz .gt_from_md > :first-child {
  margin-top: 0;
}

#hskridwdlz .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hskridwdlz .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hskridwdlz .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hskridwdlz .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hskridwdlz .gt_row_group_first td {
  border-top-width: 2px;
}

#hskridwdlz .gt_row_group_first th {
  border-top-width: 2px;
}

#hskridwdlz .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hskridwdlz .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hskridwdlz .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hskridwdlz .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hskridwdlz .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hskridwdlz .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hskridwdlz .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hskridwdlz .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hskridwdlz .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hskridwdlz .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hskridwdlz .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hskridwdlz .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hskridwdlz .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hskridwdlz .gt_left {
  text-align: left;
}

#hskridwdlz .gt_center {
  text-align: center;
}

#hskridwdlz .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hskridwdlz .gt_font_normal {
  font-weight: normal;
}

#hskridwdlz .gt_font_bold {
  font-weight: bold;
}

#hskridwdlz .gt_font_italic {
  font-style: italic;
}

#hskridwdlz .gt_super {
  font-size: 65%;
}

#hskridwdlz .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hskridwdlz .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hskridwdlz .gt_indent_1 {
  text-indent: 5px;
}

#hskridwdlz .gt_indent_2 {
  text-indent: 10px;
}

#hskridwdlz .gt_indent_3 {
  text-indent: 15px;
}

#hskridwdlz .gt_indent_4 {
  text-indent: 20px;
}

#hskridwdlz .gt_indent_5 {
  text-indent: 25px;
}

#hskridwdlz .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hskridwdlz div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a-" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="a(1)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(1)</th>
<th id="a(2)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(2)</th>
<th id="a(3)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(3)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Intercept</td>
<td class="gt_row gt_center" headers="(1)">3.997***</td>
<td class="gt_row gt_center" headers="(2)">3.851***</td>
<td class="gt_row gt_center" headers="(3)">3.391***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">(0.072)</td>
<td class="gt_row gt_center" headers="(2)">(0.079)</td>
<td class="gt_row gt_center" headers="(3)">(0.120)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Number of sports</td>
<td class="gt_row gt_center" headers="(1)">0.504***</td>
<td class="gt_row gt_center" headers="(2)">0.508***</td>
<td class="gt_row gt_center" headers="(3)">0.454***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">(0.043)</td>
<td class="gt_row gt_center" headers="(2)">(0.043)</td>
<td class="gt_row gt_center" headers="(3)">(0.049)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Drinker</td>
<td class="gt_row gt_center" headers="(1)"></td>
<td class="gt_row gt_center" headers="(2)">0.707***</td>
<td class="gt_row gt_center" headers="(3)">0.663***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)"></td>
<td class="gt_row gt_center" headers="(2)">(0.155)</td>
<td class="gt_row gt_center" headers="(3)">(0.180)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Smoker</td>
<td class="gt_row gt_center" headers="(1)"></td>
<td class="gt_row gt_center" headers="(2)">0.194</td>
<td class="gt_row gt_center" headers="(3)">0.383*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)"></td>
<td class="gt_row gt_center" headers="(2)">(0.162)</td>
<td class="gt_row gt_center" headers="(3)">(0.188)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Parental income (1000s USD)</td>
<td class="gt_row gt_center" headers="(1)"></td>
<td class="gt_row gt_center" headers="(2)"></td>
<td class="gt_row gt_center" headers="(3)">0.012***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" " style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="(1)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="(2)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="(3)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(0.002)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Num.Obs.</td>
<td class="gt_row gt_center" headers="(1)">4397</td>
<td class="gt_row gt_center" headers="(2)">4343</td>
<td class="gt_row gt_center" headers="(3)">3332</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">R2</td>
<td class="gt_row gt_center" headers="(1)">0.031</td>
<td class="gt_row gt_center" headers="(2)">0.037</td>
<td class="gt_row gt_center" headers="(3)">0.048</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="4" class="gt_sourcenote">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</div><div class="column">
<div class="cell">
<div id="tbl-complete-case" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-complete-case-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;4: Models predicting number of friend nominations, complete cases
</figcaption>
<div aria-describedby="tbl-complete-case-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="oumcseotoc" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#oumcseotoc table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#oumcseotoc thead, #oumcseotoc tbody, #oumcseotoc tfoot, #oumcseotoc tr, #oumcseotoc td, #oumcseotoc th {
  border-style: none;
}

#oumcseotoc p {
  margin: 0;
  padding: 0;
}

#oumcseotoc .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#oumcseotoc .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#oumcseotoc .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#oumcseotoc .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#oumcseotoc .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oumcseotoc .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oumcseotoc .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#oumcseotoc .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#oumcseotoc .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#oumcseotoc .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#oumcseotoc .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#oumcseotoc .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#oumcseotoc .gt_spanner_row {
  border-bottom-style: hidden;
}

#oumcseotoc .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#oumcseotoc .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#oumcseotoc .gt_from_md > :first-child {
  margin-top: 0;
}

#oumcseotoc .gt_from_md > :last-child {
  margin-bottom: 0;
}

#oumcseotoc .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#oumcseotoc .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#oumcseotoc .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#oumcseotoc .gt_row_group_first td {
  border-top-width: 2px;
}

#oumcseotoc .gt_row_group_first th {
  border-top-width: 2px;
}

#oumcseotoc .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oumcseotoc .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#oumcseotoc .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#oumcseotoc .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oumcseotoc .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#oumcseotoc .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#oumcseotoc .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#oumcseotoc .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#oumcseotoc .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#oumcseotoc .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oumcseotoc .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oumcseotoc .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#oumcseotoc .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#oumcseotoc .gt_left {
  text-align: left;
}

#oumcseotoc .gt_center {
  text-align: center;
}

#oumcseotoc .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#oumcseotoc .gt_font_normal {
  font-weight: normal;
}

#oumcseotoc .gt_font_bold {
  font-weight: bold;
}

#oumcseotoc .gt_font_italic {
  font-style: italic;
}

#oumcseotoc .gt_super {
  font-size: 65%;
}

#oumcseotoc .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#oumcseotoc .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#oumcseotoc .gt_indent_1 {
  text-indent: 5px;
}

#oumcseotoc .gt_indent_2 {
  text-indent: 10px;
}

#oumcseotoc .gt_indent_3 {
  text-indent: 15px;
}

#oumcseotoc .gt_indent_4 {
  text-indent: 20px;
}

#oumcseotoc .gt_indent_5 {
  text-indent: 25px;
}

#oumcseotoc .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#oumcseotoc div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a-" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="a(1)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(1)</th>
<th id="a(2)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(2)</th>
<th id="a(3)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(3)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Intercept</td>
<td class="gt_row gt_center" headers="(1)">4.051***</td>
<td class="gt_row gt_center" headers="(2)">3.876***</td>
<td class="gt_row gt_center" headers="(3)">3.391***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">(0.085)</td>
<td class="gt_row gt_center" headers="(2)">(0.091)</td>
<td class="gt_row gt_center" headers="(3)">(0.120)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Number of sports</td>
<td class="gt_row gt_center" headers="(1)">0.490***</td>
<td class="gt_row gt_center" headers="(2)">0.494***</td>
<td class="gt_row gt_center" headers="(3)">0.454***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">(0.049)</td>
<td class="gt_row gt_center" headers="(2)">(0.049)</td>
<td class="gt_row gt_center" headers="(3)">(0.049)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Drinker</td>
<td class="gt_row gt_center" headers="(1)"></td>
<td class="gt_row gt_center" headers="(2)">0.717***</td>
<td class="gt_row gt_center" headers="(3)">0.663***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)"></td>
<td class="gt_row gt_center" headers="(2)">(0.181)</td>
<td class="gt_row gt_center" headers="(3)">(0.180)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Smoker</td>
<td class="gt_row gt_center" headers="(1)"></td>
<td class="gt_row gt_center" headers="(2)">0.372*</td>
<td class="gt_row gt_center" headers="(3)">0.383*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)"></td>
<td class="gt_row gt_center" headers="(2)">(0.189)</td>
<td class="gt_row gt_center" headers="(3)">(0.188)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Parental income (1000s USD)</td>
<td class="gt_row gt_center" headers="(1)"></td>
<td class="gt_row gt_center" headers="(2)"></td>
<td class="gt_row gt_center" headers="(3)">0.012***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" " style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="(1)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="(2)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="(3)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(0.002)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Num.Obs.</td>
<td class="gt_row gt_center" headers="(1)">3332</td>
<td class="gt_row gt_center" headers="(2)">3332</td>
<td class="gt_row gt_center" headers="(3)">3332</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">R2</td>
<td class="gt_row gt_center" headers="(1)">0.029</td>
<td class="gt_row gt_center" headers="(2)">0.037</td>
<td class="gt_row gt_center" headers="(3)">0.048</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="4" class="gt_sourcenote">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</div></div>
</section>
<section id="imputation" class="slide level2 smaller">
<h2>Imputation</h2>
<div class="columns">
<div class="column fragment">
<h3 id="predictive-or-non-predictive">Predictive or non-Predictive?</h3>
<ul>
<li class="fragment">Imputations vary by whether or not they use other predictors in the data to assign imputed values to missing values.</li>
<li class="fragment">Predictive imputation is done via a statistical model.</li>
<li class="fragment">Predictive imputation moves the assumption from MAR to MCAR if the model is good.</li>
<li class="fragment">Non-predictive imputation will systematically bias correlation between variables downward.</li>
</ul>
</div><div class="column fragment">
<h3 id="inject-randomness">Inject Randomness?</h3>
<ul>
<li class="fragment">Imputations vary by whether or not they include a random component or are purely deterministic.</li>
<li class="fragment">Deterministic imputation techniques will underestimate variance in the imputed variable and will therefore underestimate standard errors.</li>
<li class="fragment">The use of randomization leads to another source of variation called <strong>imputation variation</strong> which can only be fully addressed through the technique of <strong>multiple imputation</strong>.</li>
</ul>
</div></div>
</section>
<section id="non-predictive-imputation" class="slide level2">
<h2>Non-Predictive Imputation</h2>
<p>A very simple (and poor) technique would be just to substitute the mean for valid responses for all missing values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="" aria-hidden="true" tabindex="-1"></a>addhealth <span class="ot">&lt;-</span> addhealth <span class="sc">|&gt;</span></span>
<span id="cb96-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">parent_income_missing =</span> <span class="fu">is.na</span>(parent_income),</span>
<span id="cb96-3"><a href="" aria-hidden="true" tabindex="-1"></a>         <span class="at">parent_income.meani =</span> <span class="fu">ifelse</span>(parent_income_missing, </span>
<span id="cb96-4"><a href="" aria-hidden="true" tabindex="-1"></a>                                     <span class="fu">mean</span>(parent_income, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb96-5"><a href="" aria-hidden="true" tabindex="-1"></a>                                     parent_income))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<p>Another similar technique that allows for more randomness is just to sample a random valid response on the same variable for each missing value.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb97"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb97-1"><a href="" aria-hidden="true" tabindex="-1"></a>addhealth<span class="sc">$</span>parent_income.randi <span class="ot">&lt;-</span> addhealth<span class="sc">$</span>parent_income</span>
<span id="cb97-2"><a href="" aria-hidden="true" tabindex="-1"></a>random_values <span class="ot">&lt;-</span> <span class="fu">sample</span>(<span class="fu">na.omit</span>(addhealth<span class="sc">$</span>parent_income), </span>
<span id="cb97-3"><a href="" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">sum</span>(<span class="fu">is.na</span>(addhealth<span class="sc">$</span>parent_income)))</span>
<span id="cb97-4"><a href="" aria-hidden="true" tabindex="-1"></a>addhealth<span class="sc">$</span>parent_income.randi[<span class="fu">is.na</span>(addhealth<span class="sc">$</span>parent_income)] <span class="ot">&lt;-</span> random_values</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="mean-and-random-imputation-add-health" class="slide level2">
<h2>Mean and random imputation, Add Health</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/plot_mean_impute-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column fragment">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/plot_random_impute-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="non-predictive-imputation-bad" class="slide level2">
<h2>Non-predictive imputation == Bad</h2>
<table class="caption-top">
<colgroup>
<col style="width: 30%">
<col style="width: 39%">
<col style="width: 29%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Sample</th>
<th style="text-align: right;"><span class="math inline">\(r\)</span> (nominations and income)</th>
<th style="text-align: right;">SD (income)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Valid cases</td>
<td style="text-align: right;">0.132</td>
<td style="text-align: right;">33.7</td>
</tr>
<tr class="even">
<td style="text-align: left;">Valid cases +mean imputed</td>
<td style="text-align: right;">0.117</td>
<td style="text-align: right;">29.5</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Valid cases +random imputed</td>
<td style="text-align: right;">0.105</td>
<td style="text-align: right;">33</td>
</tr>
</tbody>
</table>
<ul>
<li class="fragment">Both techniques will systematically underestimate correlation.</li>
<li class="fragment">Mean imputation will underestimate the variance of the imputed variable.</li>
</ul>
</section>
<section id="quick-and-dirty-method" class="slide level2 smaller">
<h2>Quick and dirty method</h2>
<p>If I do a mean imputation, I can also add a boolean variable for missingness as a predictor in my model. The effect of the imputed variable will be the same as if if I had thrown out missing values (because we are controlling for missingness), but I get to use the full data.</p>
<div class="cell">
<div id="tbl-missing-dummy" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-missing-dummy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;5: Models predicting friend nominations
</figcaption>
<div aria-describedby="tbl-missing-dummy-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="hosielaytf" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#hosielaytf table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#hosielaytf thead, #hosielaytf tbody, #hosielaytf tfoot, #hosielaytf tr, #hosielaytf td, #hosielaytf th {
  border-style: none;
}

#hosielaytf p {
  margin: 0;
  padding: 0;
}

#hosielaytf .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#hosielaytf .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#hosielaytf .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#hosielaytf .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#hosielaytf .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hosielaytf .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hosielaytf .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#hosielaytf .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#hosielaytf .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#hosielaytf .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#hosielaytf .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#hosielaytf .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#hosielaytf .gt_spanner_row {
  border-bottom-style: hidden;
}

#hosielaytf .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#hosielaytf .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#hosielaytf .gt_from_md > :first-child {
  margin-top: 0;
}

#hosielaytf .gt_from_md > :last-child {
  margin-bottom: 0;
}

#hosielaytf .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#hosielaytf .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#hosielaytf .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#hosielaytf .gt_row_group_first td {
  border-top-width: 2px;
}

#hosielaytf .gt_row_group_first th {
  border-top-width: 2px;
}

#hosielaytf .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hosielaytf .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#hosielaytf .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#hosielaytf .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hosielaytf .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#hosielaytf .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#hosielaytf .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#hosielaytf .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#hosielaytf .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#hosielaytf .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hosielaytf .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hosielaytf .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#hosielaytf .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#hosielaytf .gt_left {
  text-align: left;
}

#hosielaytf .gt_center {
  text-align: center;
}

#hosielaytf .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#hosielaytf .gt_font_normal {
  font-weight: normal;
}

#hosielaytf .gt_font_bold {
  font-weight: bold;
}

#hosielaytf .gt_font_italic {
  font-style: italic;
}

#hosielaytf .gt_super {
  font-size: 65%;
}

#hosielaytf .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#hosielaytf .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#hosielaytf .gt_indent_1 {
  text-indent: 5px;
}

#hosielaytf .gt_indent_2 {
  text-indent: 10px;
}

#hosielaytf .gt_indent_3 {
  text-indent: 15px;
}

#hosielaytf .gt_indent_4 {
  text-indent: 20px;
}

#hosielaytf .gt_indent_5 {
  text-indent: 25px;
}

#hosielaytf .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#hosielaytf div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a-" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="Drop-missing" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Drop missing</th>
<th id="Missing-dummy" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">Missing dummy</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Intercept</td>
<td class="gt_row gt_center" headers="Drop missing">3.931***</td>
<td class="gt_row gt_center" headers="Missing dummy">3.931***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="Drop missing">(0.107)</td>
<td class="gt_row gt_center" headers="Missing dummy">(0.106)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Parental income (1000s USD)</td>
<td class="gt_row gt_center" headers="Drop missing">0.015***</td>
<td class="gt_row gt_center" headers="Missing dummy">0.015***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="Drop missing">(0.002)</td>
<td class="gt_row gt_center" headers="Missing dummy">(0.002)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Parent income imputed</td>
<td class="gt_row gt_center" headers="Drop missing"></td>
<td class="gt_row gt_center" headers="Missing dummy">-0.187</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" " style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="Drop missing" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="Missing dummy" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(0.131)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Num.Obs.</td>
<td class="gt_row gt_center" headers="Drop missing">3370</td>
<td class="gt_row gt_center" headers="Missing dummy">4397</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">R2</td>
<td class="gt_row gt_center" headers="Drop missing">0.017</td>
<td class="gt_row gt_center" headers="Missing dummy">0.014</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="3" class="gt_sourcenote">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</figure>
</div>
</div>
<ul>
<li class="fragment">This model still assumes MCAR and reduces variance in the independent variable.</li>
<li class="fragment">Its primary advantage is that it is a quick method to avoid having to throw out cases that have valid data on other important variables.</li>
</ul>
</section>
<section id="regression-imputation" class="slide level2 smaller">
<h2>Regression imputation</h2>
<div class="columns">
<div class="column">
<ul>
<li class="fragment">I will predict the value of parental income by other independent variables (but never the dependent variable) using a linear model.</li>
<li class="fragment">In this case, I will transform parental income by the square root as well since it is heavily right skewed.</li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">sqrt</span>(parent_income)<span class="sc">~</span>race<span class="sc">+</span>pseudo_gpa<span class="sc">+</span></span>
<span id="cb98-2"><a href="" aria-hidden="true" tabindex="-1"></a>              honor_society<span class="sc">+</span>alcohol_use<span class="sc">+</span>smoker<span class="sc">+</span></span>
<span id="cb98-3"><a href="" aria-hidden="true" tabindex="-1"></a>              bandchoir<span class="sc">+</span>nsports, </span>
<span id="cb98-4"><a href="" aria-hidden="true" tabindex="-1"></a>            <span class="at">data=</span>addhealth)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</div><div class="column fragment">
<p>Then, I use the <code>predict</code> command to get predicted values for all observations and impute the predicted values (or their square, technically) for missing values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb99"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb99-1"><a href="" aria-hidden="true" tabindex="-1"></a>predicted <span class="ot">&lt;-</span> <span class="fu">predict</span>(model, addhealth)</span>
<span id="cb99-2"><a href="" aria-hidden="true" tabindex="-1"></a>addhealth<span class="sc">$</span>parent_income.regi <span class="ot">&lt;-</span> addhealth<span class="sc">$</span>parent_income</span>
<span id="cb99-3"><a href="" aria-hidden="true" tabindex="-1"></a>incmiss <span class="ot">&lt;-</span> <span class="fu">is.na</span>(addhealth<span class="sc">$</span>parent_income)</span>
<span id="cb99-4"><a href="" aria-hidden="true" tabindex="-1"></a>addhealth<span class="sc">$</span>parent_income.regi[incmiss] <span class="ot">&lt;-</span> predicted[incmiss]<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb99-5"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(addhealth<span class="sc">$</span>parent_income.regi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max.    NA's 
   0.00   25.00   39.05   44.05   55.00  200.00     259 </code></pre>
</div>
</div>
<p>I still have some missing values, because there were missing values on the variables I used to predict parental income.</p>
</div></div>
</section>
<section id="random-regression-imputation" class="slide level2">
<h2>Random regression imputation</h2>
<p>The previous model is deterministic, and will underestimate variance in parental income but I can add a random component to this by sampling from a normal distribution with a mean of zero and standard deviation equal to that of the model residuals.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="" aria-hidden="true" tabindex="-1"></a>addhealth<span class="sc">$</span>parent_income.rregi <span class="ot">&lt;-</span> addhealth<span class="sc">$</span>parent_income</span>
<span id="cb101-2"><a href="" aria-hidden="true" tabindex="-1"></a>addhealth<span class="sc">$</span>parent_income.rregi[incmiss] <span class="ot">&lt;-</span> (predicted[incmiss]<span class="sc">+</span></span>
<span id="cb101-3"><a href="" aria-hidden="true" tabindex="-1"></a>                                             <span class="fu">rnorm</span>(<span class="fu">sum</span>(incmiss), <span class="dv">0</span>, <span class="fu">sigma</span>(model)))<span class="sc">^</span><span class="dv">2</span></span>
<span id="cb101-4"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(addhealth<span class="sc">$</span>parent_income, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 33.6985</code></pre>
</div>
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(addhealth<span class="sc">$</span>parent_income.regi, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30.83101</code></pre>
</div>
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(addhealth<span class="sc">$</span>parent_income.rregi, <span class="at">na.rm=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 33.06674</code></pre>
</div>
</div>
</section>
<section id="regression-imputation-add-health" class="slide level2">
<h2>Regression imputation, Add Health</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-84-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/unnamed-chunk-85-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="chained-equations" class="slide level2 smaller">
<h2>Chained equations</h2>
<p>As you saw above, predictive imputation still leads to some missing values if the variables used for prediction also contain missing values. We can get around this via an iterative procedure called <strong>chained equations</strong>:</p>
<ol type="1">
<li class="fragment">All missing values are given some placeholder value. This might be the mean value, for example.</li>
<li class="fragment">For one variable, the placeholder values are removed and missing values put back in. These missing values are then predicted and imputed by some model for this variable.</li>
<li class="fragment">Step 2 is repeated for all variables with missing values. When all variables have been imputed, we have completed one iteration.</li>
<li class="fragment">Steps 2-3 are then repeated again for some number of iterations. The number of iterations necessary may vary by data, but five iterations is typical.</li>
</ol>
</section>
<section id="using-mice-to-impute-a-single-dataset" class="slide level2">
<h2>Using <code>mice</code> to impute a single dataset</h2>
<p>The <code>mice</code> command will use chained equations to impute missing values on <em>all</em> variables when a dataset is fed in. I can then use the <code>complete</code> command to extract a full dataset with no missing values.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(mice)</span>
<span id="cb107-2"><a href="" aria-hidden="true" tabindex="-1"></a>imputed <span class="ot">&lt;-</span> addhealth <span class="sc">|&gt;</span></span>
<span id="cb107-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(nominations, race, gender, grade, pseudo_gpa, honor_society, alcohol_use,</span>
<span id="cb107-4"><a href="" aria-hidden="true" tabindex="-1"></a>         smoker, bandchoir, nsports, parent_income) <span class="sc">|&gt;</span></span>
<span id="cb107-5"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mice</span>(<span class="at">m =</span> <span class="dv">1</span>, <span class="at">print =</span> <span class="cn">FALSE</span>)</span>
<span id="cb107-6"><a href="" aria-hidden="true" tabindex="-1"></a>addhealth_full <span class="ot">&lt;-</span> <span class="fu">complete</span>(imputed, <span class="dv">1</span>)</span>
<span id="cb107-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">apply</span>(<span class="fu">is.na</span>(addhealth_full), <span class="dv">2</span>, sum)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  nominations          race        gender         grade    pseudo_gpa 
            0             0             0             0             0 
honor_society   alcohol_use        smoker     bandchoir       nsports 
            0             0             0             0             0 
parent_income 
            0 </code></pre>
</div>
</div>
</section>
<section id="comparison-of-methods-1" class="slide level2">
<h2>Comparison of methods</h2>
<div class="cell">
<div id="tbl-impute-compare" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-impute-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;6: Models predicting friend nominations with different methods for missing values
</figcaption>
<div aria-describedby="tbl-impute-compare-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="squsnlretm" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#squsnlretm table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#squsnlretm thead, #squsnlretm tbody, #squsnlretm tfoot, #squsnlretm tr, #squsnlretm td, #squsnlretm th {
  border-style: none;
}

#squsnlretm p {
  margin: 0;
  padding: 0;
}

#squsnlretm .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#squsnlretm .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#squsnlretm .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#squsnlretm .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#squsnlretm .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#squsnlretm .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#squsnlretm .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#squsnlretm .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#squsnlretm .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#squsnlretm .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#squsnlretm .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#squsnlretm .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#squsnlretm .gt_spanner_row {
  border-bottom-style: hidden;
}

#squsnlretm .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#squsnlretm .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#squsnlretm .gt_from_md > :first-child {
  margin-top: 0;
}

#squsnlretm .gt_from_md > :last-child {
  margin-bottom: 0;
}

#squsnlretm .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#squsnlretm .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#squsnlretm .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#squsnlretm .gt_row_group_first td {
  border-top-width: 2px;
}

#squsnlretm .gt_row_group_first th {
  border-top-width: 2px;
}

#squsnlretm .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#squsnlretm .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#squsnlretm .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#squsnlretm .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#squsnlretm .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#squsnlretm .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#squsnlretm .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#squsnlretm .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#squsnlretm .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#squsnlretm .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#squsnlretm .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#squsnlretm .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#squsnlretm .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#squsnlretm .gt_left {
  text-align: left;
}

#squsnlretm .gt_center {
  text-align: center;
}

#squsnlretm .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#squsnlretm .gt_font_normal {
  font-weight: normal;
}

#squsnlretm .gt_font_bold {
  font-weight: bold;
}

#squsnlretm .gt_font_italic {
  font-style: italic;
}

#squsnlretm .gt_super {
  font-size: 65%;
}

#squsnlretm .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#squsnlretm .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#squsnlretm .gt_indent_1 {
  text-indent: 5px;
}

#squsnlretm .gt_indent_2 {
  text-indent: 10px;
}

#squsnlretm .gt_indent_3 {
  text-indent: 15px;
}

#squsnlretm .gt_indent_4 {
  text-indent: 20px;
}

#squsnlretm .gt_indent_5 {
  text-indent: 25px;
}

#squsnlretm .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#squsnlretm div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a-" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="deletion" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">deletion</th>
<th id="mean" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">mean</th>
<th id="mean-+-dummy" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">mean + dummy</th>
<th id="random" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">random</th>
<th id="regression" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">regression</th>
<th id="random-regression" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">random regression</th>
<th id="chained-equations" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">chained equations</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Intercept</td>
<td class="gt_row gt_center" headers="deletion">3.391***</td>
<td class="gt_row gt_center" headers="mean">3.360***</td>
<td class="gt_row gt_center" headers="mean + dummy">3.399***</td>
<td class="gt_row gt_center" headers="random">3.465***</td>
<td class="gt_row gt_center" headers="regression">3.367***</td>
<td class="gt_row gt_center" headers="random regression">3.403***</td>
<td class="gt_row gt_center" headers="chained equations">3.341***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="deletion">(0.120)</td>
<td class="gt_row gt_center" headers="mean">(0.111)</td>
<td class="gt_row gt_center" headers="mean + dummy">(0.115)</td>
<td class="gt_row gt_center" headers="random">(0.105)</td>
<td class="gt_row gt_center" headers="regression">(0.110)</td>
<td class="gt_row gt_center" headers="random regression">(0.108)</td>
<td class="gt_row gt_center" headers="chained equations">(0.103)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Number of sports</td>
<td class="gt_row gt_center" headers="deletion">0.454***</td>
<td class="gt_row gt_center" headers="mean">0.476***</td>
<td class="gt_row gt_center" headers="mean + dummy">0.474***</td>
<td class="gt_row gt_center" headers="random">0.483***</td>
<td class="gt_row gt_center" headers="regression">0.461***</td>
<td class="gt_row gt_center" headers="random regression">0.464***</td>
<td class="gt_row gt_center" headers="chained equations">0.463***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="deletion">(0.049)</td>
<td class="gt_row gt_center" headers="mean">(0.043)</td>
<td class="gt_row gt_center" headers="mean + dummy">(0.043)</td>
<td class="gt_row gt_center" headers="random">(0.043)</td>
<td class="gt_row gt_center" headers="regression">(0.045)</td>
<td class="gt_row gt_center" headers="random regression">(0.045)</td>
<td class="gt_row gt_center" headers="chained equations">(0.043)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Drinker</td>
<td class="gt_row gt_center" headers="deletion">0.663***</td>
<td class="gt_row gt_center" headers="mean">0.666***</td>
<td class="gt_row gt_center" headers="mean + dummy">0.668***</td>
<td class="gt_row gt_center" headers="random">0.666***</td>
<td class="gt_row gt_center" headers="regression">0.647***</td>
<td class="gt_row gt_center" headers="random regression">0.654***</td>
<td class="gt_row gt_center" headers="chained equations">0.614***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="deletion">(0.180)</td>
<td class="gt_row gt_center" headers="mean">(0.155)</td>
<td class="gt_row gt_center" headers="mean + dummy">(0.155)</td>
<td class="gt_row gt_center" headers="random">(0.155)</td>
<td class="gt_row gt_center" headers="regression">(0.163)</td>
<td class="gt_row gt_center" headers="random regression">(0.163)</td>
<td class="gt_row gt_center" headers="chained equations">(0.153)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Smoker</td>
<td class="gt_row gt_center" headers="deletion">0.383*</td>
<td class="gt_row gt_center" headers="mean">0.201</td>
<td class="gt_row gt_center" headers="mean + dummy">0.203</td>
<td class="gt_row gt_center" headers="random">0.202</td>
<td class="gt_row gt_center" headers="regression">0.257</td>
<td class="gt_row gt_center" headers="random regression">0.257</td>
<td class="gt_row gt_center" headers="chained equations">0.221</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="deletion">(0.188)</td>
<td class="gt_row gt_center" headers="mean">(0.161)</td>
<td class="gt_row gt_center" headers="mean + dummy">(0.161)</td>
<td class="gt_row gt_center" headers="random">(0.161)</td>
<td class="gt_row gt_center" headers="regression">(0.170)</td>
<td class="gt_row gt_center" headers="random regression">(0.170)</td>
<td class="gt_row gt_center" headers="chained equations">(0.159)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Parental income (1000s USD)</td>
<td class="gt_row gt_center" headers="deletion">0.012***</td>
<td class="gt_row gt_center" headers="mean">0.012***</td>
<td class="gt_row gt_center" headers="mean + dummy">0.012***</td>
<td class="gt_row gt_center" headers="random">0.009***</td>
<td class="gt_row gt_center" headers="regression">0.013***</td>
<td class="gt_row gt_center" headers="random regression">0.012***</td>
<td class="gt_row gt_center" headers="chained equations">0.013***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="deletion">(0.002)</td>
<td class="gt_row gt_center" headers="mean">(0.002)</td>
<td class="gt_row gt_center" headers="mean + dummy">(0.002)</td>
<td class="gt_row gt_center" headers="random">(0.002)</td>
<td class="gt_row gt_center" headers="regression">(0.002)</td>
<td class="gt_row gt_center" headers="random regression">(0.002)</td>
<td class="gt_row gt_center" headers="chained equations">(0.002)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Parent income imputed</td>
<td class="gt_row gt_center" headers="deletion"></td>
<td class="gt_row gt_center" headers="mean"></td>
<td class="gt_row gt_center" headers="mean + dummy">-0.162</td>
<td class="gt_row gt_center" headers="random"></td>
<td class="gt_row gt_center" headers="regression"></td>
<td class="gt_row gt_center" headers="random regression"></td>
<td class="gt_row gt_center" headers="chained equations"></td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" " style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="deletion" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="mean" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="mean + dummy" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(0.130)</td>
<td class="gt_row gt_center" headers="random" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="regression" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="random regression" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="chained equations" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Num.Obs.</td>
<td class="gt_row gt_center" headers="deletion">3332</td>
<td class="gt_row gt_center" headers="mean">4343</td>
<td class="gt_row gt_center" headers="mean + dummy">4343</td>
<td class="gt_row gt_center" headers="random">4343</td>
<td class="gt_row gt_center" headers="regression">4100</td>
<td class="gt_row gt_center" headers="random regression">4100</td>
<td class="gt_row gt_center" headers="chained equations">4397</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">R2</td>
<td class="gt_row gt_center" headers="deletion">0.048</td>
<td class="gt_row gt_center" headers="mean">0.046</td>
<td class="gt_row gt_center" headers="mean + dummy">0.046</td>
<td class="gt_row gt_center" headers="random">0.044</td>
<td class="gt_row gt_center" headers="regression">0.048</td>
<td class="gt_row gt_center" headers="random regression">0.047</td>
<td class="gt_row gt_center" headers="chained equations">0.049</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="8" class="gt_sourcenote">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="imputation-variability" class="slide level2">
<h2>Imputation variability</h2>
<ul>
<li class="fragment">The methods of random imputation have the benefit of preserving the standard deviation of the imputed variable and therefore calculating correct standard errors, but they also introduce a new source of uncertainty.</li>
<li class="fragment">Each time I do an imputation with a random component (e.g.&nbsp;random regression, chained equation), I will get a somewhat different set of values.</li>
<li class="fragment">Therefore, we now have <strong>imputation variability</strong> to add to our inferential concerns alongside <strong>sampling variability</strong>.</li>
<li class="fragment">We can use <strong>multiple imputation</strong> to adjust our results for <strong>imputation variability</strong>.</li>
</ul>
</section>
<section id="multiple-imputation-process" class="slide level2 smaller">
<h2>Multiple imputation process</h2>
<ol type="1">
<li class="fragment">Use imputation process with random component to impute missing values and repeat this process to produce <span class="math inline">\(m\)</span> separate <strong>complete datasets</strong>. Each of these datasets will be somewhat different due to the randomization of imputation. Usually <span class="math inline">\(m=5\)</span> is sufficient.</li>
<li class="fragment">Run <span class="math inline">\(m\)</span> separate parallel models on each imputed <strong>complete dataset</strong>. As a result, you will have <span class="math inline">\(m\)</span> sets of regression coefficients and standard errors.</li>
<li class="fragment">Pool the regression coefficients across datasets by taking the mean across all <span class="math inline">\(m\)</span> datasets.</li>
<li class="fragment">Pool standard errors by taking the mean across all <span class="math inline">\(m\)</span> datasets <em>plus</em> the between model standard deviation in coefficients. The formula for the overall standard error is:</li>
</ol>
<div class="fragment">
<p><span class="math display">\[SE_{\beta}=\sqrt{W+(B+\frac{B}{m})}\]</span> Where <span class="math inline">\(W\)</span> is the squared mean standard error across all <span class="math inline">\(m\)</span> datasets, and <span class="math inline">\(B\)</span> is the variance in coefficient estimates calculated across all <span class="math inline">\(m\)</span> models.</p>
</div>
</section>
<section id="multiple-imputation-with-the-mice-package" class="slide level2">
<h2>Multiple imputation with the <code>mice</code> package</h2>
<p>To get multiple complete datasets with <code>mice</code> we just need to specify the number of distinct complete datasets to create in the second argument:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="" aria-hidden="true" tabindex="-1"></a>imputations <span class="ot">&lt;-</span> <span class="fu">mice</span>(addhealth, <span class="dv">5</span>, <span class="at">printFlag=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment">The imputations object now contains five fully complete imputed datasets. Its possible to extract any one of these datasets with the command <code>complete(imputations, i)</code> where <code>i</code> is replaced by a number between 1 and 5.</li>
<li class="fragment">We can now conduct our parallel analysis on these five datasets and combine results. There is an easy and a hard way to do this. Its useful to know both.</li>
</ul>
</section>
<section id="easy-way-let-mice-do-the-hard-work" class="slide level2">
<h2>Easy way: let <code>mice</code> do the hard work</h2>
<p>The <code>mice</code> package has a lot of nice features, including an object specific function for the <code>with</code> command and a <code>pool</code> command that make multiple imputation as easy as falling off a log:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="" aria-hidden="true" tabindex="-1"></a>model_mi <span class="ot">&lt;-</span> <span class="fu">pool</span>(<span class="fu">with</span>(imputations, </span>
<span id="cb110-2"><a href="" aria-hidden="true" tabindex="-1"></a>                      <span class="fu">lm</span>(nominations<span class="sc">~</span>parent_income<span class="sc">+</span>smoker<span class="sc">+</span>alcohol_use<span class="sc">+</span>nsports)))</span>
<span id="cb110-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model_mi)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                term  estimate  std.error statistic        df       p.value
1        (Intercept) 3.3762564 0.10682681 31.604954  557.0758 2.366553e-126
2      parent_income 0.0117380 0.00175684  6.681312  203.9662  2.210804e-10
3       smokerSmoker 0.1827329 0.15963841  1.144668 4362.2992  2.524096e-01
4 alcohol_useDrinker 0.6447113 0.15501409  4.159050 3507.2341  3.272288e-05
5            nsports 0.4664538 0.04300696 10.846009 4374.3326  4.591097e-27</code></pre>
</div>
</div>
</section>
<section id="hard-way-for-loop" class="slide level2 smaller">
<h2>Hard way: for-loop</h2>
<p>The hard way isn’t really that hard. It is useful to know for cases where the easy way won’t work, such as when you need to run complicated models (using <code>svydesign</code> would be an example).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="" aria-hidden="true" tabindex="-1"></a>b <span class="ot">&lt;-</span> se <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb112-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>) {</span>
<span id="cb112-3"><a href="" aria-hidden="true" tabindex="-1"></a>  imputation <span class="ot">&lt;-</span> <span class="fu">complete</span>(imputations, i)</span>
<span id="cb112-4"><a href="" aria-hidden="true" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">lm</span>(nominations<span class="sc">~</span>parent_income<span class="sc">+</span>smoker<span class="sc">+</span>alcohol_use<span class="sc">+</span>nsports, </span>
<span id="cb112-5"><a href="" aria-hidden="true" tabindex="-1"></a>              <span class="at">data=</span>imputation)</span>
<span id="cb112-6"><a href="" aria-hidden="true" tabindex="-1"></a>  b <span class="ot">&lt;-</span> <span class="fu">cbind</span>(b, <span class="fu">coef</span>(model))</span>
<span id="cb112-7"><a href="" aria-hidden="true" tabindex="-1"></a>  se <span class="ot">&lt;-</span> <span class="fu">cbind</span>(se, <span class="fu">summary</span>(model)<span class="sc">$</span>coef[,<span class="dv">2</span>])</span>
<span id="cb112-8"><a href="" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb112-9"><a href="" aria-hidden="true" tabindex="-1"></a>b</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                         [,1]       [,2]       [,3]      [,4]       [,5]
(Intercept)        3.33020283 3.37406214 3.38452960 3.3962172 3.39627019
parent_income      0.01272496 0.01181009 0.01155462 0.0113509 0.01124942
smokerSmoker       0.17797797 0.18105099 0.17671027 0.1850978 0.19282767
alcohol_useDrinker 0.67318089 0.63889582 0.62873247 0.6361494 0.64659808
nsports            0.46421849 0.46691115 0.46652235 0.4663078 0.46830941</code></pre>
</div>
</div>
<p>The <code>b</code> and <code>se</code> objects are matrices that contain the coefficients and standard errors, respectively, for each model on the column.</p>
</section>
<section id="hard-way-pool-the-results" class="slide level2">
<h2>Hard way: pool the results</h2>
<p>Now we can pool the results using the <code>b</code> and <code>se</code> matrices and some creative use of <code>apply</code> commands.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="" aria-hidden="true" tabindex="-1"></a>b.pool <span class="ot">&lt;-</span> <span class="fu">apply</span>(b,<span class="dv">1</span>,mean)</span>
<span id="cb114-2"><a href="" aria-hidden="true" tabindex="-1"></a>between.var <span class="ot">&lt;-</span> <span class="fu">apply</span>(b,<span class="dv">1</span>,var)</span>
<span id="cb114-3"><a href="" aria-hidden="true" tabindex="-1"></a>within.var <span class="ot">&lt;-</span> <span class="fu">apply</span>(se<span class="sc">^</span><span class="dv">2</span>,<span class="dv">1</span>,mean)</span>
<span id="cb114-4"><a href="" aria-hidden="true" tabindex="-1"></a>se.pool <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(within.var<span class="sc">+</span>between.var<span class="sc">+</span>between.var<span class="sc">/</span><span class="dv">5</span>)</span>
<span id="cb114-5"><a href="" aria-hidden="true" tabindex="-1"></a>t.pool <span class="ot">&lt;-</span> b.pool<span class="sc">/</span>se.pool</span>
<span id="cb114-6"><a href="" aria-hidden="true" tabindex="-1"></a>pvalue.pool <span class="ot">&lt;-</span> (<span class="dv">1</span><span class="sc">-</span><span class="fu">pnorm</span>(<span class="fu">abs</span>(t.pool)))<span class="sc">*</span><span class="dv">2</span></span>
<span id="cb114-7"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(b.pool, se.pool, t.pool, pvalue.pool) <span class="sc">|&gt;</span></span>
<span id="cb114-8"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">gt</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="kpmncotect" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#kpmncotect table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#kpmncotect thead, #kpmncotect tbody, #kpmncotect tfoot, #kpmncotect tr, #kpmncotect td, #kpmncotect th {
  border-style: none;
}

#kpmncotect p {
  margin: 0;
  padding: 0;
}

#kpmncotect .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#kpmncotect .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#kpmncotect .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#kpmncotect .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#kpmncotect .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kpmncotect .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kpmncotect .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#kpmncotect .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#kpmncotect .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#kpmncotect .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#kpmncotect .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#kpmncotect .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#kpmncotect .gt_spanner_row {
  border-bottom-style: hidden;
}

#kpmncotect .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#kpmncotect .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#kpmncotect .gt_from_md > :first-child {
  margin-top: 0;
}

#kpmncotect .gt_from_md > :last-child {
  margin-bottom: 0;
}

#kpmncotect .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#kpmncotect .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#kpmncotect .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#kpmncotect .gt_row_group_first td {
  border-top-width: 2px;
}

#kpmncotect .gt_row_group_first th {
  border-top-width: 2px;
}

#kpmncotect .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kpmncotect .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#kpmncotect .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#kpmncotect .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kpmncotect .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#kpmncotect .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#kpmncotect .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#kpmncotect .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#kpmncotect .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#kpmncotect .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kpmncotect .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kpmncotect .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#kpmncotect .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#kpmncotect .gt_left {
  text-align: left;
}

#kpmncotect .gt_center {
  text-align: center;
}

#kpmncotect .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#kpmncotect .gt_font_normal {
  font-weight: normal;
}

#kpmncotect .gt_font_bold {
  font-weight: bold;
}

#kpmncotect .gt_font_italic {
  font-style: italic;
}

#kpmncotect .gt_super {
  font-size: 65%;
}

#kpmncotect .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#kpmncotect .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#kpmncotect .gt_indent_1 {
  text-indent: 5px;
}

#kpmncotect .gt_indent_2 {
  text-indent: 10px;
}

#kpmncotect .gt_indent_3 {
  text-indent: 15px;
}

#kpmncotect .gt_indent_4 {
  text-indent: 20px;
}

#kpmncotect .gt_indent_5 {
  text-indent: 25px;
}

#kpmncotect .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#kpmncotect div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="b.pool" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">b.pool</th>
<th id="se.pool" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">se.pool</th>
<th id="t.pool" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">t.pool</th>
<th id="pvalue.pool" class="gt_col_heading gt_columns_bottom_border gt_right" data-quarto-table-cell-role="th" scope="col">pvalue.pool</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_right" headers="b.pool">3.3762564</td>
<td class="gt_row gt_right" headers="se.pool">0.10682681</td>
<td class="gt_row gt_right" headers="t.pool">31.604954</td>
<td class="gt_row gt_right" headers="pvalue.pool">0.000000e+00</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="b.pool">0.0117380</td>
<td class="gt_row gt_right" headers="se.pool">0.00175684</td>
<td class="gt_row gt_right" headers="t.pool">6.681312</td>
<td class="gt_row gt_right" headers="pvalue.pool">2.368128e-11</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="b.pool">0.1827329</td>
<td class="gt_row gt_right" headers="se.pool">0.15963841</td>
<td class="gt_row gt_right" headers="t.pool">1.144668</td>
<td class="gt_row gt_right" headers="pvalue.pool">2.523468e-01</td>
</tr>
<tr class="even">
<td class="gt_row gt_right" headers="b.pool">0.6447113</td>
<td class="gt_row gt_right" headers="se.pool">0.15501409</td>
<td class="gt_row gt_right" headers="t.pool">4.159050</td>
<td class="gt_row gt_right" headers="pvalue.pool">3.195743e-05</td>
</tr>
<tr class="odd">
<td class="gt_row gt_right" headers="b.pool">0.4664538</td>
<td class="gt_row gt_right" headers="se.pool">0.04300696</td>
<td class="gt_row gt_right" headers="t.pool">10.846009</td>
<td class="gt_row gt_right" headers="pvalue.pool">0.000000e+00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
</section></section>
<section>
<section id="multicollinearity-and-scale-creation" class="title-slide slide level1 center" data-background-color="black" data-background-image="images/nareeta-martin-z7LRp54Yulw-unsplash.jpg">
<h1>Multicollinearity and Scale Creation</h1>

</section>
<section id="the-problem-of-multicollinearity" class="slide level2 smaller">
<h2>The problem of multicollinearity</h2>
<ul>
<li class="fragment">Given that adding more independent variables to your model allows you to account for potential omitted variable bias, why wouldn’t you just put in as many variables as you can?</li>
<li class="fragment">Because of <strong>multicollinearity</strong>. Multicollinearity occurs when there is collectively a high correlation between the independent variables in the model.</li>
<li class="fragment">Intuitively, its easy to understand why multicollinearity is a problem. When two independent variables are highly correlated with one another, it becomes hard to separate out their effect on the dependent variable.</li>
<li class="fragment">Technically, the effect of multicollinearity is to inflate standard errors and make coefficient estimates highly unstable across different combinations of highly collinear terms in the model.</li>
</ul>
</section>
<section id="two-kinds-of-multicollinearity" class="slide level2">
<h2>Two kinds of multicollinearity</h2>
<div class="columns">
<div class="column fragment">
<h3 id="structural-multicollinearity">Structural multicollinearity</h3>
<p>Structural multicollinearity occurs when one independent variable is completely determined by another independent variable or set of independent variables. This really isn’t an issue with the data, but rather a specification error by the researcher.</p>
</div><div class="column fragment">
<h3 id="data-based-multicollinearity">Data-based multicollinearity</h3>
<p>Data-based multicollinearity occurs when a set of variables are highly but not perfectly correlated with one another in the empirical data. It is a hazard of using observational data where the characteristics for which you want to get separate effects are difficult to separate.</p>
</div></div>
</section>
<section id="example-of-structural-multicollinearity" class="slide level2">
<h2>Example of structural multicollinearity</h2>
<p>Lets predict violent crime by percent female <strong>and</strong> percent male.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="" aria-hidden="true" tabindex="-1"></a>crimes<span class="sc">$</span>percent_female <span class="ot">&lt;-</span> <span class="dv">100</span><span class="sc">-</span>crimes<span class="sc">$</span>percent_male</span>
<span id="cb115-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">lm</span>(violent_rate<span class="sc">~</span>percent_male<span class="sc">+</span>percent_female, <span class="at">data =</span> crimes))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="fragment">
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = violent_rate ~ percent_male + percent_female, data = crimes)

Residuals:
    Min      1Q  Median      3Q     Max 
-275.24 -104.25  -40.38   61.07  695.41 

Coefficients: (1 not defined because of singularities)
               Estimate Std. Error t value Pr(&gt;|t|)
(Intercept)     2067.27    1482.04   1.395    0.169
percent_male     -34.11      30.00  -1.137    0.261
percent_female       NA         NA      NA       NA

Residual standard error: 177.2 on 49 degrees of freedom
Multiple R-squared:  0.0257,    Adjusted R-squared:  0.005817 
F-statistic: 1.293 on 1 and 49 DF,  p-value: 0.2611</code></pre>
</div>
</div>
</div>
</section>
<section id="singularity-not-as-cool-as-it-sounds." class="slide level2">
<h2>Singularity! Not as cool as it sounds.</h2>
<div class="columns">
<div class="column" style="width:25%;">
<p><img data-src="images/picard_facepalm.gif"></p>
</div><div class="column" style="width:75%;">
<p>One of the terms was dropped from the model because the terms are perfectly collinear.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(crimes<span class="sc">$</span>percent_female, crimes<span class="sc">$</span>percent_male)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] -1</code></pre>
</div>
</div>
<p>This is not a problem of the model, but our thinking. Either term by itself will give you full information.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(violent_rate<span class="sc">~</span>percent_male, <span class="at">data =</span> crimes))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> (Intercept) percent_male 
  2067.26563    -34.10628 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">coef</span>(<span class="fu">lm</span>(violent_rate<span class="sc">~</span>percent_female, <span class="at">data =</span> crimes))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   (Intercept) percent_female 
   -1343.36192       34.10628 </code></pre>
</div>
</div>
</div></div>
</section>
<section id="detecting-data-based-multicollinearity" class="slide level2">
<h2>Detecting data-based multicollinearity</h2>
<div class="columns">
<div class="column" style="width:25%;">
<p><img data-src="images/detective.jpg"></p>
</div><div class="column" style="width:75%;">
<ul>
<li class="fragment">Look for weirdness across nested models:
<ul>
<li class="fragment">Standard errors increase substantially across nested models with more covariates</li>
<li class="fragment">Model coefficients are highly unstable across nested models</li>
</ul></li>
<li class="fragment">Examine the correlation matrix for high correlations</li>
<li class="fragment">Calculate variance inflation factors</li>
</ul>
</div></div>
</section>
<section id="multicollinearity-example-nyc-non-profits" class="slide level2 smaller">
<h2>Multicollinearity example: NYC non-profits</h2>
<div class="columns">
<div class="column">
<p>We will look at data collected by myself and Nicole Marwell on the spatial distribution of money contracted out to organization for social services by the City of New York from 1997-2001. The unit of analysis is a NYC health area, which can loosely be thought of as a neighborhood. The variables are:</p>
<div>
<ul>
<li><strong>amountcapita</strong>: The dollar amount of money provided to the health area divided by the population size of the health area. We will log it due to skewness.</li>
<li><strong>poverty</strong>: percent of population below the poverty line.</li>
<li><strong>unemployed</strong>: unemployment rate.</li>
<li><strong>income</strong>: median household income. We will log it due to skewness.</li>
</ul>
</div>
</div><div class="column">
<div class="cell">
<div class="cell-output-display">
<div id="fig-nyc-map" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-nyc-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="slides_model_complications_files/figure-revealjs/fig-nyc-map-1.png" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-nyc-map-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;13: Per capita services contracted out in NYC by health area, 1997-2001
</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="model-results-nyc-example" class="slide level2">
<h2>Model results, NYC example</h2>
<div class="cell">
<div id="tbl-model-nyc-multicol" class="cell quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-tbl">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-model-nyc-multicol-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;7: Linear models predicting per-capita social service spending (logged)
</figcaption>
<div aria-describedby="tbl-model-nyc-multicol-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="cell-output-display">
<div id="zeumdiiehu" style="padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;">
<style>#zeumdiiehu table {
  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

#zeumdiiehu thead, #zeumdiiehu tbody, #zeumdiiehu tfoot, #zeumdiiehu tr, #zeumdiiehu td, #zeumdiiehu th {
  border-style: none;
}

#zeumdiiehu p {
  margin: 0;
  padding: 0;
}

#zeumdiiehu .gt_table {
  display: table;
  border-collapse: collapse;
  line-height: normal;
  margin-left: auto;
  margin-right: auto;
  color: #333333;
  font-size: 16px;
  font-weight: normal;
  font-style: normal;
  background-color: #FFFFFF;
  width: auto;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #A8A8A8;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #A8A8A8;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
}

#zeumdiiehu .gt_caption {
  padding-top: 4px;
  padding-bottom: 4px;
}

#zeumdiiehu .gt_title {
  color: #333333;
  font-size: 125%;
  font-weight: initial;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-color: #FFFFFF;
  border-bottom-width: 0;
}

#zeumdiiehu .gt_subtitle {
  color: #333333;
  font-size: 85%;
  font-weight: initial;
  padding-top: 3px;
  padding-bottom: 5px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-color: #FFFFFF;
  border-top-width: 0;
}

#zeumdiiehu .gt_heading {
  background-color: #FFFFFF;
  text-align: center;
  border-bottom-color: #FFFFFF;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zeumdiiehu .gt_bottom_border {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zeumdiiehu .gt_col_headings {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
}

#zeumdiiehu .gt_col_heading {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 6px;
  padding-left: 5px;
  padding-right: 5px;
  overflow-x: hidden;
}

#zeumdiiehu .gt_column_spanner_outer {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: normal;
  text-transform: inherit;
  padding-top: 0;
  padding-bottom: 0;
  padding-left: 4px;
  padding-right: 4px;
}

#zeumdiiehu .gt_column_spanner_outer:first-child {
  padding-left: 0;
}

#zeumdiiehu .gt_column_spanner_outer:last-child {
  padding-right: 0;
}

#zeumdiiehu .gt_column_spanner {
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: bottom;
  padding-top: 5px;
  padding-bottom: 5px;
  overflow-x: hidden;
  display: inline-block;
  width: 100%;
}

#zeumdiiehu .gt_spanner_row {
  border-bottom-style: hidden;
}

#zeumdiiehu .gt_group_heading {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  text-align: left;
}

#zeumdiiehu .gt_empty_group_heading {
  padding: 0.5px;
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  vertical-align: middle;
}

#zeumdiiehu .gt_from_md > :first-child {
  margin-top: 0;
}

#zeumdiiehu .gt_from_md > :last-child {
  margin-bottom: 0;
}

#zeumdiiehu .gt_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  margin: 10px;
  border-top-style: solid;
  border-top-width: 1px;
  border-top-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 1px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 1px;
  border-right-color: #D3D3D3;
  vertical-align: middle;
  overflow-x: hidden;
}

#zeumdiiehu .gt_stub {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
}

#zeumdiiehu .gt_stub_row_group {
  color: #333333;
  background-color: #FFFFFF;
  font-size: 100%;
  font-weight: initial;
  text-transform: inherit;
  border-right-style: solid;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
  padding-left: 5px;
  padding-right: 5px;
  vertical-align: top;
}

#zeumdiiehu .gt_row_group_first td {
  border-top-width: 2px;
}

#zeumdiiehu .gt_row_group_first th {
  border-top-width: 2px;
}

#zeumdiiehu .gt_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zeumdiiehu .gt_first_summary_row {
  border-top-style: solid;
  border-top-color: #D3D3D3;
}

#zeumdiiehu .gt_first_summary_row.thick {
  border-top-width: 2px;
}

#zeumdiiehu .gt_last_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zeumdiiehu .gt_grand_summary_row {
  color: #333333;
  background-color: #FFFFFF;
  text-transform: inherit;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
}

#zeumdiiehu .gt_first_grand_summary_row {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-top-style: double;
  border-top-width: 6px;
  border-top-color: #D3D3D3;
}

#zeumdiiehu .gt_last_grand_summary_row_top {
  padding-top: 8px;
  padding-bottom: 8px;
  padding-left: 5px;
  padding-right: 5px;
  border-bottom-style: double;
  border-bottom-width: 6px;
  border-bottom-color: #D3D3D3;
}

#zeumdiiehu .gt_striped {
  background-color: rgba(128, 128, 128, 0.05);
}

#zeumdiiehu .gt_table_body {
  border-top-style: solid;
  border-top-width: 2px;
  border-top-color: #D3D3D3;
  border-bottom-style: solid;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
}

#zeumdiiehu .gt_footnotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zeumdiiehu .gt_footnote {
  margin: 0px;
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zeumdiiehu .gt_sourcenotes {
  color: #333333;
  background-color: #FFFFFF;
  border-bottom-style: none;
  border-bottom-width: 2px;
  border-bottom-color: #D3D3D3;
  border-left-style: none;
  border-left-width: 2px;
  border-left-color: #D3D3D3;
  border-right-style: none;
  border-right-width: 2px;
  border-right-color: #D3D3D3;
}

#zeumdiiehu .gt_sourcenote {
  font-size: 90%;
  padding-top: 4px;
  padding-bottom: 4px;
  padding-left: 5px;
  padding-right: 5px;
}

#zeumdiiehu .gt_left {
  text-align: left;
}

#zeumdiiehu .gt_center {
  text-align: center;
}

#zeumdiiehu .gt_right {
  text-align: right;
  font-variant-numeric: tabular-nums;
}

#zeumdiiehu .gt_font_normal {
  font-weight: normal;
}

#zeumdiiehu .gt_font_bold {
  font-weight: bold;
}

#zeumdiiehu .gt_font_italic {
  font-style: italic;
}

#zeumdiiehu .gt_super {
  font-size: 65%;
}

#zeumdiiehu .gt_footnote_marks {
  font-size: 75%;
  vertical-align: 0.4em;
  position: initial;
}

#zeumdiiehu .gt_asterisk {
  font-size: 100%;
  vertical-align: 0;
}

#zeumdiiehu .gt_indent_1 {
  text-indent: 5px;
}

#zeumdiiehu .gt_indent_2 {
  text-indent: 10px;
}

#zeumdiiehu .gt_indent_3 {
  text-indent: 15px;
}

#zeumdiiehu .gt_indent_4 {
  text-indent: 20px;
}

#zeumdiiehu .gt_indent_5 {
  text-indent: 25px;
}

#zeumdiiehu .katex-display {
  display: inline-flex !important;
  margin-bottom: 0.75em !important;
}

#zeumdiiehu div.Reactable > div.rt-table > div.rt-thead > div.rt-tr.rt-tr-group-header > div.rt-th-group:after {
  height: 0px !important;
}
</style>

<table class="gt_table do-not-create-environment cell caption-top" data-quarto-postprocess="true" data-quarto-disable-processing="false" data-quarto-bootstrap="false">
<thead>
<tr class="gt_col_headings header">
<th id="a-" class="gt_col_heading gt_columns_bottom_border gt_left" data-quarto-table-cell-role="th" scope="col"></th>
<th id="a(1)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(1)</th>
<th id="a(2)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(2)</th>
<th id="a(3)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(3)</th>
<th id="a(4)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(4)</th>
<th id="a(5)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(5)</th>
<th id="a(6)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(6)</th>
<th id="a(7)" class="gt_col_heading gt_columns_bottom_border gt_center" data-quarto-table-cell-role="th" scope="col">(7)</th>
</tr>
</thead>
<tbody class="gt_table_body">
<tr class="odd">
<td class="gt_row gt_left" headers=" ">intercept</td>
<td class="gt_row gt_center" headers="(1)">4.142***</td>
<td class="gt_row gt_center" headers="(2)">4.135***</td>
<td class="gt_row gt_center" headers="(3)">10.238***</td>
<td class="gt_row gt_center" headers="(4)">4.121***</td>
<td class="gt_row gt_center" headers="(5)">-24.699***</td>
<td class="gt_row gt_center" headers="(6)">3.078</td>
<td class="gt_row gt_center" headers="(7)">-29.597***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">(0.172)</td>
<td class="gt_row gt_center" headers="(2)">(0.231)</td>
<td class="gt_row gt_center" headers="(3)">(2.052)</td>
<td class="gt_row gt_center" headers="(4)">(0.226)</td>
<td class="gt_row gt_center" headers="(5)">(4.941)</td>
<td class="gt_row gt_center" headers="(6)">(3.272)</td>
<td class="gt_row gt_center" headers="(7)">(5.309)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">poverty rate</td>
<td class="gt_row gt_center" headers="(1)">0.039***</td>
<td class="gt_row gt_center" headers="(2)"></td>
<td class="gt_row gt_center" headers="(3)"></td>
<td class="gt_row gt_center" headers="(4)">0.038***</td>
<td class="gt_row gt_center" headers="(5)">0.127***</td>
<td class="gt_row gt_center" headers="(6)"></td>
<td class="gt_row gt_center" headers="(7)">0.124***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)">(0.007)</td>
<td class="gt_row gt_center" headers="(2)"></td>
<td class="gt_row gt_center" headers="(3)"></td>
<td class="gt_row gt_center" headers="(4)">(0.010)</td>
<td class="gt_row gt_center" headers="(5)">(0.017)</td>
<td class="gt_row gt_center" headers="(6)"></td>
<td class="gt_row gt_center" headers="(7)">(0.017)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">unemployment rate</td>
<td class="gt_row gt_center" headers="(1)"></td>
<td class="gt_row gt_center" headers="(2)">0.091***</td>
<td class="gt_row gt_center" headers="(3)"></td>
<td class="gt_row gt_center" headers="(4)">0.005</td>
<td class="gt_row gt_center" headers="(5)"></td>
<td class="gt_row gt_center" headers="(6)">0.100**</td>
<td class="gt_row gt_center" headers="(7)">0.080*</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" "></td>
<td class="gt_row gt_center" headers="(1)"></td>
<td class="gt_row gt_center" headers="(2)">(0.024)</td>
<td class="gt_row gt_center" headers="(3)"></td>
<td class="gt_row gt_center" headers="(4)">(0.033)</td>
<td class="gt_row gt_center" headers="(5)"></td>
<td class="gt_row gt_center" headers="(6)">(0.036)</td>
<td class="gt_row gt_center" headers="(7)">(0.033)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">median income (logged)</td>
<td class="gt_row gt_center" headers="(1)"></td>
<td class="gt_row gt_center" headers="(2)"></td>
<td class="gt_row gt_center" headers="(3)">-0.493*</td>
<td class="gt_row gt_center" headers="(4)"></td>
<td class="gt_row gt_center" headers="(5)">2.516***</td>
<td class="gt_row gt_center" headers="(6)">0.091</td>
<td class="gt_row gt_center" headers="(7)">2.912***</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" " style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="(1)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="(2)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="(3)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(0.191)</td>
<td class="gt_row gt_center" headers="(4)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000"></td>
<td class="gt_row gt_center" headers="(5)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(0.431)</td>
<td class="gt_row gt_center" headers="(6)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(0.282)</td>
<td class="gt_row gt_center" headers="(7)" style="border-bottom-width: 1px; border-bottom-style: solid; border-bottom-color: #000000">(0.458)</td>
</tr>
<tr class="odd">
<td class="gt_row gt_left" headers=" ">Num.Obs.</td>
<td class="gt_row gt_center" headers="(1)">341</td>
<td class="gt_row gt_center" headers="(2)">341</td>
<td class="gt_row gt_center" headers="(3)">341</td>
<td class="gt_row gt_center" headers="(4)">341</td>
<td class="gt_row gt_center" headers="(5)">341</td>
<td class="gt_row gt_center" headers="(6)">341</td>
<td class="gt_row gt_center" headers="(7)">341</td>
</tr>
<tr class="even">
<td class="gt_row gt_left" headers=" ">R2</td>
<td class="gt_row gt_center" headers="(1)">0.080</td>
<td class="gt_row gt_center" headers="(2)">0.041</td>
<td class="gt_row gt_center" headers="(3)">0.019</td>
<td class="gt_row gt_center" headers="(4)">0.080</td>
<td class="gt_row gt_center" headers="(5)">0.164</td>
<td class="gt_row gt_center" headers="(6)">0.041</td>
<td class="gt_row gt_center" headers="(7)">0.178</td>
</tr>
</tbody><tfoot class="gt_sourcenotes">
<tr class="odd">
<td colspan="8" class="gt_sourcenote">+ p &lt; 0.1, * p &lt; 0.05, ** p &lt; 0.01, *** p &lt; 0.001</td>
</tr>
</tfoot>

</table>

</div>
</div>
</div>
</figure>
</div>
</div>
</section>
<section id="the-correlation-matrix-as-diagnostic" class="slide level2 smaller">
<h2>The correlation matrix as diagnostic</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="" aria-hidden="true" tabindex="-1"></a>nyc <span class="sc">|&gt;</span></span>
<span id="cb123-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lincome =</span> <span class="fu">log</span>(income)) <span class="sc">|&gt;</span></span>
<span id="cb123-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(poverty, unemployed, lincome) <span class="sc">|&gt;</span></span>
<span id="cb123-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">cor</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>              poverty unemployed    lincome
poverty     1.0000000  0.6982579 -0.9120680
unemployed  0.6982579  1.0000000 -0.7419472
lincome    -0.9120680 -0.7419472  1.0000000</code></pre>
</div>
</div>
<p>The correlation between the three variables is very high, suggesting strong multicollinearity.</p>
<p>Note that, while the correlation matrix is often helpful, it may not reveal the full extent of multicollinearity because it only looks at bivariate relationships between the variables.</p>
</div><div class="column fragment">
<p>You can also visualize the correlation matrix as a <em>correlogram</em>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb125"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb125-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(corrgram)</span>
<span id="cb125-2"><a href="" aria-hidden="true" tabindex="-1"></a>nyc <span class="sc">|&gt;</span></span>
<span id="cb125-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(poverty, unemployed, lincome) <span class="sc">|&gt;</span></span>
<span id="cb125-4"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corrgram</span>(<span class="at">upper.panel=</span><span class="st">"panel.cor"</span>, <span class="at">lower.panel=</span><span class="st">"panel.pts"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure>
<p><img data-src="slides_model_complications_files/figure-revealjs/corrgram-nyc-1.png" width="960"></p>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="variance-inflation-factors" class="slide level2 smaller">
<h2>Variance inflation factors</h2>
<p>The <strong>variance inflation factor</strong> (VIF) is the multiplicative factor by which the variance in the estimation of any one coefficient from the current model is increased due to multicollinearity relative to a model in which the variables are uncorrelated. The square root of the VIF is roughly the expected factor increase in the standard error. It can be shown that the VIF for the <span class="math inline">\(i\)</span>th variable is given by:</p>
<p><span class="math display">\[VIF_i=\frac{1}{1-R_i^2}\]</span></p>
<p>Where <span class="math inline">\(R_i^2\)</span> is the r-squared value when the given independent variable is predicted by all of the other independent variables in the model. For example, we could calculate the VIF for poverty in the full model by:</p>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="dv">1</span><span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span><span class="fu">summary</span>(<span class="fu">lm</span>(poverty<span class="sc">~</span>unemployed<span class="sc">+</span>lincome, <span class="at">data =</span> nyc))<span class="sc">$</span>r.squared)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 5.984485</code></pre>
</div>
</div>
<p>The square root of this VIF is 2.45, indicating that the standard error for poverty is more than doubled due to multicollinearity in the full model.</p>
</div>
</section>
<section id="estimating-vif-with-the-vif-command" class="slide level2">
<h2>Estimating VIF with the <code>vif</code> command</h2>
<p>We can also use the <code>vif</code> function in the <code>car</code> package to quickly estimate all VIFs for a given model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(car)</span>
<span id="cb128-2"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(amtcapita)<span class="sc">~</span>poverty<span class="sc">+</span>unemployed<span class="sc">+</span>lincome, <span class="at">data =</span> nyc)</span>
<span id="cb128-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">vif</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   poverty unemployed    lincome 
  5.984485   2.238379   6.822173 </code></pre>
</div>
</div>
<p>The general rule of thumb is that a VIF over four is problematic enough that it needs to be addressed in some manner. Clearly, multicollinearity is a big problem here.</p>
</section>
<section id="you-have-multicollinearity-now-what" class="slide level2 smaller">
<h2>You have multicollinearity, now what?</h2>
<div class="fragment">
<h3 id="remove-variables">Remove variables</h3>
<p>A simple approach is to remove some of the highly correlated covariates. However, because the variables are not perfectly correlated, you are basically throwing out some information.</p>
</div>
<div class="fragment">
<h3 id="separate-models">Separate models</h3>
<p>Another approach is to run separate models with only one of the highly collinear variables in each model. This can also be unsatisfying because each of the models is underestimating the total effect of the variables collectively.</p>
</div>
<div class="fragment">
<h3 id="create-a-scale">Create a scale</h3>
<p>In cases where the collinear variables are all thought to represent the same underlying conceptual variable, we can combine them into a single synthetic scale.</p>
</div>
</section>
<section id="standardization-and-reverse-ordering" class="slide level2 smaller">
<h2>Standardization and reverse ordering</h2>
<div class="columns">
<div class="column">
<ul>
<li class="fragment">In many cases, the variables that are thought to make up a scale might be measured in the same manner.</li>
<li class="fragment">When variables are measured differently (as in our example), then they must be standardized in some way to make them comparable before scale construction and evaluation. The most common way to do this is by creating <strong>z-scores</strong> by subtracting by the mean and dividing by the standard deviation of each variable.</li>
<li class="fragment">Some variables may be positively related to the underlying concept while others may be negatively related. It may be necessary to reverse the coding of a variable to make all variables positively related to the underlying concept.</li>
</ul>
</div><div class="column fragment">
<p>Lets write a quick function to standarize numeric variables:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="" aria-hidden="true" tabindex="-1"></a>standardize <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb130-2"><a href="" aria-hidden="true" tabindex="-1"></a>  (x <span class="sc">-</span> <span class="fu">mean</span>(x)) <span class="sc">/</span> <span class="fu">sd</span>(x)</span>
<span id="cb130-3"><a href="" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now lets apply the function:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="" aria-hidden="true" tabindex="-1"></a>nyc <span class="ot">&lt;-</span> nyc <span class="sc">|&gt;</span></span>
<span id="cb131-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">poverty.z =</span> <span class="fu">standardize</span>(poverty),</span>
<span id="cb131-3"><a href="" aria-hidden="true" tabindex="-1"></a>         <span class="at">unemployed.z =</span> <span class="fu">standardize</span>(unemployed),</span>
<span id="cb131-4"><a href="" aria-hidden="true" tabindex="-1"></a>         <span class="at">lincome.z =</span> <span class="sc">-</span><span class="dv">1</span> <span class="sc">*</span> <span class="fu">standardize</span>(lincome))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment">Note that I am multiplying the <code>lincome</code> result by -1 to reverse code it.</li>
</ul>
<div class="fragment fade-up">
<div class="callout callout-warning callout-titled callout-style-default">
<div class="callout-body">
<div class="callout-title">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<p><strong>Warning</strong></p>
</div>
<div class="callout-content">
<p>You can also use the built in base R <code>scale</code> command to do this, but it annoyingly saves the result as something other than a vector, making it a pain to use.</p>
</div>
</div>
</div>
</div>
</div></div>
</section>
<section id="cronbachs-alpha" class="slide level2 smaller">
<h2>Cronbach’s alpha</h2>
<p>Cronbach’s <span class="math inline">\(\alpha\)</span> is a statistic developed in psychology to test the degree to which different variables measure the same underlying concept.</p>
<ul>
<li class="fragment">Cronbach’s <span class="math inline">\(\alpha\)</span> is often thought of as a test of the <strong>internal reliability</strong> of a scale.</li>
<li class="fragment">You can think about Cronbach’s <span class="math inline">\(\alpha\)</span> as a summary measure of the correlation matrix we saw earlier. It goes from 0 to 1, with 0 indicating no shared correlation, and 1 indicating perfect correlation between all items.</li>
</ul>
<div class="fragment">
<p>The <code>pysch</code> package includes and <code>alpha</code> command that will calculate <span class="math inline">\(\alpha\)</span>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb132"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb132-1"><a href="" aria-hidden="true" tabindex="-1"></a>psych<span class="sc">::</span><span class="fu">alpha</span>(nyc[,<span class="fu">c</span>(<span class="st">"poverty.z"</span>,<span class="st">"unemployed.z"</span>,<span class="st">"lincome.z"</span>)])<span class="sc">$</span>total</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> raw_alpha std.alpha   G6(smc) average_r      S/N         ase          mean
 0.9159293 0.9159293 0.9013009  0.784091 10.89474 0.008313234 -1.373942e-16
        sd  median_r
 0.9252355 0.7419472</code></pre>
</div>
</div>
<p>The <span class="math inline">\(\alpha\)</span> of 0.916 indicates a very high level of shared covariance between the three variables.</p>
</div>
</section>
<section id="summated-scale" class="slide level2 smaller">
<h2>Summated scale</h2>
<p>Once I have standardized and (if necessary) reverse coded all of the variables for my scale, I can create a simple <strong>summated scale</strong> by adding them up. I am also going to re-standarzie this variable after summation so that it has a mean of zero and a standard deviation of one.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="" aria-hidden="true" tabindex="-1"></a>nyc <span class="ot">&lt;-</span> nyc <span class="sc">|&gt;</span></span>
<span id="cb134-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">deprivation_summated =</span> <span class="fu">standardize</span>(poverty.z<span class="sc">+</span>unemployed.z<span class="sc">+</span>lincome.z))</span>
<span id="cb134-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(nyc<span class="sc">$</span>deprivation_summated)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. 
-2.2056 -0.6893 -0.1816  0.0000  0.7127  3.0565 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb136"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb136-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">sd</span>(nyc<span class="sc">$</span>deprivation_summated)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1</code></pre>
</div>
</div>
<div class="fragment">
<p>Now lets use the summated scale in a model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb138"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb138-1"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(amtcapita)<span class="sc">~</span>deprivation_summated, <span class="at">data =</span> nyc)</span>
<span id="cb138-2"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)<span class="sc">$</span>coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                      Estimate Std. Error   t value      Pr(&gt;|t|)
(Intercept)          4.9474224 0.08807143 56.175114 8.329185e-174
deprivation_summated 0.3747882 0.08820085  4.249258  2.775153e-05</code></pre>
</div>
<div class="sourceCode cell-code" id="cb140"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb140-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         (Intercept) deprivation_summated 
          140.811538             1.454683 </code></pre>
</div>
</div>
<p>A one standard deviation increase on my deprivation scale is associated with a 45% increase in the amount for social services in a neighborhood.</p>
</div>
</section>
<section id="factor-analysis" class="slide level2 smaller">
<h2>Factor analysis</h2>
<p>Another approach to creating a scale is <strong>factor analysis</strong>. Factor analysis is a method to extract the underlying latent variables (the factors) from a set of observed variables. We will start with an example where we assume a single underlying latent factor.</p>
<div class="fragment">
<p>Lets say we have three variables <span class="math inline">\(z_1\)</span>, <span class="math inline">\(z_2\)</span>, and <span class="math inline">\(z_3\)</span> all measured as z-scores. We can construct a system of equations that relate each of these variables to a common shared factor <span class="math inline">\(F\)</span> (also on a standard scale with a mean of 0 and SD of 1) and three unique factors, <span class="math inline">\(Q_1\)</span>, <span class="math inline">\(Q_2\)</span>, and <span class="math inline">\(Q_3\)</span>.</p>
</div>
<div class="fragment">
<p><span class="math display">\[z_{i1}=b_1F_i+u_1Q_{i1}\]</span> <span class="math display">\[z_{i2}=b_2F_i+u_2Q_{i2}\]</span> <span class="math display">\[z_{i3}=b_3F_i+u_3Q_{i3}\]</span></p>
<p>The <span class="math inline">\(F_i\)</span> are called the <strong>factor scores</strong> and are the values of the common factor for each observation. The <span class="math inline">\(b\)</span> values are called the <strong>factor loadings</strong> and give the correlation between each observed variable and the common factor. The unique factor components are not actually estimated in factor analysis but serve as the “residual” components.</p>
</div>
</section>
<section id="estimation-in-factor-analysis" class="slide level2 smaller">
<h2>Estimation in factor analysis</h2>
<div class="columns">
<div class="column">
<p>The factor scores and factor loadings for a factor analysis can be estimated by mathematical manipulation of the observed correlation matrix between variables, but we won’t get into the mathematical details here.</p>
<ul>
<li class="fragment">The <code>factanal</code> command in base R will estimate a factor analysis by maximum likelihood estimation (a technique we will learn in the next module).</li>
<li class="fragment">The <code>fa</code> command in the <code>psych</code> package will also estimate factor analysis using a variety of techniques. It also has some nice additional tools that will make it more useful.</li>
</ul>
</div><div class="column fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb142"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb142-1"><a href="" aria-hidden="true" tabindex="-1"></a>factor_nyc <span class="ot">&lt;-</span> nyc <span class="sc">|&gt;</span></span>
<span id="cb142-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(poverty, unemployed, lincome) <span class="sc">|&gt;</span></span>
<span id="cb142-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fa</span>(<span class="dv">1</span>, <span class="at">rotate=</span><span class="st">"oblimin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<ul>
<li class="fragment">The second argument specifies that we want only one common factor.</li>
<li class="fragment">We also need to specify a technique of <em>rotation</em> for the factor loadings because there are an infinite number of possible ways to express them. The oblimin method is a standard approach that helps to maximize differences between factors without forcing them to be uncorrelated.</li>
</ul>
</div></div>
</section>
<section id="factor-loadings" class="slide level2 smaller">
<h2>Factor loadings</h2>
<div class="columns">
<div class="column fragment">
<h3 id="extract-loadings">Extract loadings</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">loadings</span>(factor_nyc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Loadings:
           MR1   
poverty     0.926
unemployed  0.754
lincome    -0.984

                 MR1
SS loadings    2.396
Proportion Var 0.799</code></pre>
</div>
</div>
<p>The bottom part shows that 79.9% of the variation in the three variables is accounted for by the common factor.</p>
<p>The loadings themselves show the correlation coefficient between each observed variable and the common factor.</p>
</div><div class="column fragment">
<h3 id="visualize-factor-loadings">Visualize factor loadings</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">fa.diagram</span>(factor_nyc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div id="fig-factor-loading" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-factor-loading-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="slides_model_complications_files/figure-revealjs/fig-factor-loading-1.png" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-factor-loading-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;14: Visual display of factor loadings
</figcaption>
</figure>
</div>
</div>
</div>
</div></div>
</section>
<section id="factor-scores" class="slide level2">
<h2>Factor Scores</h2>
<p>I can easily extract my factor scores from the the factor analysis object and use them as my scale measure of deprivation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb146"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb146-1"><a href="" aria-hidden="true" tabindex="-1"></a>nyc<span class="sc">$</span>deprivation_factor <span class="ot">&lt;-</span> factor_nyc<span class="sc">$</span>scores[,<span class="st">"MR1"</span>]</span>
<span id="cb146-2"><a href="" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="fu">log</span>(amtcapita)<span class="sc">~</span>deprivation_factor, <span class="at">data=</span>nyc)</span>
<span id="cb146-3"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)<span class="sc">$</span>coef</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>                    Estimate Std. Error   t value      Pr(&gt;|t|)
(Intercept)        4.9474224 0.08908910 55.533419 2.797390e-172
deprivation_factor 0.2849722 0.09036319  3.153631  1.756654e-03</code></pre>
</div>
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">exp</span>(<span class="fu">coef</span>(model))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       (Intercept) deprivation_factor 
        140.811538           1.329725 </code></pre>
</div>
</div>
<p>A one standard deviation increase on my deprivation scale is associated with a 33% increase in the amount for social services in a neighborhood.</p>
</section>
<section id="whats-the-difference" class="slide level2 smaller">
<h2>Whats the difference?</h2>
<div class="columns">
<div class="column">
<div class="cell">
<div class="cell-output-display">
<div id="fig-compare-scores" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-compare-scores-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="slides_model_complications_files/figure-revealjs/fig-compare-scores-1.png" width="960">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-compare-scores-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;15: comparison of the summated scale vs.&nbsp;factor score
</figcaption>
</figure>
</div>
</div>
</div>
</div><div class="column">
<ul>
<li class="fragment">The summated scale uses all the variation in the three variables to generate the score.</li>
<li class="fragment">The factor analysis only uses the shared component to generate the score. The unique component is left out.</li>
<li class="fragment">A closely related technique to factor analysis called <strong>principal component analysis</strong> uses all of the variation in the items and will produce results virtually identical to the summated score.</li>
</ul>
</div></div>
</section>
<section id="factor-analysis-with-multiple-factors" class="slide level2 smaller">
<h2>Factor analysis with multiple factors</h2>
<p>The previous example only used one factor and produced results that were very similar to a simple summated scale. However, it is also possible to use factor analysis to identify more than one common factor shared among a set of variables.</p>
<div class="fragment">
<p>The formulas for factor analysis above can be generalized to a set of <span class="math inline">\(J\)</span> observed variables and <span class="math inline">\(m\)</span> factors by a set of <span class="math inline">\(J\)</span> equations. For the <span class="math inline">\(j\)</span>th observed variable:</p>
<p><span class="math display">\[z_{ji}=b_{j1}F_{1i}+b_{j2}F_{2i}+\ldots+b_{jm}F_{ji}+u_jQ_{ji}\]</span></p>
<p>There will be a set of <span class="math inline">\(J\)</span> factor loadings for each of the <span class="math inline">\(m\)</span> factors. The key question with this technique is what are the appropriate number of factors? This is typically determined by an analysis of:</p>
</div>
<ul>
<li class="fragment">how much total variation is explained by a given number of factors.</li>
<li class="fragment">whether the factor loadings for a given number of factors make theoretical sense.</li>
</ul>
</section>
<section id="example-social-conservatism-among-muslims" class="slide level2 smaller">
<h2>Example: social conservatism among Muslims</h2>
<div class="columns">
<div class="column">
<p>Between 2008-12, The Pew Research Center surveyed Muslims from numerous countries around the world and (in addition to other questions) asked respondents about the moral acceptability of these practices:</p>
<div>
<ul>
<li>divorce</li>
<li>polygamy</li>
<li>fertility control</li>
<li>alcohol</li>
<li>euthanasia</li>
<li>suicide</li>
<li>abortion</li>
<li>prostitution</li>
<li>premarital sex</li>
<li>homosexuality</li>
</ul>
</div>
</div><div class="column">
<p>The data are coded as an ordinal response:</p>
<div>
<ul>
<li>Morally acceptable</li>
<li>Depends/Not a moral issue</li>
<li>Morally wrong</li>
</ul>
</div>
<p>I re-code the data on a numeric scale from 1 to 3.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="" aria-hidden="true" tabindex="-1"></a>pew <span class="ot">&lt;-</span> pew <span class="sc">|&gt;</span></span>
<span id="cb150-2"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">starts_with</span>(<span class="st">"moral_"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb150-3"><a href="" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_all</span>(as.numeric)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div></div>
</section>
<section id="using-the-correlation-matrix-as-data" class="slide level2">
<h2>Using the correlation matrix as data</h2>
<ul>
<li class="fragment">Factor analysis only needs the correlation matrix between variables rather than the original data itself.</li>
<li class="fragment">This is one case where available-case analysis makes sense. I can maximize the number of cases on each pairwise correlation coefficient to use all of the available data. The <code>use="pairwise.complete.obs"</code> argument in the <code>cor</code> function will use available-case analysis when it computes the correlation coefficient between each pair of variables.</li>
</ul>
<div class="fragment">
<div class="cell">
<div class="sourceCode cell-code" id="cb151"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb151-1"><a href="" aria-hidden="true" tabindex="-1"></a>morality_r <span class="ot">&lt;-</span> <span class="fu">cor</span>(pew, <span class="at">use=</span><span class="st">"pairwise.complete.obs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</div>
</section>
<section id="correlogram-of-responses" class="slide level2">
<h2>Correlogram of responses</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="" aria-hidden="true" tabindex="-1"></a><span class="fu">corrgram</span>(morality_r, <span class="at">upper.panel=</span>panel.cor, <span class="at">order=</span><span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>

</div>
<img data-src="slides_model_complications_files/figure-revealjs/fig-correlogram-moral-1.png" width="2304" class="r-stretch quarto-figure-center" id="fig-correlogram-moral"><p class="caption">
Figure&nbsp;16: Correlogram of morality variables from Pew data
</p></section>
<section id="try-factor-analysis-with-up-to-three-factors" class="slide level2">
<h2>Try factor analysis with up to three factors</h2>
</section>
<section id="comparing-different-number-of-factors" class="slide level2 smaller">
<h2>Comparing different number of factors</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb153"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb153-1"><a href="" aria-hidden="true" tabindex="-1"></a>morality_fa1 <span class="ot">&lt;-</span> <span class="fu">fa</span>(morality_r, <span class="dv">1</span>, <span class="at">rotate=</span><span class="st">"oblimin"</span>)</span>
<span id="cb153-2"><a href="" aria-hidden="true" tabindex="-1"></a>morality_fa2 <span class="ot">&lt;-</span> <span class="fu">fa</span>(morality_r, <span class="dv">2</span>, <span class="at">rotate=</span><span class="st">"oblimin"</span>)</span>
<span id="cb153-3"><a href="" aria-hidden="true" tabindex="-1"></a>morality_fa3 <span class="ot">&lt;-</span> <span class="fu">fa</span>(morality_r, <span class="dv">3</span>, <span class="at">rotate=</span><span class="st">"oblimin"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div id="fig-factor-morality" class="quarto-layout-panel">
<figure class="quarto-float quarto-float-fig">
<div aria-describedby="fig-factor-morality-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<div class="quarto-layout-row">
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-factor-morality" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-factor-morality-1" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-factor-morality-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="slides_model_complications_files/figure-revealjs/fig-factor-morality-1.png" data-ref-parent="fig-factor-morality" width="2304">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-factor-morality-1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(a) Single factor
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-factor-morality" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-factor-morality-2" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-factor-morality-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="slides_model_complications_files/figure-revealjs/fig-factor-morality-2.png" data-ref-parent="fig-factor-morality" width="2304">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-factor-morality-2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(b) Two factors
</figcaption>
</figure>
</div>
</div>
<div class="cell-output-display quarto-layout-cell-subref quarto-layout-cell" data-ref-parent="fig-factor-morality" style="flex-basis: 33.3%;justify-content: flex-start;">
<div id="fig-factor-morality-3" class="quarto-float quarto-figure quarto-figure-center">
<figure class="quarto-float quarto-subfloat-fig">
<div aria-describedby="fig-factor-morality-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img data-src="slides_model_complications_files/figure-revealjs/fig-factor-morality-3.png" data-ref-parent="fig-factor-morality" width="2304">
</div>
<figcaption class="quarto-float-caption-bottom quarto-subfloat-caption quarto-subfloat-fig" id="fig-factor-morality-3-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
(c) Three factors
</figcaption>
</figure>
</div>
</div>
</div>
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-factor-morality-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;17: Factor analysis of morality data
</figcaption>
</figure>
</div>
</section>
<section id="extending-factor-analysis" class="slide level2">
<h2>Extending factor analysis</h2>
<p>Factor analysis is part of a larger family of methods that are often described as <strong>data reduction</strong> techniques: How can you reduce the amount of information in a given set of variables into a smaller set of variables?</p>
<h3 id="latent-class-analysis">Latent class analysis</h3>
<p>An important cousin of factor analysis that can be used for categorical variables.</p>
<h3 id="structural-equation-modeling">Structural equation modeling</h3>
<p>The idea of factor analysis can be generalized to construct entire systems of equations that involve both latent and observed variables.</p>

</section></section>
    </div>
  <div class="quarto-auto-generated-content" style="display: none;">
<div class="footer footer-default">
<p>Sociology 312/412/512, University of Oregon</p>
</div>
</div></div>

  <script>window.backupDefine = window.define; window.define = undefined;</script>
  <script src="slides_model_complications_files/libs/revealjs/dist/reveal.js"></script>
  <!-- reveal.js plugins -->
  <script src="slides_model_complications_files/libs/revealjs/plugin/quarto-line-highlight/line-highlight.js"></script>
  <script src="slides_model_complications_files/libs/revealjs/plugin/pdf-export/pdfexport.js"></script>
  <script src="slides_model_complications_files/libs/revealjs/plugin/reveal-menu/menu.js"></script>
  <script src="slides_model_complications_files/libs/revealjs/plugin/reveal-menu/quarto-menu.js"></script>
  <script src="slides_model_complications_files/libs/revealjs/plugin/reveal-chalkboard/plugin.js"></script>
  <script src="slides_model_complications_files/libs/revealjs/plugin/reveal-code-focus/codefocus.js"></script>
  <script src="slides_model_complications_files/libs/revealjs/plugin/quarto-support/support.js"></script>
  

  <script src="slides_model_complications_files/libs/revealjs/plugin/notes/notes.js"></script>
  <script src="slides_model_complications_files/libs/revealjs/plugin/search/search.js"></script>
  <script src="slides_model_complications_files/libs/revealjs/plugin/zoom/zoom.js"></script>
  <script src="slides_model_complications_files/libs/revealjs/plugin/math/math.js"></script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
'controlsAuto': true,
'previewLinksAuto': false,
'pdfSeparateFragments': false,
'autoAnimateEasing': "ease",
'autoAnimateDuration': 1,
'autoAnimateUnmatched': true,
'jumpToSlide': true,
'menu': {"side":"left","useTextContentForMissingTitles":true,"markers":false,"loadIcons":false,"custom":[{"title":"Tools","icon":"<i class=\"fas fa-gear\"></i>","content":"<ul class=\"slide-menu-items\">\n<li class=\"slide-tool-item active\" data-item=\"0\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.fullscreen(event)\"><kbd>f</kbd> Fullscreen</a></li>\n<li class=\"slide-tool-item\" data-item=\"1\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.speakerMode(event)\"><kbd>s</kbd> Speaker View</a></li>\n<li class=\"slide-tool-item\" data-item=\"2\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.overview(event)\"><kbd>o</kbd> Slide Overview</a></li>\n<li class=\"slide-tool-item\" data-item=\"3\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.togglePdfExport(event)\"><kbd>e</kbd> PDF Export Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"4\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleScrollView(event)\"><kbd>r</kbd> Scroll View Mode</a></li>\n<li class=\"slide-tool-item\" data-item=\"5\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleChalkboard(event)\"><kbd>b</kbd> Toggle Chalkboard</a></li>\n<li class=\"slide-tool-item\" data-item=\"6\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.toggleNotesCanvas(event)\"><kbd>c</kbd> Toggle Notes Canvas</a></li>\n<li class=\"slide-tool-item\" data-item=\"7\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.downloadDrawings(event)\"><kbd>d</kbd> Download Drawings</a></li>\n<li class=\"slide-tool-item\" data-item=\"8\"><a href=\"#\" onclick=\"RevealMenuToolHandlers.keyboardHelp(event)\"><kbd>?</kbd> Keyboard Help</a></li>\n</ul>"}],"openButton":true},
'chalkboard': {"buttons":true},
'smaller': false,
 
        // Display controls in the bottom right corner
        controls: false,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: false,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'edges',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: true,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: false,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'linear',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: false,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: true,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'none',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'concave',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // The "normal" size of the presentation, aspect ratio will be preserved
        // when the presentation is scaled to fit different resolutions. Can be
        // specified using percentage units.
        width: 1050,

        height: 700,

        // Factor of the display size that should remain empty around the content
        margin: 0.1,

        math: {
          mathjax: 'https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js',
          config: 'TeX-AMS_HTML-full',
          tex2jax: {
            inlineMath: [['\\(','\\)']],
            displayMath: [['\\[','\\]']],
            balanceBraces: true,
            processEscapes: false,
            processRefs: true,
            processEnvironments: true,
            preview: 'TeX',
            skipTags: ['script','noscript','style','textarea','pre','code'],
            ignoreClass: 'tex2jax_ignore',
            processClass: 'tex2jax_process'
          },
        },

        // reveal.js plugins
        plugins: [QuartoLineHighlight, PdfExport, RevealMenu, RevealChalkboard, RevealCodeFocus, QuartoSupport,

          RevealMath,
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    
    <script>
      // htmlwidgets need to know to resize themselves when slides are shown/hidden.
      // Fire the "slideenter" event (handled by htmlwidgets.js) when the current
      // slide changes (different for each slide format).
      (function () {
        // dispatch for htmlwidgets
        function fireSlideEnter() {
          const event = window.document.createEvent("Event");
          event.initEvent("slideenter", true, true);
          window.document.dispatchEvent(event);
        }

        function fireSlideChanged(previousSlide, currentSlide) {
          fireSlideEnter();

          // dispatch for shiny
          if (window.jQuery) {
            if (previousSlide) {
              window.jQuery(previousSlide).trigger("hidden");
            }
            if (currentSlide) {
              window.jQuery(currentSlide).trigger("shown");
            }
          }
        }

        // hookup for slidy
        if (window.w3c_slidy) {
          window.w3c_slidy.add_observer(function (slide_num) {
            // slide_num starts at position 1
            fireSlideChanged(null, w3c_slidy.slides[slide_num - 1]);
          });
        }

      })();
    </script>

    <script id="quarto-html-after-body" type="application/javascript">
    window.document.addEventListener("DOMContentLoaded", function (event) {
      const toggleBodyColorMode = (bsSheetEl) => {
        const mode = bsSheetEl.getAttribute("data-mode");
        const bodyEl = window.document.querySelector("body");
        if (mode === "dark") {
          bodyEl.classList.add("quarto-dark");
          bodyEl.classList.remove("quarto-light");
        } else {
          bodyEl.classList.add("quarto-light");
          bodyEl.classList.remove("quarto-dark");
        }
      }
      const toggleBodyColorPrimary = () => {
        const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
        if (bsSheetEl) {
          toggleBodyColorMode(bsSheetEl);
        }
      }
      toggleBodyColorPrimary();  
      const tabsets =  window.document.querySelectorAll(".panel-tabset-tabby")
      tabsets.forEach(function(tabset) {
        const tabby = new Tabby('#' + tabset.id);
      });
      const isCodeAnnotation = (el) => {
        for (const clz of el.classList) {
          if (clz.startsWith('code-annotation-')) {                     
            return true;
          }
        }
        return false;
      }
      const onCopySuccess = function(e) {
        // button target
        const button = e.trigger;
        // don't keep focus
        button.blur();
        // flash "checked"
        button.classList.add('code-copy-button-checked');
        var currentTitle = button.getAttribute("title");
        button.setAttribute("title", "Copied!");
        let tooltip;
        if (window.bootstrap) {
          button.setAttribute("data-bs-toggle", "tooltip");
          button.setAttribute("data-bs-placement", "left");
          button.setAttribute("data-bs-title", "Copied!");
          tooltip = new bootstrap.Tooltip(button, 
            { trigger: "manual", 
              customClass: "code-copy-button-tooltip",
              offset: [0, -8]});
          tooltip.show();    
        }
        setTimeout(function() {
          if (tooltip) {
            tooltip.hide();
            button.removeAttribute("data-bs-title");
            button.removeAttribute("data-bs-toggle");
            button.removeAttribute("data-bs-placement");
          }
          button.setAttribute("title", currentTitle);
          button.classList.remove('code-copy-button-checked');
        }, 1000);
        // clear code selection
        e.clearSelection();
      }
      const getTextToCopy = function(trigger) {
          const codeEl = trigger.previousElementSibling.cloneNode(true);
          for (const childEl of codeEl.children) {
            if (isCodeAnnotation(childEl)) {
              childEl.remove();
            }
          }
          return codeEl.innerText;
      }
      const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
        text: getTextToCopy
      });
      clipboard.on('success', onCopySuccess);
      if (window.document.getElementById('quarto-embedded-source-code-modal')) {
        const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
          text: getTextToCopy,
          container: window.document.getElementById('quarto-embedded-source-code-modal')
        });
        clipboardModal.on('success', onCopySuccess);
      }
        var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
        var mailtoRegex = new RegExp(/^mailto:/);
          var filterRegex = new RegExp('/' + window.location.host + '/');
        var isInternal = (href) => {
            return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
        }
        // Inspect non-navigation links and adorn them if external
     	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
        for (var i=0; i<links.length; i++) {
          const link = links[i];
          if (!isInternal(link.href)) {
            // undo the damage that might have been done by quarto-nav.js in the case of
            // links that we want to consider external
            if (link.dataset.originalHref !== undefined) {
              link.href = link.dataset.originalHref;
            }
          }
        }
      function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
        const config = {
          allowHTML: true,
          maxWidth: 500,
          delay: 100,
          arrow: false,
          appendTo: function(el) {
              return el.closest('section.slide') || el.parentElement;
          },
          interactive: true,
          interactiveBorder: 10,
          theme: 'light-border',
          placement: 'bottom-start',
        };
        if (contentFn) {
          config.content = contentFn;
        }
        if (onTriggerFn) {
          config.onTrigger = onTriggerFn;
        }
        if (onUntriggerFn) {
          config.onUntrigger = onUntriggerFn;
        }
          config['offset'] = [0,0];
          config['maxWidth'] = 700;
        window.tippy(el, config); 
      }
      const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
      for (var i=0; i<noterefs.length; i++) {
        const ref = noterefs[i];
        tippyHover(ref, function() {
          // use id or data attribute instead here
          let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
          try { href = new URL(href).hash; } catch {}
          const id = href.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note) {
            return note.innerHTML;
          } else {
            return "";
          }
        });
      }
      const findCites = (el) => {
        const parentEl = el.parentElement;
        if (parentEl) {
          const cites = parentEl.dataset.cites;
          if (cites) {
            return {
              el,
              cites: cites.split(' ')
            };
          } else {
            return findCites(el.parentElement)
          }
        } else {
          return undefined;
        }
      };
      var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
      for (var i=0; i<bibliorefs.length; i++) {
        const ref = bibliorefs[i];
        const citeInfo = findCites(ref);
        if (citeInfo) {
          tippyHover(citeInfo.el, function() {
            var popup = window.document.createElement('div');
            citeInfo.cites.forEach(function(cite) {
              var citeDiv = window.document.createElement('div');
              citeDiv.classList.add('hanging-indent');
              citeDiv.classList.add('csl-entry');
              var biblioDiv = window.document.getElementById('ref-' + cite);
              if (biblioDiv) {
                citeDiv.innerHTML = biblioDiv.innerHTML;
              }
              popup.appendChild(citeDiv);
            });
            return popup.innerHTML;
          });
        }
      }
    });
    </script>
    

</body></html>